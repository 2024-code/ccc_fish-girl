{"version":3,"sources":["assets\\scripts\\components\\ImageLoader.js"],"names":["loadImage","url","code","callback","cc","loader","load","err","tex","spriteFrame","SpriteFrame","Rect","width","height","getBaseInfo","userid","vv","baseInfoMap","http","sendRequest","ret","headimgurl","info","name","sex","master_url","Class","Component","properties","onLoad","setupSpriteFrame","setUserID","ttype","images","self","yaoqing","userMgr","yaoqing_key","roomid","shareRoomId","gameNetMgr","roomId","_spriteFrame","spr","getComponent","Sprite"],"mappings":"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","sourceRoot":"/","sourcesContent":["function loadImage(url, code, callback) {\r\n    cc.loader.load(url, function(err, tex) {\r\n        var spriteFrame = new cc.SpriteFrame(tex, cc.Rect(0, 0, tex.width, tex.height));\r\n        callback(code, spriteFrame);\r\n    });\r\n};\r\n\r\nfunction getBaseInfo(userid, callback) {\r\n    if (cc.vv.baseInfoMap == null) {\r\n        cc.vv.baseInfoMap = {};\r\n    }\r\n    if (cc.vv.baseInfoMap[userid] != null) {\r\n        callback(userid, cc.vv.baseInfoMap[userid]);\r\n    } else {\r\n        cc.vv.http.sendRequest('/base_info', {\r\n            userid: userid\r\n        }, function(ret) {\r\n            var url = null;\r\n            if (ret.headimgurl) {\r\n                url = ret.headimgurl;\r\n            }\r\n            var info = {\r\n                name: ret.name,\r\n                sex: ret.sex,\r\n                url: url\r\n            }\r\n            cc.vv.baseInfoMap[userid] = info;\r\n            callback(userid, info);\r\n        }, cc.vv.http.master_url);\r\n    }\r\n};\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {},\r\n    // use this for initialization\r\n    onLoad: function() {\r\n        this.setupSpriteFrame();\r\n    },\r\n    setUserID: function(userid, ttype) {\r\n        if (!userid) {\r\n            return;\r\n        }\r\n        if (cc.vv.images == null) {\r\n            cc.vv.images = {};\r\n        }\r\n        var self = this;\r\n        // 如果指定类型为1表示显示二维码信息\r\n        if (ttype == 1) {\r\n            var yaoqing = 'btmj' + cc.vv.userMgr.yaoqing_key;\r\n            var roomid = cc.vv.userMgr.shareRoomId || cc.vv.gameNetMgr.roomId || \"000000\";\r\n            var url = 'http://mj.yajugame.com/manage1/?/member/user/qrcode_app/';\r\n            if (!yaoqing) {\r\n                return\r\n            }\r\n            url = url + yaoqing + '/' + roomid + '.png';\r\n            loadImage(url, userid, function(err, spriteFrame) {\r\n                self._spriteFrame = spriteFrame;\r\n                self.setupSpriteFrame();\r\n            });\r\n        } else {\r\n            getBaseInfo(userid, function(code, info) {\r\n                if (info && info.url) {\r\n                    loadImage(info.url, userid, function(err, spriteFrame) {\r\n                        self._spriteFrame = spriteFrame;\r\n                        self.setupSpriteFrame();\r\n                    });\r\n                }\r\n            });\r\n        }\r\n    },\r\n    setupSpriteFrame: function() {\r\n        if (this._spriteFrame) {\r\n            var spr = this.getComponent(cc.Sprite);\r\n            if (spr) {\r\n                spr.spriteFrame = this._spriteFrame;\r\n            }\r\n        }\r\n    }\r\n});"]}