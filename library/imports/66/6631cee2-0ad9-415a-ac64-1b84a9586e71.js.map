{"version":3,"sources":["assets\\LaoHuJi\\module\\winCoins\\winCoins.js"],"names":["coinMove","require","cc","Class","Component","properties","Label_coins","type","Label","tooltip","Prefab_coin","Prefab","MaxPrefabCoinNum","ShowTime","Time","ValueOfPrefabCoin","_winCoins","_currentAdd","_addSpeed","_continueAdd","Initialize","winCoins","posStart","posEnd","_posStart","_posEnd","Math","ceil","prefabCoinNum","_prefabCoinNum","min","_prefabCoinsArray","Array","string","update","dt","addCoins","length","instantiateNum","i","nodeCoin","instantiate","parent","node","getComponent","SetData","push","scheduleOnce","active","destroy"],"mappings":"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","sourceRoot":"/","sourcesContent":["var coinMove = require(\"coinMove\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        Label_coins: {\r\n            default: null,\r\n            type: cc.Label,\r\n            tooltip: \"金币文字\",\r\n        },\r\n        Prefab_coin: {\r\n            default: null,\r\n            type: cc.Prefab,\r\n            tooltip: \"金币预制件\",\r\n        },\r\n        MaxPrefabCoinNum: {\r\n            default: 20,\r\n            tooltip: \"最多可以生成多少个金币预制件\",\r\n        },\r\n        ShowTime: {\r\n            default: 2,\r\n            tooltip: \"展示中奖金币的时长（秒）\",\r\n        },\r\n        Time: {\r\n            default: 3,\r\n            tooltip: \"加金币动画的总时长（秒）\",\r\n        },\r\n        ValueOfPrefabCoin: {\r\n            default: 100,\r\n            tooltip: \"一个金币预制件代表的价值\",\r\n        },\r\n\r\n        _winCoins: 0,//赢了多少金币\r\n        _currentAdd: 0,//当前加到多少金币\r\n        _addSpeed: 0,//每秒金币增加量\r\n        _continueAdd: false,//持续增加金币\r\n    },\r\n\r\n    Initialize: function (winCoins, posStart, posEnd) {\r\n        if (winCoins <= 0) return;\r\n\r\n        this._winCoins = winCoins;\r\n        this._posStart = posStart;\r\n        this._posEnd = posEnd;\r\n\r\n        this._addSpeed = Math.ceil(winCoins / this.Time);\r\n\r\n        var prefabCoinNum = Math.ceil(winCoins / this.ValueOfPrefabCoin);\r\n        this._prefabCoinNum = Math.min(prefabCoinNum, this.MaxPrefabCoinNum);\r\n        this._prefabCoinsArray = new Array();\r\n\r\n        this.Label_coins.string = this._currentAdd;\r\n        this._continueAdd = true;\r\n    },\r\n\r\n    update: function (dt) {\r\n        if (this._continueAdd) {\r\n            var addCoins = Math.ceil(this._addSpeed * dt);\r\n            this._currentAdd += addCoins;\r\n            this.Label_coins.string = this._currentAdd;\r\n\r\n            if (this._prefabCoinsArray.length < this._prefabCoinNum) {//金币预制件数组元素个数少于应该生成的金币数\r\n                var prefabCoinNum = Math.ceil(this._currentAdd / this.ValueOfPrefabCoin);\r\n                if (prefabCoinNum > this._prefabCoinsArray.length) {\r\n                    var instantiateNum = prefabCoinNum - this._prefabCoinsArray.length;\r\n                    for (var i = 0; i < instantiateNum; i++) {\r\n                        var nodeCoin = cc.instantiate(this.Prefab_coin);//克隆一个金币\r\n                        nodeCoin.parent = this.node.parent;\r\n                        nodeCoin.getComponent(coinMove).SetData(this._posStart, this._posEnd);//设置金币的起点和终点\r\n                        this._prefabCoinsArray.push(nodeCoin.getComponent(coinMove));\r\n                    }\r\n                }\r\n            }\r\n            \r\n            if (this._currentAdd >= this._winCoins) {\r\n                this.Label_coins.string = this._winCoins;\r\n                this._continueAdd = false;\r\n                this.scheduleOnce(function () {\r\n                    this.node.active = false;\r\n                    this.node.destroy();\r\n                }, this.ShowTime);\r\n            }\r\n        }\r\n    },\r\n});"]}