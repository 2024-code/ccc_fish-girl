{"version":3,"sources":["assets\\LaoHuJi\\module\\openBox\\boxManager.js"],"names":["cc","Class","Component","properties","_bonusSum","_times","_bonusArray","_openCount","_showCount","PanelMask","type","Node","tooltip","Countdown","LabelCountdown","Label","LabelWinCoins","LabelRemainOpenCount","_totalWinCoins","start","self","node","on","event","stopPropagation","detail","string","RefreshLabel_RemainOpenCount","update","dt","Math","round","onBtnClick_close","SetData","bonusSum","times","remain","Array","i","random","active","destroy","onBtnClick_openBox"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        _bonusSum: 0,//总奖金\r\n        _times: 0,//分几次开\r\n        _bonusArray: [],//每次开奖的奖金\r\n        _openCount: 0,//已经点击打开的宝箱计数\r\n        _showCount: 0,//已经显示奖金的宝箱计数\r\n        PanelMask: {\r\n            default: null,\r\n            type: cc.Node,\r\n            tooltip: \"遮罩面板\",\r\n        },\r\n        Countdown: {\r\n            default: 10,\r\n            tooltip: \"界面销毁倒计时(秒)\",\r\n        },\r\n        LabelCountdown: {\r\n            default: null,\r\n            type: cc.Label,\r\n            tooltip: \"倒计时Label数字\",\r\n        },\r\n        LabelWinCoins: {\r\n            default: null,\r\n            type: cc.Label,\r\n            tooltip: \"中奖金额\",\r\n        },\r\n        LabelRemainOpenCount: {\r\n            default: null,\r\n            type: cc.Label,\r\n            tooltip: \"剩余开奖次数\",\r\n        },\r\n        _totalWinCoins: 0,\r\n    },\r\n\r\n    start: function () {\r\n        var self = this;\r\n        this.node.on('Event_OpenBox', function (event) {\r\n            event.stopPropagation();//停止传递当前事件\r\n            //播放音效\r\n            event.detail.string = self._bonusArray[self._showCount];//显示奖金\r\n            self._totalWinCoins += self._bonusArray[self._showCount];//总金额累加\r\n            self.LabelWinCoins.string = self._totalWinCoins;//显示总金额\r\n            self._showCount++;//增加计数\r\n        });\r\n        this.RefreshLabel_RemainOpenCount();//刷新剩余开奖次数文字\r\n    },\r\n\r\n    update: function (dt) {\r\n        this.Countdown -= dt;\r\n        this.LabelCountdown.string = Math.round(this.Countdown);//显示倒计时\r\n        if (this.Countdown < 0) {\r\n            this.onBtnClick_close();//关闭界面\r\n        }\r\n    },\r\n\r\n    SetData: function (bonusSum, times) {\r\n        if (times <= 0) return;\r\n        this._bonusSum = bonusSum;\r\n        this._times = times;\r\n\r\n        var remain = this._bonusSum;\r\n        this._bonusArray = new Array(this._times);\r\n        for (var i = 0; i < this._times - 1; i++) {\r\n            var random = Math.round(Math.random() * remain);\r\n            this._bonusArray[i] = random;\r\n            remain -= random;\r\n        }\r\n        this._bonusArray[this._times - 1] = remain;\r\n    },\r\n\r\n    //关闭界面\r\n    onBtnClick_close: function () {\r\n        //console.log('关闭宝箱界面');\r\n        this.node.active = false;\r\n        this.node.destroy();\r\n    },\r\n\r\n    //点击宝箱\r\n    onBtnClick_openBox: function () {\r\n        this._openCount++;\r\n        this.RefreshLabel_RemainOpenCount();//刷新剩余开奖次数文字\r\n        if (this._openCount === this._times) {\r\n            this.PanelMask.active = true;//禁止界面交互\r\n        }\r\n    },\r\n\r\n    //刷新剩余开奖次数文字\r\n    RefreshLabel_RemainOpenCount: function () {\r\n        this.LabelRemainOpenCount.string = this._times - this._openCount;\r\n    },\r\n});"]}