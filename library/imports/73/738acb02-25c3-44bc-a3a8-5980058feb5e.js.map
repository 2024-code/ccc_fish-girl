{"version":3,"sources":["assets\\Texture\\game_bcbm\\js\\zhuanpan_bcbm.js"],"names":["cc","Class","Component","properties","AnimationArrayItem","type","Animation","tooltip","AudioSourceArrayItem","AudioSource","JiaSuDu_QiDong","JiaSuDu_ZhiDong","SpeedChangeForOneStep","MaxSpeed","AudioSourceLaunch","AudioSourcePaoMa","AudioSourceStop","AudioSourceDaQiang","TimeIntervalDaQiang","start","_arrayLength","length","_currentIndex","_timeForOneItem","_accTime","_timeArrayJiaSu","Array","_timeArrayJianSu","time","i","_indexJiaSu","_indexJianSu","_isMove","update","dt","_isJianSu","_indexZhiDong","play","MoveAStep","stop","node","opacity","Math","floor","random","DispatchEvent","Launch","Stop","indexStop","dispatchEvent","Event","EventCustom"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        AnimationArrayItem: {\r\n            default: [],\r\n            type: [cc.Animation],\r\n            tooltip: '图标的淡出动画',\r\n        },\r\n        AudioSourceArrayItem: {\r\n            default: [],\r\n            type: [cc.AudioSource],\r\n            tooltip: '图标的中奖音效',\r\n        },\r\n        JiaSuDu_QiDong: {\r\n            default: 3,\r\n            tooltip: '启动的加速度（需要经过几个图标才能加速到最大速度）',\r\n        },\r\n        JiaSuDu_ZhiDong: {\r\n            default: 3,\r\n            tooltip: '制动的加速度（需要经过几个图标才能减速到停止）',\r\n        },\r\n        SpeedChangeForOneStep: {\r\n            default: 0.1,\r\n            tooltip: '加速或减速过程中，每完成一个step速度的改变量（时间）',\r\n        },\r\n        MaxSpeed: {\r\n            default: 12,\r\n            tooltip: '每秒钟闪过的图标数',\r\n        },\r\n        AudioSourceLaunch: {\r\n            default: null,\r\n            type: cc.AudioSource,\r\n            tooltip: '启动音效',\r\n        },\r\n        AudioSourcePaoMa: {\r\n            default: null,\r\n            type: cc.AudioSource,\r\n            tooltip: '跑马音效',\r\n        },\r\n        AudioSourceStop: {\r\n            default: null,\r\n            type: cc.AudioSource,\r\n            tooltip: '停止音效',\r\n        },\r\n        AudioSourceDaQiang: {\r\n            default: null,\r\n            type: cc.AudioSource,\r\n            tooltip: '打枪音效',\r\n        },\r\n        TimeIntervalDaQiang: {\r\n            default: 0.8,\r\n            tooltip: '两次打枪之间的间隔时间（秒）',\r\n        },\r\n    },\r\n\r\n    start: function () {\r\n        this._arrayLength = this.AnimationArrayItem.length;//数组的长度\r\n        this._currentIndex = 0;//当前的数组索引\r\n        this._timeForOneItem = 1 / this.MaxSpeed;//最大速度下闪过一个图标需要的时间\r\n        this._accTime = 0;//在两个相邻图标间的累积停顿时间\r\n        this._timeArrayJiaSu = new Array(this.JiaSuDu_QiDong);//加速过程\r\n        this._timeArrayJianSu = new Array(this.JiaSuDu_ZhiDong);//减速过程\r\n        var time = this._timeForOneItem;\r\n        for (var i = this.JiaSuDu_QiDong - 1; i > -1; i--) {\r\n            time += this.SpeedChangeForOneStep;\r\n            this._timeArrayJiaSu[i] = time;\r\n        }\r\n        time = this._timeForOneItem;\r\n        for (var i = 0; i < this.JiaSuDu_ZhiDong; i++) {\r\n            time += this.SpeedChangeForOneStep;\r\n            this._timeArrayJianSu[i] = time;\r\n        }\r\n        this._indexJiaSu = -1;//加速过程数组的索引\r\n        this._indexJianSu = -1;//减速过程数组的索引\r\n        this._isMove = false;\r\n    },\r\n\r\n    update: function (dt) {\r\n        if (this._isJianSu) {//需要减速\r\n            if (this._currentIndex === this._indexZhiDong) {//到了开始减速的那个点\r\n                this._indexJiaSu = -1;\r\n                this._indexJianSu = 0;\r\n                this._isJianSu = false;\r\n                this.AudioSourceStop.play();//播放停止音效\r\n            }\r\n        }\r\n\r\n        if (this._indexJiaSu >= 0 || this._indexJianSu >= 0) {\r\n            if (this._indexJiaSu >= 0) {//加速过程\r\n                this._accTime += dt;\r\n                if (this._accTime > this._timeArrayJiaSu[this._indexJiaSu]) {\r\n                    this._accTime = 0;\r\n                    this.MoveAStep();\r\n                    this._indexJiaSu++;//完成了加速过程的一个step\r\n                    if (this._indexJiaSu >= this.JiaSuDu_QiDong) {//完成了整个加速过程\r\n                        this._isMove = true;\r\n                        this._indexJiaSu = -1;\r\n                    }\r\n                }\r\n            }\r\n            if (this._indexJianSu >= 0) {//减速过程\r\n                this._accTime += dt;\r\n                if (this._accTime > this._timeArrayJianSu[this._indexJianSu]) {\r\n                    this._accTime = 0;\r\n                    this.MoveAStep();\r\n                    this._indexJianSu++;//完成了减速过程的一个step\r\n                    if (this._indexJianSu >= this.JiaSuDu_ZhiDong) {//完成了整个减速过程\r\n                        this._isMove = false;\r\n                        this._indexJianSu = -1;\r\n                        this.AnimationArrayItem[this._currentIndex].stop();\r\n                        this.AnimationArrayItem[this._currentIndex].node.opacity = 255;\r\n                        this.AudioSourcePaoMa.stop();//停止播放跑马音效\r\n                        this.AudioSourceArrayItem[Math.floor(Math.random() * this.AudioSourceArrayItem.length)].play();//播放中奖音效\r\n                        this.DispatchEvent();//中奖分析\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            if (this._isMove) {\r\n                this._accTime += dt;\r\n                if (this._accTime > this._timeForOneItem) {\r\n                    this._accTime = 0;\r\n                    this.MoveAStep();\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    Launch: function () {\r\n        for (var i = 0; i < this.AnimationArrayItem.length; i++) {\r\n            this.AnimationArrayItem[i].play();\r\n        }\r\n        this._indexJiaSu = 0;\r\n        this._indexJianSu = -1;\r\n        this.AudioSourceLaunch.play();//播放启动音效\r\n        this.AudioSourcePaoMa.play();//播放跑马音效\r\n    },\r\n\r\n    Stop: function (indexStop) {\r\n        this._indexZhiDong = (this._arrayLength + indexStop - this.JiaSuDu_ZhiDong) % this._arrayLength;//js的负数取模竟然还是负数，也是醉了！！\r\n        this._isJianSu = true;\r\n    },\r\n\r\n    MoveAStep: function () {\r\n        this._currentIndex++;\r\n        this._currentIndex %= this._arrayLength;\r\n        this.AnimationArrayItem[this._currentIndex].play();\r\n    },\r\n\r\n    //投递事件\r\n    DispatchEvent: function () {\r\n        this.node.dispatchEvent(new cc.Event.EventCustom('Event_ZhuanPanStop', true));\r\n    },\r\n\r\n});"]}