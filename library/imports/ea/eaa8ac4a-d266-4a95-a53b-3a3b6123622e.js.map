{"version":3,"sources":["assets\\Script\\Fish_haiwang2\\haiwang2CannonCtrl.js"],"names":["cc","Class","Component","properties","seatID","goldLbl","Label","nameLbl","betLbl","cannonAnim","Animation","onLoad","cannonPos","node","convertToWorldSpaceAR","position","fishMain","find","getComponent","cannonList","playerInfo","require","getInstant","onEnable","dataInfo","playerList","string","name","window","setHeadTexture","getChildByName","head","Helper","fixNum","roomBet","update","dt","score","uid","playerId","bulletPower","isLockFish","active","bang","pos","bet","bid","angle","Math","PI","atan","x","y","playAdditive","bullet","getBullet","bulletPos","bulletBg","convertToNodeSpaceAR","sin","cos","init","userID","parent","bulletId","bigfishid","getBigFishId","autoId","addscore","check_pan","fishType","labelBaseNode","labelNode","stopAllActions","runAction","sequence","show","delayTime","hide","i","children","onSkill","sid","time","skillTime"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        seatID: 0, //座位号\r\n        goldLbl: cc.Label, //金币显示\r\n        nameLbl: cc.Label, //名字显示\r\n        betLbl: cc.Label, //当前倍数显示\r\n        cannonAnim: cc.Animation, //大炮动画\r\n    },\r\n\r\n    onLoad() {\r\n        this.cannonPos = this.node.convertToWorldSpaceAR(this.cannonAnim.node.position);\r\n        this.fishMain = cc.find('Canvas').getComponent('Fishhaiwang2Main');\r\n        this.fishMain.cannonList[this.seatID] = this;\r\n        this.playerInfo = require('PlayerInfo').getInstant;\r\n        //this.autoTime = 0;\r\n\r\n    },\r\n\r\n    onEnable() {\r\n        this.dataInfo = this.fishMain.playerList[this.seatID];\r\n        this.nameLbl.string = this.dataInfo.name;\r\n        window.setHeadTexture(this.node.getChildByName('left').getChildByName('face').getChildByName('s1'), this.dataInfo.head);\r\n        //this.goldLbl.string = this.dataInfo.score;\r\n        //this.betLbl.string = this.fishMain.roomBet;\r\n        this.betLbl.string = Helper.fixNum(this.fishMain.roomBet);\r\n    },\r\n\r\n    update(dt) {\r\n        this.goldLbl.string = Helper.fixNum(this.dataInfo.score);\r\n        if (this.dataInfo.uid == this.playerInfo.playerId) {\r\n            this.betLbl.string = Helper.fixNum(this.fishMain.roomBet * this.fishMain.bulletPower);\r\n\r\n            if (this.fishMain.isLockFish) {\r\n                this.node.getChildByName('suoding_effect').active = true;\r\n            } else {\r\n                this.node.getChildByName('suoding_effect').active = false;\r\n            }\r\n        }\r\n\r\n        // if (this.autoTime>0){\r\n        //     this.autoTime--;\r\n        // };\r\n        // if (this.autoTime>0)\r\n\r\n    },\r\n\r\n    bang(pos, bet, bid) {\r\n        //需要区分上下  方向是反的\r\n        let angle = 180 / (Math.PI / Math.atan((this.cannonPos.x - pos.x) / (this.cannonPos.y - pos.y)));\r\n        this.cannonAnim.node.angle = this.seatID > 1 ? angle : -angle;\r\n        this.cannonAnim.playAdditive(\"武器1_攻击状态\");\r\n\r\n        //处理子弹发射\r\n        let bullet = this.fishMain.getBullet();\r\n\r\n        let bulletPos = this.fishMain.bulletBg.convertToNodeSpaceAR(this.cannonPos);\r\n\r\n        bulletPos.x += 100 * Math.sin(-2 * Math.PI / 360 * this.cannonAnim.node.angle);\r\n        bulletPos.y += 100 * Math.cos(-2 * Math.PI / 360 * this.cannonAnim.node.angle);\r\n\r\n        bullet.getComponent('haiwang2BulletCtrl').init(this.fishMain, this.seatID, bulletPos, this.seatID > 1 ? angle - 180 : angle, this.fishMain.bulletPower);\r\n        bullet.getComponent('haiwang2BulletCtrl').userID = this.dataInfo.uid;\r\n        bullet.parent = this.fishMain.bulletBg;\r\n        this.dataInfo.score -= this.fishMain.roomBet * bet;\r\n        bullet.getComponent('haiwang2BulletCtrl').bulletId = bid;\r\n        //console.log(\"onshoot: \"+bid);\r\n        //this.bulletPower = bet;\r\n        this.betLbl.string = Helper.fixNum(this.fishMain.roomBet * bet);\r\n\r\n        let bigfishid = this.fishMain.getBigFishId();\r\n\r\n        if (this.fishMain.isLockFish) {\r\n            bullet.getComponent('haiwang2BulletCtrl').autoId = bigfishid;\r\n        }\r\n    },\r\n\r\n    addscore(score) {\r\n        this.dataInfo.score += score;\r\n    },\r\n\r\n    check_pan(fishType, score) {\r\n        var labelBaseNode = this.node.getChildByName(\"zhuanpan\").getChildByName(\"zp_di3\");\r\n        var labelNode = labelBaseNode.getChildByName(\"tray_fish_type_\" + fishType);\r\n        if (labelNode == null) return;\r\n        this.node.getChildByName(\"zhuanpan\").active = true;\r\n        this.node.getChildByName(\"zhuanpan\").stopAllActions();\r\n        this.node.getChildByName(\"zhuanpan\").runAction(cc.sequence(cc.show(), cc.delayTime(3), cc.hide()));\r\n\r\n        for (var i in labelBaseNode.children) {\r\n            var node = labelBaseNode.children[i];\r\n            if (node == labelNode) node.active = true;\r\n            else node.active = false;\r\n        }\r\n        this.node.getChildByName(\"zhuanpan\").getChildByName(\"jiangjin\").getComponent(cc.Label).string = Helper.fixNum(score);\r\n    },\r\n\r\n    onSkill(sid, score, time) {\r\n        this.dataInfo.score -= score;\r\n        if (sid == 1) {\r\n        } else if (sid == 2) {\r\n            this.skillTime[1] = time;\r\n        }\r\n    },\r\n});"]}