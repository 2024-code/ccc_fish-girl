{"version":3,"sources":["assets\\Texture\\Slot_EgyptianTreasures\\js\\EFWheel.js"],"names":["ROLENUM","TIMEMIN","cc","Class","Component","properties","wheelId","excludeId","displayName","onLoad","audio","director","getScene","getChildByName","getComponent","mainObj","wheelList","status","lastResult","rolePbList","roleIdList","start","initWheel","node","removeAllChildren","i","getRandomId","addRole","y","rollIndex","closeShine","startRoll","args","setTimeout","timer","auto","runAction","sequence","delayTime","moveTo","v2","x","height","callFunc","rollCallBack","bind","randomId","freeTimes","stopFree","hashSet","Set","bigWinResList","Math","floor","random","rolePb","length","has","id","pb","instantiate","push","addChild","playStopWheel","slice","stateCallBack","stopImmediately","stopAllActions"],"mappings":"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","sourceRoot":"/","sourcesContent":["const ROLENUM = 40; //每一轮的角色数量\r\nconst TIMEMIN = 1; //第一轮摇奖时间\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        wheelId: 0,\r\n        excludeId: {\r\n            default: 0,\r\n            displayName: '不会出现的数字id',\r\n        },\r\n    },\r\n\r\n    onLoad() {\r\n        this.audio = cc.director.getScene().getChildByName('Canvas').getComponent('EFAudio');\r\n        this.mainObj = cc.director.getScene().getChildByName('Canvas').getComponent('EFMain');\r\n        this.mainObj.wheelList[this.wheelId] = this;\r\n        this.status = 0; //0停止 1转 \r\n        this.lastResult = [0, 0, 0, 0, 0]; //中间三位是上一局结果 首位末尾是为了防止露出部分转起来不一样 \r\n        this.rolePbList = []; //role\r\n        this.roleIdList = []; //role ID\r\n    },\r\n\r\n    start() {\r\n        //初始化场景role\r\n        this.initWheel();\r\n    },\r\n\r\n    initWheel() {\r\n        this.rolePbList = [];\r\n        this.roleIdList = [];\r\n        this.node.removeAllChildren();\r\n        for (let i in this.lastResult) {\r\n            this.lastResult[i] = this.getRandomId();\r\n            this.addRole(this.lastResult[i]);\r\n        }\r\n        this.addRole(this.getRandomId());\r\n        this.node.y = -250;\r\n        this.mainObj.rollIndex++;\r\n        this.mainObj.closeShine();\r\n    },\r\n\r\n    startRoll(...args) {\r\n        this.status = 1;\r\n        this.rolePbList = [];\r\n        this.roleIdList = [];\r\n        this.node.removeAllChildren();\r\n        this.node.y = -250;\r\n        for (let i in this.lastResult) {\r\n            this.lastResult[i] = this.lastResult[i] == 0 ? this.getRandomId() : this.lastResult[i];\r\n            this.addRole(this.lastResult[i]);\r\n        }\r\n        for (let i = 0; i < ROLENUM - 9; i++) {\r\n            this.addRole(this.getRandomId());\r\n        }\r\n        for (let i in args) {\r\n            this.addRole(args[i]);\r\n        }\r\n        this.addRole(this.getRandomId());\r\n        setTimeout(() => {\r\n            let timer = TIMEMIN + this.wheelId * 0.2;\r\n            timer = !this.mainObj.auto ? TIMEMIN : timer;\r\n            this.node.runAction(\r\n                cc.sequence(\r\n                    cc.delayTime(0.2),\r\n                    cc.moveTo(timer, cc.v2(this.node.x, -this.node.height + 935)),\r\n                    cc.moveTo(0.1, cc.v2(this.node.x, -this.node.height + 850)),\r\n                    cc.moveTo(0.1, cc.v2(this.node.x, -this.node.height + 935)),\r\n                    cc.callFunc(this.rollCallBack.bind(this))\r\n                )\r\n            );\r\n        }, 100);\r\n    },\r\n\r\n    getRandomId() {\r\n        let randomId = 0;\r\n        while (randomId == 0) {\r\n            if (this.mainObj.freeTimes > 0 || this.mainObj.stopFree) {\r\n                let hashSet = null;\r\n                if (this.wheelId == 0 || this.wheelId == 2 || this.wheelId == 4) {\r\n                    hashSet = new Set([12, ...this.mainObj.bigWinResList]);\r\n                } else if (this.wheelId == 1 || this.wheelId == 3) {\r\n                    hashSet = new Set([11, ...this.mainObj.bigWinResList]);\r\n                }\r\n                randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);\r\n                randomId = hashSet.has(randomId) ? randomId : 0;\r\n            } else {\r\n                randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);\r\n                if (this.wheelId == 1 || this.wheelId == 3) {\r\n                    randomId = randomId == 11 ? 0 : randomId;\r\n                }\r\n            }\r\n            randomId = randomId == this.excludeId ? 0 : randomId;\r\n        };\r\n        return randomId;\r\n    },\r\n\r\n    addRole(id) {\r\n        let pb = cc.instantiate(this.mainObj.rolePb[id]);\r\n        this.rolePbList.push(pb);\r\n        this.roleIdList.push(id);\r\n        this.node.addChild(pb);\r\n    },\r\n\r\n    rollCallBack() {\r\n        this.audio.playStopWheel();\r\n        this.lastResult = this.roleIdList.slice(-5);\r\n        this.status = 0;\r\n        this.mainObj.stateCallBack();\r\n    },\r\n\r\n    stopImmediately() {\r\n        this.lastResult = this.roleIdList.slice(-5);\r\n        this.node.stopAllActions();\r\n        setTimeout(() => {\r\n            this.node.y = -this.node.height + 935;\r\n        }, 50);\r\n        this.status = 0;\r\n        this.mainObj.stateCallBack();\r\n    },\r\n});"]}