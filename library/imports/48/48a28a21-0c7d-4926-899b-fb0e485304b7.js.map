{"version":3,"sources":["assets\\Script\\Fish\\BulletCtrl.js"],"names":["bulletJL","speedJL","cc","Class","Component","properties","spList","SpriteFrame","init","fishMain","seatId","pos","angle","roombet","speed","getComponent","Sprite","spriteFrame","node","position","roomBet","update","dt","x","Math","sin","PI","y","cos","onCollisionEnter","other","self","com","fishNode","fishsc","isLockFish","autoId","fishId","checkFishId","net","getNet","parent","netBg","point","v2","width","height","Animation","play","index","runAction","sequence","delayTime","callFunc","netPool","put","playEffect","bulletPool","ac","_getActionByTag","tintTo","setTag","playerinfo","require","getInstant","fishNet","mes","bulletId","uid","userID","fishSocket","emit","JSON","stringify","tag","target","Action","TAG_INVALID","logID","element","director","getActionManager","_hashTargets","_id","actions","i","length","action","getTag"],"mappings":"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","sourceRoot":"/","sourcesContent":["const bulletJL = {\r\n    '1': 0,\r\n    '2': 1,\r\n    '3': 2,\r\n    '4': 3,\r\n    '5': 4\r\n};\r\n\r\nconst speedJL = {\r\n    '1': 10,\r\n    '2': 12,\r\n    '3': 15,\r\n    '4': 17,\r\n    '5': 20\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        spList: [cc.SpriteFrame], //炮弹sp\r\n    },\r\n\r\n    init(fishMain, seatId, pos, angle, roombet) {\r\n        this.fishMain = fishMain;\r\n        this.seatId = seatId;\r\n        this.speed = speedJL[roombet + ''];\r\n        this.getComponent(cc.Sprite).spriteFrame = this.spList[bulletJL[roombet + '']];\r\n        this.node.position = pos;\r\n        // this.node.rotation = angle;\r\n        this.node.angle = -angle;\r\n        this.roomBet = roombet;\r\n    },\r\n\r\n    update(dt) {\r\n        this.node.x += speedJL[this.roomBet] * Math.sin(-2 * Math.PI / 360 * this.node.angle);\r\n        this.node.y += speedJL[this.roomBet] * Math.cos(-2 * Math.PI / 360 * this.node.angle);\r\n        //边界检测 处理子弹反弹\r\n        if (this.node.x > 667) {\r\n            this.node.angle = 360 - this.node.angle;\r\n            this.node.x = 667;\r\n        } else if (this.node.x < -667) {\r\n            this.node.angle = 360 - this.node.angle;\r\n            this.node.x = -667;\r\n        } else if (this.node.y > 375) {\r\n            this.node.angle = 180 - this.node.angle;\r\n            this.node.y = 375;\r\n        } else if (this.node.y < -375) {\r\n            this.node.angle = 180 - this.node.angle;\r\n            this.node.y = -375;\r\n        }\r\n    },\r\n\r\n    onCollisionEnter: function (other, self) {\r\n        //渔网\r\n\r\n        var com = self.node.getComponent(\"BulletCtrl\");\r\n\r\n        var fishNode = other.node;\r\n        var fishsc = fishNode.getComponent(\"Fish\");\r\n\r\n        if (this.fishMain.isLockFish && com.autoId != fishsc.fishId && this.fishMain.checkFishId(com.autoId)) {\r\n            return;\r\n        }\r\n        for (var index = 0; index < 3; index++) {\r\n            let net = this.fishMain.getNet();\r\n            net.parent = this.fishMain.netBg;\r\n            // net.position = other.node.position;\r\n            var point = cc.v2(\r\n                this.node.x + other.node.width / 2 * Math.sin(-2 * Math.PI / 360 * this.node.angle),\r\n                this.node.y + other.node.height / 2 * Math.cos(-2 * Math.PI / 360 * this.node.angle)\r\n            );\r\n            net.getComponent(cc.Animation).play();\r\n            if (index == 0) {\r\n                point.x += 50 * Math.sin(-2 * Math.PI / 360 * this.node.angle);\r\n                point.y += 50 * Math.cos(2 * Math.PI / 360 * this.node.angle);\r\n            } else if (index == 1) {\r\n                point.x += 50 * Math.sin(-2 * Math.PI / 360 * (this.node.angle + 120));\r\n                point.y += 50 * Math.cos(2 * Math.PI / 360 * (this.node.angle + 120));\r\n            } else if (index == 2) {\r\n                point.x += 50 * Math.sin(-2 * Math.PI / 360 * (this.node.angle + 240));\r\n                point.y += 50 * Math.cos(-2 * Math.PI / 360 * (this.node.angle + 240));\r\n            }\r\n\r\n            net.position = point;\r\n\r\n            net.runAction(cc.sequence(\r\n                cc.delayTime(1.5),\r\n                cc.callFunc(() => {\r\n                    this.fishMain.netPool.put(net);\r\n                })\r\n            ))\r\n        }\r\n\r\n        playEffect('open_net');\r\n\r\n        this.fishMain.bulletPool.put(this.node);\r\n\r\n\r\n        var ac = this._getActionByTag(257, fishNode);\r\n        if (!ac) {\r\n            ac = cc.sequence(cc.tintTo(0.2, 50, 50, 50), cc.tintTo(0.2, 255, 255, 255), cc.tintTo(0.2, 50, 50, 50), cc.tintTo(0.2, 255, 255, 255));\r\n            ac.setTag(257);\r\n            fishNode.runAction(ac);\r\n        }\r\n\r\n        //this.node.removeComponent(cc.CircleCollider);\r\n\r\n        var playerinfo = require(\"PlayerInfo\").getInstant;\r\n\r\n        var fishNet = require(\"./FishNetWork\").getInstant;\r\n        var mes = {\r\n            fishId: fishsc.fishId,//fishInfo.fishId[0],\r\n            bulletId: self.node.getComponent(\"BulletCtrl\").bulletId,\r\n            //sendId: self.node.getComponent(\"BulletCtrl\").userID,\r\n            uid: self.node.getComponent(\"BulletCtrl\").userID,\r\n        }\r\n\r\n        if (false)//(self.node.getComponent(\"BulletCtrl\").userID == playerinfo.playerId)\r\n        {\r\n            fishNet.fishSocket.emit('fishHit_board', JSON.stringify(mes));\r\n        } else {\r\n            fishNet.fishSocket.emit('fishHit', JSON.stringify(mes));\r\n        }\r\n    },\r\n\r\n    _getActionByTag: function (tag, target) {\r\n        tag === cc.Action.TAG_INVALID && cc.logID(1004);\r\n        var element = cc.director.getActionManager()._hashTargets[target._id];\r\n        if (element) {\r\n            if (null != element.actions) for (var i = 0; i < element.actions.length; ++i) {\r\n                var action = element.actions[i];\r\n                if (action && action.getTag() === tag) return action;\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n\r\n});"]}