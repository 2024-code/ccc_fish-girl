{"version":3,"sources":["assets\\Script\\Lobby\\daili.js"],"names":["cc","Class","Component","properties","edit_box","EditBox","onLoad","url_","key_","start","node","getChildByName","active","onClick","event","customEventData","setDaili","string","txt","time","Math","floor","Date","now","key","sign","md5","uid","code","url","hturl","res","_request","pInfo","require","getInstant","MD5","currentTime","baseurl","apiUrl","hex_md5","playerId","console","log","instance","sendpost","response","getComponent","Label","msg","callback","str","xhr","XMLHttpRequest","onreadystatechange","readyState","status","JSON","parse","errot","open","setRequestHeader","send"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        edit_box:cc.EditBox,\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.url_=\"http://game.bullsts.com/index.php/agent/api/uidcode\"; //太子城版本\n        //this.url_=\"http://jinboadmin.youmegame.cn/index.php/agent/api/uidcode\"; //金博娱乐版本\n        this.key_= \"fdgkl5rtlk4mfdv\";\n    },\n\n    start () {\n        this.node.getChildByName('dl_ui').active = false;\n        this.node.getChildByName('messagebox').active = false;\n    },\n\n    onClick(event,customEventData)\n    {\n        if (customEventData == \"close\"){\n            this.node.active = false;\n        }else if (customEventData == \"sure\"){\n            this.setDaili(this.edit_box.string);\n        }else if (customEventData == 'message'){\n            this.node.getChildByName('dl_ui').active = true;\n            this.node.getChildByName('messagebox').active = false;\n            //this.node.active = false;\n        }\n    },\n\n    setDaili(txt) {\n        if (txt == \"\") return;\n    \n        var time = Math.floor(Date.now() / 1000);\n        var key = 'fdgkl5rtlk4mfdv';\n        var sign = md5(time + key); // 假设md5函数已定义并可用\n        var uid = 1000;\n        var code = '025679';\n        var url = this.hturl + \"/index.php/agent/api/uidcode/time/\" + time + \"/sign/\" + sign + \"/uid/\" + uid + \"/code/\" + code;\n        var res = this._request(url);\n    \n        var pInfo = require('PlayerInfo').getInstant();\n        var MD5 = require(\"md5\").getInstant();\n        var currentTime = Math.floor(Date.now() / 1000);\n    \n        var baseurl = this.url_;\n        var apiUrl = \"/time/\" + currentTime + \"/sign/\" + MD5.hex_md5(currentTime + this.key_) + \"/uid/\" + pInfo.playerId + \"/code/\" + txt;\n        var url = baseurl + apiUrl;\n    \n        console.log(\"pInfo:\", pInfo, \"url:\", url);\n        \n        let instance = this;\n        this.sendpost(url, function (response) {\n            // if (response.status === 1) {\n            //     //成功\n            // }else{\n            //     //失败\n            // }\n            instance.node.getChildByName('dl_ui').active = false;\n            instance.node.getChildByName('messagebox').active = true;\n            instance.node.getChildByName('messagebox').getChildByName('lb_Tips').getComponent(cc.Label).string = response.msg;\n        }, \"\");\n    },\n    // update (dt) {},\n\n    sendpost: function (url, callback, str) {\n        var xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4 && xhr.status === 200) {\n                var response = xhr.response;\n                //console.log(response);\n\n                if (null !== xhr.response !== null) {\n                    try {\n                        response = JSON.parse(response);\n                    }\n                    catch (errot) {\n                        //  cc.log(\"JSON wrong\");\n                    }\n                    callback && callback(response);\n                }\n            }\n        };\n        xhr.open(\"POST\", url);\n        xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded;\");\n        xhr.send(str);\n    },\n});\n"]}