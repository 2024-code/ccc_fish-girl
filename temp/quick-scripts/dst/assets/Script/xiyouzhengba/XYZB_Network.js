
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/xiyouzhengba/XYZB_Network.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6d0b4avultBX5vMi1oMFOYH', 'XYZB_Network');
// Script/xiyouzhengba/XYZB_Network.js

"use strict";

cc.Class({
  "extends": cc.Component,
  onLoad: function onLoad() {
    this.playerInfo = require("PlayerInfo").getInstant;
    this.gameMain = this.node.getComponent('XYZB_Main');
    this.sign = this.playerInfo.gameSign;
    this.userId = this.playerInfo.playerId;
    this.port = ':16001';
    this.timer = 0; //连接网络

    if (cc.sys.isNative) {
      this.socket = SocketIO.connect(Lhjconfig.Server_IP + this.port);
    } else {
      var socket = require("socket-io");

      this.socket = socket(Lhjconfig.Server_IP + this.port);
    }

    this.registEvent();
  },
  registEvent: function registEvent() {
    var _this = this;

    this.socket.on("connected", function (ret) {
      cc.log('connected:' + ret);

      if (ret) {
        _this.socket.emit("LoginGame", JSON.stringify({
          userid: _this.userId,
          //用户ID
          gametype: 11,
          //游戏类型
          sign: _this.sign //签名

        }));
      }
    });
    this.socket.on("loginGameResult", function (ret) {
      var result = _this.changeResultJSON_Function(ret);

      cc.log('游戏登陆成功=======================' + JSON.stringify(result));
      _this.userName = result.Obj.nickname;
      _this.userCoin = result.Obj.score / 100;
      _this.headUrl = result.Obj.headimgurl;
      XYZB_LOBBYNET.disconnect();

      if (result.resultid) {
        //游戏登录成功
        _this.gameMain.showInfo();

        _this.socket.emit('getGameRecord');
      } else {
        cc.log(result.msg);
      }
    });
    this.socket.on("BetStart", function (ret) {
      cc.log('BetStart:', ret);

      _this.socket.emit('getGameRecord');

      _this.timer = new Date().getTime() / 1000;

      _this.gameMain.startBets();
    });
    this.socket.on("OpenWinResult", function (ret) {
      cc.log('OpenWinResult:', ret);

      var result = _this.changeResultJSON_Function(ret);

      if (result.ResultCode) {
        _this.userCoin = result.score / 100;

        _this.gameMain.getResult(result);
      }
    });
    this.socket.on("lotteryResult", function (ret) {
      cc.log('lotteryResult:', ret);

      var result = _this.changeResultJSON_Function(ret);

      if (result.ResultCode) {}
    });
    this.socket.on("getGameRecordResult", function (ret) {
      cc.log('getGameRecordResult:', ret);

      var result = _this.changeResultJSON_Function(ret);

      var historyList = _this.gameMain.historyNode.children;

      for (var i in historyList) {
        historyList[i].active = false;
      }

      if (result.game_record.length > 0) {
        for (var _i in result.game_record) {
          var winN = result.game_record[_i].win_num[0];
          winN = winN == 0 || winN == 13 ? result.game_record[_i].win_num[1] : winN;
          var zxh = result.game_record[_i].win_special_num;
          historyList[_i].active = true;
          historyList[_i].getComponent(cc.Sprite).spriteFrame = _this.gameMain.cartoonSp[winN];
          historyList[_i].getChildByName('icon_he').getComponent(cc.Sprite).spriteFrame = _this.gameMain.zxhSp[zxh];
        }
      }
    });
    this.socket.on("BetStop", function (ret) {
      cc.log('BetStop:', ret);

      _this.gameMain.closeBets();
    });
  },
  changeResultJSON_Function: function changeResultJSON_Function(ret) {
    if (cc.sys.isNative) {
      return JSON.parse(ret);
    }

    return ret;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFx4aXlvdXpoZW5nYmFcXFhZWkJfTmV0d29yay5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50Iiwib25Mb2FkIiwicGxheWVySW5mbyIsInJlcXVpcmUiLCJnZXRJbnN0YW50IiwiZ2FtZU1haW4iLCJub2RlIiwiZ2V0Q29tcG9uZW50Iiwic2lnbiIsImdhbWVTaWduIiwidXNlcklkIiwicGxheWVySWQiLCJwb3J0IiwidGltZXIiLCJzeXMiLCJpc05hdGl2ZSIsInNvY2tldCIsIlNvY2tldElPIiwiY29ubmVjdCIsIkxoamNvbmZpZyIsIlNlcnZlcl9JUCIsInJlZ2lzdEV2ZW50Iiwib24iLCJyZXQiLCJsb2ciLCJlbWl0IiwiSlNPTiIsInN0cmluZ2lmeSIsInVzZXJpZCIsImdhbWV0eXBlIiwicmVzdWx0IiwiY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbiIsInVzZXJOYW1lIiwiT2JqIiwibmlja25hbWUiLCJ1c2VyQ29pbiIsInNjb3JlIiwiaGVhZFVybCIsImhlYWRpbWd1cmwiLCJYWVpCX0xPQkJZTkVUIiwiZGlzY29ubmVjdCIsInJlc3VsdGlkIiwic2hvd0luZm8iLCJtc2ciLCJEYXRlIiwiZ2V0VGltZSIsInN0YXJ0QmV0cyIsIlJlc3VsdENvZGUiLCJnZXRSZXN1bHQiLCJoaXN0b3J5TGlzdCIsImhpc3RvcnlOb2RlIiwiY2hpbGRyZW4iLCJpIiwiYWN0aXZlIiwiZ2FtZV9yZWNvcmQiLCJsZW5ndGgiLCJ3aW5OIiwid2luX251bSIsInp4aCIsIndpbl9zcGVjaWFsX251bSIsIlNwcml0ZSIsInNwcml0ZUZyYW1lIiwiY2FydG9vblNwIiwiZ2V0Q2hpbGRCeU5hbWUiLCJ6eGhTcCIsImNsb3NlQmV0cyIsInBhcnNlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxNQUhL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RUFBMEIsVUFBQUMsR0FBRyxFQUFJO0FBQzdCekIsTUFBQUEsRUFBRSxDQUFDMEIsR0FBSCxDQUFPLFVBQVAsRUFBbUJELEdBQW5COztBQUNBLE1BQUEsS0FBSSxDQUFDbEIsUUFBTCxDQUFjNEQsU0FBZDtBQUNILEtBSEQ7QUFJSCxHQTlGSTtBQWdHTGxDLEVBQUFBLHlCQWhHSyxxQ0FnR3FCUixHQWhHckIsRUFnRzBCO0FBQzNCLFFBQUl6QixFQUFFLENBQUNnQixHQUFILENBQU9DLFFBQVgsRUFBcUI7QUFDakIsYUFBT1csSUFBSSxDQUFDd0MsS0FBTCxDQUFXM0MsR0FBWCxDQUFQO0FBQ0g7O0FBQ0QsV0FBT0EsR0FBUDtBQUNIO0FBckdJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBvbkxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5wbGF5ZXJJbmZvID0gcmVxdWlyZShcIlBsYXllckluZm9cIikuZ2V0SW5zdGFudDtcclxuICAgICAgICB0aGlzLmdhbWVNYWluID0gdGhpcy5ub2RlLmdldENvbXBvbmVudCgnWFlaQl9NYWluJyk7XHJcbiAgICAgICAgdGhpcy5zaWduID0gdGhpcy5wbGF5ZXJJbmZvLmdhbWVTaWduO1xyXG4gICAgICAgIHRoaXMudXNlcklkID0gdGhpcy5wbGF5ZXJJbmZvLnBsYXllcklkO1xyXG4gICAgICAgIHRoaXMucG9ydCA9ICc6MTYwMDEnO1xyXG4gICAgICAgIHRoaXMudGltZXIgPSAwO1xyXG4gICAgICAgIC8v6L+e5o6l572R57ucXHJcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnNvY2tldCA9IFNvY2tldElPLmNvbm5lY3QoTGhqY29uZmlnLlNlcnZlcl9JUCArIHRoaXMucG9ydCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IHNvY2tldCA9IHJlcXVpcmUoXCJzb2NrZXQtaW9cIik7XHJcbiAgICAgICAgICAgIHRoaXMuc29ja2V0ID0gc29ja2V0KExoamNvbmZpZy5TZXJ2ZXJfSVAgKyB0aGlzLnBvcnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlZ2lzdEV2ZW50KCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHJlZ2lzdEV2ZW50KCkge1xyXG4gICAgICAgIHRoaXMuc29ja2V0Lm9uKFwiY29ubmVjdGVkXCIsIHJldCA9PiB7XHJcbiAgICAgICAgICAgIGNjLmxvZygnY29ubmVjdGVkOicgKyByZXQpO1xyXG4gICAgICAgICAgICBpZiAocmV0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5lbWl0KFwiTG9naW5HYW1lXCIsIEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgICAgICB1c2VyaWQ6IHRoaXMudXNlcklkLCAvL+eUqOaIt0lEXHJcbiAgICAgICAgICAgICAgICAgICAgZ2FtZXR5cGU6IDExLCAvL+a4uOaIj+exu+Wei1xyXG4gICAgICAgICAgICAgICAgICAgIHNpZ246IHRoaXMuc2lnbiAvL+etvuWQjVxyXG4gICAgICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMuc29ja2V0Lm9uKFwibG9naW5HYW1lUmVzdWx0XCIsIHJldCA9PiB7XHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0aGlzLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24ocmV0KTtcclxuICAgICAgICAgICAgY2MubG9nKCfmuLjmiI/nmbvpmYbmiJDlip89PT09PT09PT09PT09PT09PT09PT09PScgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTtcclxuICAgICAgICAgICAgdGhpcy51c2VyTmFtZSA9IHJlc3VsdC5PYmoubmlja25hbWU7XHJcbiAgICAgICAgICAgIHRoaXMudXNlckNvaW4gPSByZXN1bHQuT2JqLnNjb3JlIC8gMTAwO1xyXG4gICAgICAgICAgICB0aGlzLmhlYWRVcmwgPSByZXN1bHQuT2JqLmhlYWRpbWd1cmw7XHJcbiAgICAgICAgICAgIFhZWkJfTE9CQllORVQuZGlzY29ubmVjdCgpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0LnJlc3VsdGlkKSB7IC8v5ri45oiP55m75b2V5oiQ5YqfXHJcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWVNYWluLnNob3dJbmZvKCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5lbWl0KCdnZXRHYW1lUmVjb3JkJyk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjYy5sb2cocmVzdWx0Lm1zZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zb2NrZXQub24oXCJCZXRTdGFydFwiLCByZXQgPT4ge1xyXG4gICAgICAgICAgICBjYy5sb2coJ0JldFN0YXJ0OicsIHJldCk7XHJcbiAgICAgICAgICAgIHRoaXMuc29ja2V0LmVtaXQoJ2dldEdhbWVSZWNvcmQnKTtcclxuICAgICAgICAgICAgdGhpcy50aW1lciA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC8gMTAwMDtcclxuICAgICAgICAgICAgdGhpcy5nYW1lTWFpbi5zdGFydEJldHMoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zb2NrZXQub24oXCJPcGVuV2luUmVzdWx0XCIsIHJldCA9PiB7XHJcbiAgICAgICAgICAgIGNjLmxvZygnT3BlbldpblJlc3VsdDonLCByZXQpO1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJldCk7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuUmVzdWx0Q29kZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51c2VyQ29pbiA9IHJlc3VsdC5zY29yZSAvIDEwMDtcclxuICAgICAgICAgICAgICAgIHRoaXMuZ2FtZU1haW4uZ2V0UmVzdWx0KHJlc3VsdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zb2NrZXQub24oXCJsb3R0ZXJ5UmVzdWx0XCIsIHJldCA9PiB7XHJcbiAgICAgICAgICAgIGNjLmxvZygnbG90dGVyeVJlc3VsdDonLCByZXQpO1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gdGhpcy5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJldCk7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQuUmVzdWx0Q29kZSkge1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnNvY2tldC5vbihcImdldEdhbWVSZWNvcmRSZXN1bHRcIiwgcmV0ID0+IHtcclxuICAgICAgICAgICAgY2MubG9nKCdnZXRHYW1lUmVjb3JkUmVzdWx0OicsIHJldCk7XHJcbiAgICAgICAgICAgIGxldCByZXN1bHQgPSB0aGlzLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24ocmV0KTtcclxuICAgICAgICAgICAgbGV0IGhpc3RvcnlMaXN0ID0gdGhpcy5nYW1lTWFpbi5oaXN0b3J5Tm9kZS5jaGlsZHJlbjtcclxuICAgICAgICAgICAgZm9yIChsZXQgaSBpbiBoaXN0b3J5TGlzdCkge1xyXG4gICAgICAgICAgICAgICAgaGlzdG9yeUxpc3RbaV0uYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5nYW1lX3JlY29yZC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpIGluIHJlc3VsdC5nYW1lX3JlY29yZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB3aW5OID0gcmVzdWx0LmdhbWVfcmVjb3JkW2ldLndpbl9udW1bMF07XHJcbiAgICAgICAgICAgICAgICAgICAgd2luTiA9ICh3aW5OID09IDAgfHwgd2luTiA9PSAxMykgPyByZXN1bHQuZ2FtZV9yZWNvcmRbaV0ud2luX251bVsxXSA6IHdpbk47XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHp4aCA9IHJlc3VsdC5nYW1lX3JlY29yZFtpXS53aW5fc3BlY2lhbF9udW07XHJcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeUxpc3RbaV0uYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBoaXN0b3J5TGlzdFtpXS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHRoaXMuZ2FtZU1haW4uY2FydG9vblNwW3dpbk5dO1xyXG4gICAgICAgICAgICAgICAgICAgIGhpc3RvcnlMaXN0W2ldLmdldENoaWxkQnlOYW1lKCdpY29uX2hlJykuZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSkuc3ByaXRlRnJhbWUgPSB0aGlzLmdhbWVNYWluLnp4aFNwW3p4aF07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdGhpcy5zb2NrZXQub24oXCJCZXRTdG9wXCIsIHJldCA9PiB7XHJcbiAgICAgICAgICAgIGNjLmxvZygnQmV0U3RvcDonLCByZXQpO1xyXG4gICAgICAgICAgICB0aGlzLmdhbWVNYWluLmNsb3NlQmV0cygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSxcclxuXHJcbiAgICBjaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJldCkge1xyXG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmV0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJldDtcclxuICAgIH0sXHJcbn0pOyJdfQ==