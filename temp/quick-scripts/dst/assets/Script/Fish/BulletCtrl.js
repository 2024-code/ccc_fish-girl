
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Fish/BulletCtrl.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '48a28ohDH1JJomb+w5IUwS3', 'BulletCtrl');
// Script/Fish/BulletCtrl.js

"use strict";

var bulletJL = {
  '1': 0,
  '2': 1,
  '3': 2,
  '4': 3,
  '5': 4
};
var speedJL = {
  '1': 10,
  '2': 12,
  '3': 15,
  '4': 17,
  '5': 20
};
cc.Class({
  "extends": cc.Component,
  properties: {
    spList: [cc.SpriteFrame] //炮弹sp

  },
  init: function init(fishMain, seatId, pos, angle, roombet) {
    this.fishMain = fishMain;
    this.seatId = seatId;
    this.speed = speedJL[roombet + ''];
    this.getComponent(cc.Sprite).spriteFrame = this.spList[bulletJL[roombet + '']];
    this.node.position = pos; // this.node.rotation = angle;

    this.node.angle = -angle;
    this.roomBet = roombet;
  },
  update: function update(dt) {
    this.node.x += speedJL[this.roomBet] * Math.sin(-2 * Math.PI / 360 * this.node.angle);
    this.node.y += speedJL[this.roomBet] * Math.cos(-2 * Math.PI / 360 * this.node.angle); //边界检测 处理子弹反弹

    if (this.node.x > 667) {
      this.node.angle = 360 - this.node.angle;
      this.node.x = 667;
    } else if (this.node.x < -667) {
      this.node.angle = 360 - this.node.angle;
      this.node.x = -667;
    } else if (this.node.y > 375) {
      this.node.angle = 180 - this.node.angle;
      this.node.y = 375;
    } else if (this.node.y < -375) {
      this.node.angle = 180 - this.node.angle;
      this.node.y = -375;
    }
  },
  onCollisionEnter: function onCollisionEnter(other, self) {
    var _this = this;

    //渔网
    var com = self.node.getComponent("BulletCtrl");
    var fishNode = other.node;
    var fishsc = fishNode.getComponent("Fish");

    if (this.fishMain.isLockFish && com.autoId != fishsc.fishId && this.fishMain.checkFishId(com.autoId)) {
      return;
    }

    var _loop = function _loop() {
      var net = _this.fishMain.getNet();

      net.parent = _this.fishMain.netBg; // net.position = other.node.position;

      point = cc.v2(_this.node.x + other.node.width / 2 * Math.sin(-2 * Math.PI / 360 * _this.node.angle), _this.node.y + other.node.height / 2 * Math.cos(-2 * Math.PI / 360 * _this.node.angle));
      net.getComponent(cc.Animation).play();

      if (index == 0) {
        point.x += 50 * Math.sin(-2 * Math.PI / 360 * _this.node.angle);
        point.y += 50 * Math.cos(2 * Math.PI / 360 * _this.node.angle);
      } else if (index == 1) {
        point.x += 50 * Math.sin(-2 * Math.PI / 360 * (_this.node.angle + 120));
        point.y += 50 * Math.cos(2 * Math.PI / 360 * (_this.node.angle + 120));
      } else if (index == 2) {
        point.x += 50 * Math.sin(-2 * Math.PI / 360 * (_this.node.angle + 240));
        point.y += 50 * Math.cos(-2 * Math.PI / 360 * (_this.node.angle + 240));
      }

      net.position = point;
      net.runAction(cc.sequence(cc.delayTime(1.5), cc.callFunc(function () {
        _this.fishMain.netPool.put(net);
      })));
    };

    for (var index = 0; index < 3; index++) {
      var point;

      _loop();
    }

    playEffect('open_net');
    this.fishMain.bulletPool.put(this.node);

    var ac = this._getActionByTag(257, fishNode);

    if (!ac) {
      ac = cc.sequence(cc.tintTo(0.2, 50, 50, 50), cc.tintTo(0.2, 255, 255, 255), cc.tintTo(0.2, 50, 50, 50), cc.tintTo(0.2, 255, 255, 255));
      ac.setTag(257);
      fishNode.runAction(ac);
    } //this.node.removeComponent(cc.CircleCollider);


    var playerinfo = require("PlayerInfo").getInstant;

    var fishNet = require("./FishNetWork").getInstant;

    var mes = {
      fishId: fishsc.fishId,
      //fishInfo.fishId[0],
      bulletId: self.node.getComponent("BulletCtrl").bulletId,
      //sendId: self.node.getComponent("BulletCtrl").userID,
      uid: self.node.getComponent("BulletCtrl").userID
    };

    if (false) //(self.node.getComponent("BulletCtrl").userID == playerinfo.playerId)
      {
        fishNet.fishSocket.emit('fishHit_board', JSON.stringify(mes));
      } else {
      fishNet.fishSocket.emit('fishHit', JSON.stringify(mes));
    }
  },
  _getActionByTag: function _getActionByTag(tag, target) {
    tag === cc.Action.TAG_INVALID && cc.logID(1004);

    var element = cc.director.getActionManager()._hashTargets[target._id];

    if (element) {
      if (null != element.actions) for (var i = 0; i < element.actions.length; ++i) {
        var action = element.actions[i];
        if (action && action.getTag() === tag) return action;
      }
    }

    return null;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxGaXNoXFxCdWxsZXRDdHJsLmpzIl0sIm5hbWVzIjpbImJ1bGxldEpMIiwic3BlZWRKTCIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwic3BMaXN0IiwiU3ByaXRlRnJhbWUiLCJpbml0IiwiZmlzaE1haW4iLCJzZWF0SWQiLCJwb3MiLCJhbmdsZSIsInJvb21iZXQiLCJzcGVlZCIsImdldENvbXBvbmVudCIsIlNwcml0ZSIsInNwcml0ZUZyYW1lIiwibm9kZSIsInBvc2l0aW9uIiwicm9vbUJldCIsInVwZGF0ZSIsImR0IiwieCIsIk1hdGgiLCJzaW4iLCJQSSIsInkiLCJjb3MiLCJvbkNvbGxpc2lvbkVudGVyIiwib3RoZXIiLCJzZWxmIiwiY29tIiwiZmlzaE5vZGUiLCJmaXNoc2MiLCJpc0xvY2tGaXNoIiwiYXV0b0lkIiwiZmlzaElkIiwiY2hlY2tGaXNoSWQiLCJuZXQiLCJnZXROZXQiLCJwYXJlbnQiLCJuZXRCZyIsInBvaW50IiwidjIiLCJ3aWR0aCIsImhlaWdodCIsIkFuaW1hdGlvbiIsInBsYXkiLCJpbmRleCIsInJ1bkFjdGlvbiIsInNlcXVlbmNlIiwiZGVsYXlUaW1lIiwiY2FsbEZ1bmMiLCJuZXRQb29sIiwicHV0IiwicGxheUVmZmVjdCIsImJ1bGxldFBvb2wiLCJhYyIsIl9nZXRBY3Rpb25CeVRhZyIsInRpbnRUbyIsInNldFRhZyIsInBsYXllcmluZm8iLCJyZXF1aXJlIiwiZ2V0SW5zdGFudCIsImZpc2hOZXQiLCJtZXMiLCJidWxsZXRJZCIsInVpZCIsInVzZXJJRCIsImZpc2hTb2NrZXQiLCJlbWl0IiwiSlNPTiIsInN0cmluZ2lmeSIsInRhZyIsInRhcmdldCIsIkFjdGlvbiIsIlRBR19JTlZBTElEIiwibG9nSUQiLCJlbGVtZW50IiwiZGlyZWN0b3IiLCJnZXRBY3Rpb25NYW5hZ2VyIiwiX2hhc2hUYXJnZXRzIiwiX2lkIiwiYWN0aW9ucyIsImkiLCJsZW5ndGgiLCJhY3Rp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O0FBQ0gsT0FIRCxNQUdPO0FBQ0hELE1BQUFBLE9BQU8sQ0FBQ0ssVUFBUixDQUFtQkMsSUFBbkIsQ0FBd0IsU0FBeEIsRUFBbUNDLElBQUksQ0FBQ0MsU0FBTCxDQUFlUCxHQUFmLENBQW5DO0FBQ0g7QUFDSixHQTVHSTtBQThHTFAsRUFBQUEsZUFBZSxFQUFFLHlCQUFVZSxHQUFWLEVBQWVDLE1BQWYsRUFBdUI7QUFDcENELElBQUFBLEdBQUcsS0FBS3hFLEVBQUUsQ0FBQzBFLE1BQUgsQ0FBVUMsV0FBbEIsSUFBaUMzRSxFQUFFLENBQUM0RSxLQUFILENBQVMsSUFBVCxDQUFqQzs7QUFDQSxRQUFJQyxPQUFPLEdBQUc3RSxFQUFFLENBQUM4RSxRQUFILENBQVlDLGdCQUFaLEdBQStCQyxZQUEvQixDQUE0Q1AsTUFBTSxDQUFDUSxHQUFuRCxDQUFkOztBQUNBLFFBQUlKLE9BQUosRUFBYTtBQUNULFVBQUksUUFBUUEsT0FBTyxDQUFDSyxPQUFwQixFQUE2QixLQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdOLE9BQU8sQ0FBQ0ssT0FBUixDQUFnQkUsTUFBcEMsRUFBNEMsRUFBRUQsQ0FBOUMsRUFBaUQ7QUFDMUUsWUFBSUUsTUFBTSxHQUFHUixPQUFPLENBQUNLLE9BQVIsQ0FBZ0JDLENBQWhCLENBQWI7QUFDQSxZQUFJRSxNQUFNLElBQUlBLE1BQU0sQ0FBQ0MsTUFBUCxPQUFvQmQsR0FBbEMsRUFBdUMsT0FBT2EsTUFBUDtBQUMxQztBQUNKOztBQUNELFdBQU8sSUFBUDtBQUNIO0FBeEhJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGJ1bGxldEpMID0ge1xyXG4gICAgJzEnOiAwLFxyXG4gICAgJzInOiAxLFxyXG4gICAgJzMnOiAyLFxyXG4gICAgJzQnOiAzLFxyXG4gICAgJzUnOiA0XHJcbn07XHJcblxyXG5jb25zdCBzcGVlZEpMID0ge1xyXG4gICAgJzEnOiAxMCxcclxuICAgICcyJzogMTIsXHJcbiAgICAnMyc6IDE1LFxyXG4gICAgJzQnOiAxNyxcclxuICAgICc1JzogMjBcclxufTtcclxuXHJcbmNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgc3BMaXN0OiBbY2MuU3ByaXRlRnJhbWVdLCAvL+eCruW8uXNwXHJcbiAgICB9LFxyXG5cclxuICAgIGluaXQoZmlzaE1haW4sIHNlYXRJZCwgcG9zLCBhbmdsZSwgcm9vbWJldCkge1xyXG4gICAgICAgIHRoaXMuZmlzaE1haW4gPSBmaXNoTWFpbjtcclxuICAgICAgICB0aGlzLnNlYXRJZCA9IHNlYXRJZDtcclxuICAgICAgICB0aGlzLnNwZWVkID0gc3BlZWRKTFtyb29tYmV0ICsgJyddO1xyXG4gICAgICAgIHRoaXMuZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSkuc3ByaXRlRnJhbWUgPSB0aGlzLnNwTGlzdFtidWxsZXRKTFtyb29tYmV0ICsgJyddXTtcclxuICAgICAgICB0aGlzLm5vZGUucG9zaXRpb24gPSBwb3M7XHJcbiAgICAgICAgLy8gdGhpcy5ub2RlLnJvdGF0aW9uID0gYW5nbGU7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gLWFuZ2xlO1xyXG4gICAgICAgIHRoaXMucm9vbUJldCA9IHJvb21iZXQ7XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZShkdCkge1xyXG4gICAgICAgIHRoaXMubm9kZS54ICs9IHNwZWVkSkxbdGhpcy5yb29tQmV0XSAqIE1hdGguc2luKC0yICogTWF0aC5QSSAvIDM2MCAqIHRoaXMubm9kZS5hbmdsZSk7XHJcbiAgICAgICAgdGhpcy5ub2RlLnkgKz0gc3BlZWRKTFt0aGlzLnJvb21CZXRdICogTWF0aC5jb3MoLTIgKiBNYXRoLlBJIC8gMzYwICogdGhpcy5ub2RlLmFuZ2xlKTtcclxuICAgICAgICAvL+i+ueeVjOajgOa1iyDlpITnkIblrZDlvLnlj43lvLlcclxuICAgICAgICBpZiAodGhpcy5ub2RlLnggPiA2NjcpIHtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gMzYwIC0gdGhpcy5ub2RlLmFuZ2xlO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUueCA9IDY2NztcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubm9kZS54IDwgLTY2Nykge1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUuYW5nbGUgPSAzNjAgLSB0aGlzLm5vZGUuYW5nbGU7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS54ID0gLTY2NztcclxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMubm9kZS55ID4gMzc1KSB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IDE4MCAtIHRoaXMubm9kZS5hbmdsZTtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLnkgPSAzNzU7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm5vZGUueSA8IC0zNzUpIHtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLmFuZ2xlID0gMTgwIC0gdGhpcy5ub2RlLmFuZ2xlO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUueSA9IC0zNzU7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBvbkNvbGxpc2lvbkVudGVyOiBmdW5jdGlvbiAob3RoZXIsIHNlbGYpIHtcclxuICAgICAgICAvL+a4lOe9kVxyXG5cclxuICAgICAgICB2YXIgY29tID0gc2VsZi5ub2RlLmdldENvbXBvbmVudChcIkJ1bGxldEN0cmxcIik7XHJcblxyXG4gICAgICAgIHZhciBmaXNoTm9kZSA9IG90aGVyLm5vZGU7XHJcbiAgICAgICAgdmFyIGZpc2hzYyA9IGZpc2hOb2RlLmdldENvbXBvbmVudChcIkZpc2hcIik7XHJcblxyXG4gICAgICAgIGlmICh0aGlzLmZpc2hNYWluLmlzTG9ja0Zpc2ggJiYgY29tLmF1dG9JZCAhPSBmaXNoc2MuZmlzaElkICYmIHRoaXMuZmlzaE1haW4uY2hlY2tGaXNoSWQoY29tLmF1dG9JZCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgMzsgaW5kZXgrKykge1xyXG4gICAgICAgICAgICBsZXQgbmV0ID0gdGhpcy5maXNoTWFpbi5nZXROZXQoKTtcclxuICAgICAgICAgICAgbmV0LnBhcmVudCA9IHRoaXMuZmlzaE1haW4ubmV0Qmc7XHJcbiAgICAgICAgICAgIC8vIG5ldC5wb3NpdGlvbiA9IG90aGVyLm5vZGUucG9zaXRpb247XHJcbiAgICAgICAgICAgIHZhciBwb2ludCA9IGNjLnYyKFxyXG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLnggKyBvdGhlci5ub2RlLndpZHRoIC8gMiAqIE1hdGguc2luKC0yICogTWF0aC5QSSAvIDM2MCAqIHRoaXMubm9kZS5hbmdsZSksXHJcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUueSArIG90aGVyLm5vZGUuaGVpZ2h0IC8gMiAqIE1hdGguY29zKC0yICogTWF0aC5QSSAvIDM2MCAqIHRoaXMubm9kZS5hbmdsZSlcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgbmV0LmdldENvbXBvbmVudChjYy5BbmltYXRpb24pLnBsYXkoKTtcclxuICAgICAgICAgICAgaWYgKGluZGV4ID09IDApIHtcclxuICAgICAgICAgICAgICAgIHBvaW50LnggKz0gNTAgKiBNYXRoLnNpbigtMiAqIE1hdGguUEkgLyAzNjAgKiB0aGlzLm5vZGUuYW5nbGUpO1xyXG4gICAgICAgICAgICAgICAgcG9pbnQueSArPSA1MCAqIE1hdGguY29zKDIgKiBNYXRoLlBJIC8gMzYwICogdGhpcy5ub2RlLmFuZ2xlKTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmIChpbmRleCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICBwb2ludC54ICs9IDUwICogTWF0aC5zaW4oLTIgKiBNYXRoLlBJIC8gMzYwICogKHRoaXMubm9kZS5hbmdsZSArIDEyMCkpO1xyXG4gICAgICAgICAgICAgICAgcG9pbnQueSArPSA1MCAqIE1hdGguY29zKDIgKiBNYXRoLlBJIC8gMzYwICogKHRoaXMubm9kZS5hbmdsZSArIDEyMCkpO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09IDIpIHtcclxuICAgICAgICAgICAgICAgIHBvaW50LnggKz0gNTAgKiBNYXRoLnNpbigtMiAqIE1hdGguUEkgLyAzNjAgKiAodGhpcy5ub2RlLmFuZ2xlICsgMjQwKSk7XHJcbiAgICAgICAgICAgICAgICBwb2ludC55ICs9IDUwICogTWF0aC5jb3MoLTIgKiBNYXRoLlBJIC8gMzYwICogKHRoaXMubm9kZS5hbmdsZSArIDI0MCkpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBuZXQucG9zaXRpb24gPSBwb2ludDtcclxuXHJcbiAgICAgICAgICAgIG5ldC5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoXHJcbiAgICAgICAgICAgICAgICBjYy5kZWxheVRpbWUoMS41KSxcclxuICAgICAgICAgICAgICAgIGNjLmNhbGxGdW5jKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZpc2hNYWluLm5ldFBvb2wucHV0KG5ldCk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApKVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcGxheUVmZmVjdCgnb3Blbl9uZXQnKTtcclxuXHJcbiAgICAgICAgdGhpcy5maXNoTWFpbi5idWxsZXRQb29sLnB1dCh0aGlzLm5vZGUpO1xyXG5cclxuXHJcbiAgICAgICAgdmFyIGFjID0gdGhpcy5fZ2V0QWN0aW9uQnlUYWcoMjU3LCBmaXNoTm9kZSk7XHJcbiAgICAgICAgaWYgKCFhYykge1xyXG4gICAgICAgICAgICBhYyA9IGNjLnNlcXVlbmNlKGNjLnRpbnRUbygwLjIsIDUwLCA1MCwgNTApLCBjYy50aW50VG8oMC4yLCAyNTUsIDI1NSwgMjU1KSwgY2MudGludFRvKDAuMiwgNTAsIDUwLCA1MCksIGNjLnRpbnRUbygwLjIsIDI1NSwgMjU1LCAyNTUpKTtcclxuICAgICAgICAgICAgYWMuc2V0VGFnKDI1Nyk7XHJcbiAgICAgICAgICAgIGZpc2hOb2RlLnJ1bkFjdGlvbihhYyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvL3RoaXMubm9kZS5yZW1vdmVDb21wb25lbnQoY2MuQ2lyY2xlQ29sbGlkZXIpO1xyXG5cclxuICAgICAgICB2YXIgcGxheWVyaW5mbyA9IHJlcXVpcmUoXCJQbGF5ZXJJbmZvXCIpLmdldEluc3RhbnQ7XHJcblxyXG4gICAgICAgIHZhciBmaXNoTmV0ID0gcmVxdWlyZShcIi4vRmlzaE5ldFdvcmtcIikuZ2V0SW5zdGFudDtcclxuICAgICAgICB2YXIgbWVzID0ge1xyXG4gICAgICAgICAgICBmaXNoSWQ6IGZpc2hzYy5maXNoSWQsLy9maXNoSW5mby5maXNoSWRbMF0sXHJcbiAgICAgICAgICAgIGJ1bGxldElkOiBzZWxmLm5vZGUuZ2V0Q29tcG9uZW50KFwiQnVsbGV0Q3RybFwiKS5idWxsZXRJZCxcclxuICAgICAgICAgICAgLy9zZW5kSWQ6IHNlbGYubm9kZS5nZXRDb21wb25lbnQoXCJCdWxsZXRDdHJsXCIpLnVzZXJJRCxcclxuICAgICAgICAgICAgdWlkOiBzZWxmLm5vZGUuZ2V0Q29tcG9uZW50KFwiQnVsbGV0Q3RybFwiKS51c2VySUQsXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZmFsc2UpLy8oc2VsZi5ub2RlLmdldENvbXBvbmVudChcIkJ1bGxldEN0cmxcIikudXNlcklEID09IHBsYXllcmluZm8ucGxheWVySWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBmaXNoTmV0LmZpc2hTb2NrZXQuZW1pdCgnZmlzaEhpdF9ib2FyZCcsIEpTT04uc3RyaW5naWZ5KG1lcykpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZpc2hOZXQuZmlzaFNvY2tldC5lbWl0KCdmaXNoSGl0JywgSlNPTi5zdHJpbmdpZnkobWVzKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBfZ2V0QWN0aW9uQnlUYWc6IGZ1bmN0aW9uICh0YWcsIHRhcmdldCkge1xyXG4gICAgICAgIHRhZyA9PT0gY2MuQWN0aW9uLlRBR19JTlZBTElEICYmIGNjLmxvZ0lEKDEwMDQpO1xyXG4gICAgICAgIHZhciBlbGVtZW50ID0gY2MuZGlyZWN0b3IuZ2V0QWN0aW9uTWFuYWdlcigpLl9oYXNoVGFyZ2V0c1t0YXJnZXQuX2lkXTtcclxuICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICBpZiAobnVsbCAhPSBlbGVtZW50LmFjdGlvbnMpIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudC5hY3Rpb25zLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gZWxlbWVudC5hY3Rpb25zW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbiAmJiBhY3Rpb24uZ2V0VGFnKCkgPT09IHRhZykgcmV0dXJuIGFjdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH0sXHJcblxyXG59KTsiXX0=