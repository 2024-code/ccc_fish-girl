
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Fish/FishNetWork.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '23d58PFGd5G8ZGyKHDS/Qog', 'FishNetWork');
// Script/Fish/FishNetWork.js

"use strict";

/**
 * 捕鱼达人SOCKET通讯
 */
var FishNetWork = function () {
  /**
   * 单例模式
   */
  function getInstant() {
    var _instance;

    if (_instance === undefined) {
      _instance = new Single();
    }

    return _instance;
  }
  /**
   * 逻辑层
   */


  function Single() {
    var _this = this;

    //TODO:变量初始化未完成
    this.lobbyMain = null;
    this.fishMain = null;
    this.fishSocket = null;
    this.playerInfo = null;
    this.eventMgr = null;
    this.userList = null;
    this.tableId = -1;
    this.seatId = -1;
    this.seatIndex = -1;
    this.roomBet = 1;
    /**
     * 初始化
     */

    this.init = function () {
      _this.playerInfo = require("PlayerInfo").getInstant;
    };
    /**
     * 进入游戏
     * @param {*} loginIP 
     * @param {*} port 
     * @param {*} userid 
     * @param {*} sign 
     */


    var self = this;

    self.loginGame_Function = function (loginIP, port, userid, sign) {
      var socket = null;

      if (cc.sys.isNative) {
        self.fishSocket = SocketIO.connect(loginIP + ":" + port);
      } else {
        socket = require("socket-io");
        self.fishSocket = socket(loginIP + ":" + port);
      } //连接失败


      self.fishSocket.on("error", function () {
        try {
          cc.sys.isBrowser && self.fishSocket.close();
          self.fishSocket = null;
          self.playerInfo.gameDisconnect || self.lobbyMain.contentGameServerFail_Function("Fish");
        } catch (e) {
          self.fishMain.openAlert();
        }
      }); //连接失败

      self.fishSocket.on("connect_error", function () {
        try {
          cc.sys.isBrowser && self.fishSocket.close();
          self.fishSocket = null;
          self.playerInfo.gameDisconnect || self.lobbyMain.contentGameServerFail_Function("Fish");
        } catch (e) {
          self.fishMain.openAlert();
        }
      }); //连接超时

      self.fishSocket.on("connect_timeout", function () {
        try {
          cc.sys.isBrowser && self.fishSocket.close();
          self.fishSocket = null;
          self.playerInfo.gameDisconnect || self.lobbyMain.contentGameServerFail_Function("Fish");
        } catch (e) {
          self.fishMain.openAlert();
        }
      }); //连接

      self.fishSocket.on("connected", function (ret) {
        if (ret) {
          try {
            //进入游戏
            self.fishSocket.emit("LoginGame", {
              userid: userid,
              //用户ID
              gametype: 11,
              //游戏类型
              sign: sign //签名

            });
          } catch (error) {}
        }
      });
      self.fishSocket.on("loginGameResult", function (ret) {
        var result = self.changeResultJSON_Function(ret); //console.log('游戏登陆成功=======================' + JSON.stringify(result));

        if (result.resultid) {
          //游戏登录成功
          self.roomBet = result.Obj.bet;
          self.playerInfo.playerCoin = result.Obj.score;
          self.lobbyMain.getComponent("LobbyMain").netWork.socket.disconnect();
          self.setFishSocketOn_Fuction();
          self.loginRoom_Function();
          cc.find("Canvas/buttonCtrl").getComponent("LobbyButtonClick").QieHuanScene_normal("FishMain", function () {
            self.fishSocket.emit("LoginRoom", {
              //登录游戏房间接口 roomid传 1 就好
              roomid: 1
            });
          });
        } else {
          //游戏登录失败
          if (self.lobbyMain.com_Tips) {
            self.lobbyMain.getComponent("LobbyMain").loadGameScene = false;
            self.lobbyMain.getComponent("LobbyMain").showMessagebox_Function(result.msg, 1, 4);
          } else {
            self.fishMain.openAlert();
          }
        }
      });
    };
    /**
     * 进入房间
     */


    self.loginRoom_Function = function () {
      //返回房间数据
      self.fishSocket.on("LoginRoomResult", function (ret) {
        var result = self.changeResultJSON_Function(ret);

        if (result.ResultCode) {
          self.tableId = result.ResultData.TableId;
          self.seatId = result.ResultData.seatId; //所有用户信息 userId: 3120, seatId: 0, nickname: "cv123456", score: 1004900, userType: 0,

          self.userList = result.ResultData.userList;
          self.playerInfo.gameDisconnect = false;
          self.playerInfo.gameName = "Fish";
          cc.audioEngine.stopAll();
          self.fishMain.start_();
        }
      });
    };
    /**
     * 长连通讯
     */


    self.setFishSocketOn_Fuction = function () {
      var _this2 = this;

      //击杀结果
      self.fishSocket.on('HitResult', function (res) {
        //console.log('hit: '+res);
        var result = self.changeResultJSON_Function(res);

        if (result.ResultCode == 1) {
          self.fishMain.onFishHit(result.ResultData);
        }
      }); //鱼进入场景

      self.fishSocket.on('FishOut', function (res) {
        // {"fishId":[7217],"fishType":18,"fishPath":13,"fishCount":1,"fishLineup":0,"lineup":false,"propCount":0}
        //console.log('1111111' + JSON.stringify(res));
        //console.log("出鱼："+JSON.stringify(res));
        var result = self.changeResultJSON_Function(res); // console.log(result);

        if (self.fishMain) {
          self.fishMain.createFish(result); //var t = result;
          //self.fishMain.BirdCreat_Function(t.fishId, 16, t.fishPath, t.fishCount, t.fishLineup, t.lineup, t.propCount)
        }
      }); //发射结果

      self.fishSocket.on('fishShoot', function (res) {
        var result = self.changeResultJSON_Function(res); //console.log('fishShoot=======================' + JSON.stringify(result));

        self.fishMain.shoot_r(result.userid, result.position, result.bet, result.bulletId);
      });
      self.fishSocket.on('getDownTimeResult', function (res) {
        var result = self.changeResultJSON_Function(ret); //console.log('getDownTimeResult=======================' + JSON.stringify(result));
      }); //用户进入

      self.fishSocket.on('playEnter', function (res) {
        var result = self.changeResultJSON_Function(res);

        if (result.ResultCode) {
          self.fishMain.setPlayerEnter(result.ResultData.UserId, result.ResultData.seatId, result.ResultData.nickname, result.ResultData.score, result.ResultData.headimgurl, result.ResultData.diamond);
        }
      }); //用户退出

      self.fishSocket.on('PlayerOut', function (res) {
        var result = self.changeResultJSON_Function(res);
        self.fishMain.setPlayerExit(result.PlayerSeatId);
      });
      self.fishSocket.on('changePowerResult', function (res) {
        var result = self.changeResultJSON_Function(res);
        self.fishMain.changePower(result);
      });
      self.fishSocket.on('useSkillResult', function (res) {
        var result = self.changeResultJSON_Function(res);
        console.log("useSkillResult", result);
        self.fishMain.cast_skill_r(result);
      });
      self.fishSocket.on('fishHit_boardResult', function (res) {
        res = self.changeResultJSON_Function(res);

        if (res.uid == self.playerInfo.playerId) {
          _this2._gameSocket.emit('fishHit', res);
        }
      });
      self.fishSocket.on('userGoldUpdate', function (res) {});
      self.fishSocket.on('pool', function (res) {});
      self.fishSocket.on('fishSceneChange', function (res) {});
      self.fishSocket.on('getFishListResult', function (res) {});
      self.fishSocket.on('getMoguiCountResult', function (res) {});
      self.fishSocket.on('boomFishHitResult', function (res) {
        // ResultData:{userId:_userId,hitSocre:score,fishList:outfishList}}
        var result = self.changeResultJSON_Function(res);
        self.fishMain.onBoomFishHit(result.ResultData);
      });
      self.fishSocket.on('disconnect', function (res) {
        self.fishMain.openAlert();

        try {
          cc.sys.isBrowser && self.fishSocket.close();
          self.fishSocket = null;
          self.playerInfo.gameDisconnect || self.lobbyMain.contentGameServerFail_Function("Fish");
        } catch (e) {}
      });
    };
    /**
     * 传递this作用域
     * @param {*} scene 来自LobbyMain.js
     */


    this.setLobbyMainObj_Function = function (scene) {
      _this.lobbyMain = scene;
    };
    /**
     * 保存当前场景
     */


    this.setFishObj_Funtion = function (scene) {
      _this.fishMain = scene;
    };
    /**
     * 解析JSON数据
     * @param {*} ret 
     */


    this.changeResultJSON_Function = function (ret) {
      if (cc.sys.isNative) {
        return JSON.parse(ret);
      }

      return ret;
    };

    this.init();
  }

  ;
  return {
    getInstant: new getInstant()
  };
}();

module.exports = FishNetWork;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxGaXNoXFxGaXNoTmV0V29yay5qcyJdLCJuYW1lcyI6WyJGaXNoTmV0V29yayIsImdldEluc3RhbnQiLCJfaW5zdGFuY2UiLCJ1bmRlZmluZWQiLCJTaW5nbGUiLCJsb2JieU1haW4iLCJmaXNoTWFpbiIsImZpc2hTb2NrZXQiLCJwbGF5ZXJJbmZvIiwiZXZlbnRNZ3IiLCJ1c2VyTGlzdCIsInRhYmxlSWQiLCJzZWF0SWQiLCJzZWF0SW5kZXgiLCJyb29tQmV0IiwiaW5pdCIsInJlcXVpcmUiLCJzZWxmIiwibG9naW5HYW1lX0Z1bmN0aW9uIiwibG9naW5JUCIsInBvcnQiLCJ1c2VyaWQiLCJzaWduIiwic29ja2V0IiwiY2MiLCJzeXMiLCJpc05hdGl2ZSIsIlNvY2tldElPIiwiY29ubmVjdCIsIm9uIiwiaXNCcm93c2VyIiwiY2xvc2UiLCJnYW1lRGlzY29ubmVjdCIsImNvbnRlbnRHYW1lU2VydmVyRmFpbF9GdW5jdGlvbiIsImUiLCJvcGVuQWxlcnQiLCJyZXQiLCJlbWl0IiwiZ2FtZXR5cGUiLCJlcnJvciIsInJlc3VsdCIsImNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24iLCJyZXN1bHRpZCIsIk9iaiIsImJldCIsInBsYXllckNvaW4iLCJzY29yZSIsImdldENvbXBvbmVudCIsIm5ldFdvcmsiLCJkaXNjb25uZWN0Iiwic2V0RmlzaFNvY2tldE9uX0Z1Y3Rpb24iLCJsb2dpblJvb21fRnVuY3Rpb24iLCJmaW5kIiwiUWllSHVhblNjZW5lX25vcm1hbCIsInJvb21pZCIsImNvbV9UaXBzIiwibG9hZEdhbWVTY2VuZSIsInNob3dNZXNzYWdlYm94X0Z1bmN0aW9uIiwibXNnIiwiUmVzdWx0Q29kZSIsIlJlc3VsdERhdGEiLCJUYWJsZUlkIiwiZ2FtZU5hbWUiLCJhdWRpb0VuZ2luZSIsInN0b3BBbGwiLCJzdGFydF8iLCJyZXMiLCJvbkZpc2hIaXQiLCJjcmVhdGVGaXNoIiwic2hvb3RfciIsInBvc2l0aW9uIiwiYnVsbGV0SWQiLCJzZXRQbGF5ZXJFbnRlciIsIlVzZXJJZCIsIm5pY2tuYW1lIiwiaGVhZGltZ3VybCIsImRpYW1vbmQiLCJzZXRQbGF5ZXJFeGl0IiwiUGxheWVyU2VhdElkIiwiY2hhbmdlUG93ZXIiLCJjb25zb2xlIiwibG9nIiwiY2FzdF9za2lsbF9yIiwidWlkIiwicGxheWVySWQiLCJfZ2FtZVNvY2tldCIsIm9uQm9vbUZpc2hIaXQiLCJzZXRMb2JieU1haW5PYmpfRnVuY3Rpb24iLCJzY2VuZSIsInNldEZpc2hPYmpfRnVudGlvbiIsIkpTT04iLCJwYXJzZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0EsSUFBSUEsV0FBVyxHQUFJLFlBQU07QUFDckI7QUFDSjtBQUNBO0FBQ0ksV0FBU0MsVUFBVCxHQUFzQjtBQUNsQixRQUFJQyxTQUFKOztBQUNBLFFBQUlBLFNBQVMsS0FBS0MsU0FBbEIsRUFBNkI7QUFDekJELE1BQUFBLFNBQVMsR0FBRyxJQUFJRSxNQUFKLEVBQVo7QUFDSDs7QUFDRCxXQUFPRixTQUFQO0FBQ0g7QUFFRDtBQUNKO0FBQ0E7OztBQUNJLFdBQVNFLE1BQVQsR0FBa0I7QUFBQTs7QUFDZDtBQUNBLFNBQUtDLFNBQUwsR0FBaUIsSUFBakI7QUFDQSxTQUFLQyxRQUFMLEdBQWdCLElBQWhCO0FBQ0EsU0FBS0MsVUFBTCxHQUFrQixJQUFsQjtBQUNBLFNBQUtDLFVBQUwsR0FBa0IsSUFBbEI7QUFDQSxTQUFLQyxRQUFMLEdBQWdCLElBQWhCO0FBQ0EsU0FBS0MsUUFBTCxHQUFnQixJQUFoQjtBQUNBLFNBQUtDLE9BQUwsR0FBZSxDQUFDLENBQWhCO0FBQ0EsU0FBS0MsTUFBTCxHQUFjLENBQUMsQ0FBZjtBQUNBLFNBQUtDLFNBQUwsR0FBaUIsQ0FBQyxDQUFsQjtBQUNBLFNBQUtDLE9BQUwsR0FBZSxDQUFmO0FBRUE7QUFDUjtBQUNBOztBQUNRLFNBQUtDLElBQUwsR0FBWSxZQUFNO0FBQ2QsTUFBQSxLQUFJ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LFlBQUk7QUFDQVgsVUFBQUEsRUFBRSxDQUFDQyxHQUFILENBQU9LLFNBQVAsSUFBb0JiLElBQUksQ0FBQ1YsVUFBTCxDQUFnQndCLEtBQWhCLEVBQXBCO0FBQ0FkLFVBQUFBLElBQUksQ0FBQ1YsVUFBTCxHQUFrQixJQUFsQjtBQUNBVSxVQUFBQSxJQUFJLENBQUNULFVBQUwsQ0FBZ0J3QixjQUFoQixJQUFrQ2YsSUFBSSxDQUFDWixTQUFMLENBQWU0Qiw4QkFBZixDQUE4QyxNQUE5QyxDQUFsQztBQUNILFNBSkQsQ0FJRSxPQUFPQyxDQUFQLEVBQVUsQ0FFWDtBQUNKLE9BVEQ7QUFVSCxLQTFHRDtBQTRHQTtBQUNSO0FBQ0E7QUFDQTs7O0FBQ1EsU0FBS3FELHdCQUFMLEdBQWdDLFVBQUFDLEtBQUssRUFBSTtBQUNyQyxNQUFBLEtBQUksQ0FBQ25GLFNBQUwsR0FBaUJtRixLQUFqQjtBQUNILEtBRkQ7QUFJQTtBQUNSO0FBQ0E7OztBQUNRLFNBQUtDLGtCQUFMLEdBQTBCLFVBQUFELEtBQUssRUFBSTtBQUMvQixNQUFBLEtBQUksQ0FBQ2xGLFFBQUwsR0FBZ0JrRixLQUFoQjtBQUNILEtBRkQ7QUFJQTtBQUNSO0FBQ0E7QUFDQTs7O0FBQ1EsU0FBSy9DLHlCQUFMLEdBQWlDLFVBQUFMLEdBQUcsRUFBSTtBQUNwQyxVQUFJWixFQUFFLENBQUNDLEdBQUgsQ0FBT0MsUUFBWCxFQUFxQjtBQUNqQixlQUFPZ0UsSUFBSSxDQUFDQyxLQUFMLENBQVd2RCxHQUFYLENBQVA7QUFDSDs7QUFDRCxhQUFPQSxHQUFQO0FBQ0gsS0FMRDs7QUFNQSxTQUFLckIsSUFBTDtBQUNIOztBQUFBO0FBQ0QsU0FBTztBQUNIZCxJQUFBQSxVQUFVLEVBQUUsSUFBSUEsVUFBSjtBQURULEdBQVA7QUFHSCxDQS9SaUIsRUFBbEI7O0FBaVNBMkYsTUFBTSxDQUFDQyxPQUFQLEdBQWlCN0YsV0FBakIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiDmjZXpsbzovr7kurpTT0NLRVTpgJrorq9cclxuICovXHJcbnZhciBGaXNoTmV0V29yayA9ICgoKSA9PiB7XHJcbiAgICAvKipcclxuICAgICAqIOWNleS+i+aooeW8j1xyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBnZXRJbnN0YW50KCkge1xyXG4gICAgICAgIHZhciBfaW5zdGFuY2U7XHJcbiAgICAgICAgaWYgKF9pbnN0YW5jZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIF9pbnN0YW5jZSA9IG5ldyBTaW5nbGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIF9pbnN0YW5jZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOmAu+i+keWxglxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBTaW5nbGUoKSB7XHJcbiAgICAgICAgLy9UT0RPOuWPmOmHj+WIneWni+WMluacquWujOaIkFxyXG4gICAgICAgIHRoaXMubG9iYnlNYWluID0gbnVsbDtcclxuICAgICAgICB0aGlzLmZpc2hNYWluID0gbnVsbDtcclxuICAgICAgICB0aGlzLmZpc2hTb2NrZXQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucGxheWVySW5mbyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5ldmVudE1nciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy51c2VyTGlzdCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy50YWJsZUlkID0gLTE7XHJcbiAgICAgICAgdGhpcy5zZWF0SWQgPSAtMTtcclxuICAgICAgICB0aGlzLnNlYXRJbmRleCA9IC0xO1xyXG4gICAgICAgIHRoaXMucm9vbUJldCA9IDE7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOWIneWni+WMllxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuaW5pdCA9ICgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5wbGF5ZXJJbmZvID0gcmVxdWlyZShcIlBsYXllckluZm9cIikuZ2V0SW5zdGFudDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDov5vlhaXmuLjmiI9cclxuICAgICAgICAgKiBAcGFyYW0geyp9IGxvZ2luSVAgXHJcbiAgICAgICAgICogQHBhcmFtIHsqfSBwb3J0IFxyXG4gICAgICAgICAqIEBwYXJhbSB7Kn0gdXNlcmlkIFxyXG4gICAgICAgICAqIEBwYXJhbSB7Kn0gc2lnbiBcclxuICAgICAgICAgKi9cclxuXHJcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xyXG5cclxuICAgICAgICBzZWxmLmxvZ2luR2FtZV9GdW5jdGlvbiA9IChsb2dpbklQLCBwb3J0LCB1c2VyaWQsIHNpZ24pID0+IHtcclxuICAgICAgICAgICAgdmFyIHNvY2tldCA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldCA9IFNvY2tldElPLmNvbm5lY3QobG9naW5JUCArIFwiOlwiICsgcG9ydCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzb2NrZXQgPSByZXF1aXJlKFwic29ja2V0LWlvXCIpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0ID0gc29ja2V0KGxvZ2luSVAgKyBcIjpcIiArIHBvcnQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvL+i/nuaOpeWksei0pVxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oXCJlcnJvclwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNjLnN5cy5pc0Jyb3dzZXIgJiYgc2VsZi5maXNoU29ja2V0LmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnBsYXllckluZm8uZ2FtZURpc2Nvbm5lY3QgfHwgc2VsZi5sb2JieU1haW4uY29udGVudEdhbWVTZXJ2ZXJGYWlsX0Z1bmN0aW9uKFwiRmlzaFwiKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmZpc2hNYWluLm9wZW5BbGVydCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy/ov57mjqXlpLHotKVcclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKFwiY29ubmVjdF9lcnJvclwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNjLnN5cy5pc0Jyb3dzZXIgJiYgc2VsZi5maXNoU29ja2V0LmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnBsYXllckluZm8uZ2FtZURpc2Nvbm5lY3QgfHwgc2VsZi5sb2JieU1haW4uY29udGVudEdhbWVTZXJ2ZXJGYWlsX0Z1bmN0aW9uKFwiRmlzaFwiKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmZpc2hNYWluLm9wZW5BbGVydCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy/ov57mjqXotoXml7ZcclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKFwiY29ubmVjdF90aW1lb3V0XCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Muc3lzLmlzQnJvd3NlciAmJiBzZWxmLmZpc2hTb2NrZXQuY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYucGxheWVySW5mby5nYW1lRGlzY29ubmVjdCB8fCBzZWxmLmxvYmJ5TWFpbi5jb250ZW50R2FtZVNlcnZlckZhaWxfRnVuY3Rpb24oXCJGaXNoXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4ub3BlbkFsZXJ0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvL+i/nuaOpVxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oXCJjb25uZWN0ZWRcIiwgcmV0ID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL+i/m+WFpea4uOaIj1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQuZW1pdChcIkxvZ2luR2FtZVwiLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyaWQ6IHVzZXJpZCwgLy/nlKjmiLdJRFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZXR5cGU6IDExLCAvL+a4uOaIj+exu+Wei1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbjogc2lnbiAvL+etvuWQjVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgeyB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKFwibG9naW5HYW1lUmVzdWx0XCIsIHJldCA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJldCk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCfmuLjmiI/nmbvpmYbmiJDlip89PT09PT09PT09PT09PT09PT09PT09PScgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQucmVzdWx0aWQpIHsgLy/muLjmiI/nmbvlvZXmiJDlip9cclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnJvb21CZXQgPSByZXN1bHQuT2JqLmJldDtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnBsYXllckluZm8ucGxheWVyQ29pbiA9IHJlc3VsdC5PYmouc2NvcmU7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2JieU1haW4uZ2V0Q29tcG9uZW50KFwiTG9iYnlNYWluXCIpLm5ldFdvcmsuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXRGaXNoU29ja2V0T25fRnVjdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9naW5Sb29tX0Z1bmN0aW9uKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGNjLmZpbmQoXCJDYW52YXMvYnV0dG9uQ3RybFwiKS5nZXRDb21wb25lbnQoXCJMb2JieUJ1dHRvbkNsaWNrXCIpLlFpZUh1YW5TY2VuZV9ub3JtYWwoXCJGaXNoTWFpblwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5lbWl0KFwiTG9naW5Sb29tXCIsIHsgLy/nmbvlvZXmuLjmiI/miL/pl7TmjqXlj6Mgcm9vbWlk5LygIDEg5bCx5aW9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb29taWQ6IDFcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIC8v5ri45oiP55m75b2V5aSx6LSlXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGYubG9iYnlNYWluLmNvbV9UaXBzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9iYnlNYWluLmdldENvbXBvbmVudChcIkxvYmJ5TWFpblwiKS5sb2FkR2FtZVNjZW5lID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9iYnlNYWluLmdldENvbXBvbmVudChcIkxvYmJ5TWFpblwiKS5zaG93TWVzc2FnZWJveF9GdW5jdGlvbihyZXN1bHQubXNnLCAxLCA0KTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZpc2hNYWluLm9wZW5BbGVydCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog6L+b5YWl5oi/6Ze0XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5sb2dpblJvb21fRnVuY3Rpb24gPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8v6L+U5Zue5oi/6Ze05pWw5o2uXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbihcIkxvZ2luUm9vbVJlc3VsdFwiLCByZXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5SZXN1bHRDb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi50YWJsZUlkID0gcmVzdWx0LlJlc3VsdERhdGEuVGFibGVJZDtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNlYXRJZCA9IHJlc3VsdC5SZXN1bHREYXRhLnNlYXRJZDtcclxuICAgICAgICAgICAgICAgICAgICAvL+aJgOacieeUqOaIt+S/oeaBryB1c2VySWQ6IDMxMjAsIHNlYXRJZDogMCwgbmlja25hbWU6IFwiY3YxMjM0NTZcIiwgc2NvcmU6IDEwMDQ5MDAsIHVzZXJUeXBlOiAwLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYudXNlckxpc3QgPSByZXN1bHQuUmVzdWx0RGF0YS51c2VyTGlzdDtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnBsYXllckluZm8uZ2FtZURpc2Nvbm5lY3QgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnBsYXllckluZm8uZ2FtZU5hbWUgPSBcIkZpc2hcIjtcclxuICAgICAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zdG9wQWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5maXNoTWFpbi5zdGFydF8oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog6ZW/6L+e6YCa6K6vXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5zZXRGaXNoU29ja2V0T25fRnVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy/lh7vmnYDnu5PmnpxcclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdIaXRSZXN1bHQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnaGl0OiAnK3Jlcyk7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJlcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LlJlc3VsdENvZGUgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4ub25GaXNoSGl0KHJlc3VsdC5SZXN1bHREYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvL+mxvOi/m+WFpeWcuuaZr1xyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ0Zpc2hPdXQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8ge1wiZmlzaElkXCI6WzcyMTddLFwiZmlzaFR5cGVcIjoxOCxcImZpc2hQYXRoXCI6MTMsXCJmaXNoQ291bnRcIjoxLFwiZmlzaExpbmV1cFwiOjAsXCJsaW5ldXBcIjpmYWxzZSxcInByb3BDb3VudFwiOjB9XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCcxMTExMTExJyArIEpTT04uc3RyaW5naWZ5KHJlcykpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCLlh7rpsbzvvJpcIitKU09OLnN0cmluZ2lmeShyZXMpKTtcclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBzZWxmLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24ocmVzKTtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5maXNoTWFpbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4uY3JlYXRlRmlzaChyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIHQgPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLmZpc2hNYWluLkJpcmRDcmVhdF9GdW5jdGlvbih0LmZpc2hJZCwgMTYsIHQuZmlzaFBhdGgsIHQuZmlzaENvdW50LCB0LmZpc2hMaW5ldXAsIHQubGluZXVwLCB0LnByb3BDb3VudClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvL+WPkeWwhOe7k+aenFxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ2Zpc2hTaG9vdCcsIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdmaXNoU2hvb3Q9PT09PT09PT09PT09PT09PT09PT09PScgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4uc2hvb3RfcihyZXN1bHQudXNlcmlkLCByZXN1bHQucG9zaXRpb24sIHJlc3VsdC5iZXQsIHJlc3VsdC5idWxsZXRJZCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdnZXREb3duVGltZVJlc3VsdCcsIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJldCk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdnZXREb3duVGltZVJlc3VsdD09PT09PT09PT09PT09PT09PT09PT09JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8v55So5oi36L+b5YWlXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbigncGxheUVudGVyJywgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBzZWxmLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24ocmVzKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuUmVzdWx0Q29kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4uc2V0UGxheWVyRW50ZXIocmVzdWx0LlJlc3VsdERhdGEuVXNlcklkLCByZXN1bHQuUmVzdWx0RGF0YS5zZWF0SWQsIHJlc3VsdC5SZXN1bHREYXRhLm5pY2tuYW1lLCByZXN1bHQuUmVzdWx0RGF0YS5zY29yZSwgcmVzdWx0LlJlc3VsdERhdGEuaGVhZGltZ3VybCwgcmVzdWx0LlJlc3VsdERhdGEuZGlhbW9uZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy/nlKjmiLfpgIDlh7pcclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdQbGF5ZXJPdXQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXMpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5maXNoTWFpbi5zZXRQbGF5ZXJFeGl0KHJlc3VsdC5QbGF5ZXJTZWF0SWQpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbignY2hhbmdlUG93ZXJSZXN1bHQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXMpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5maXNoTWFpbi5jaGFuZ2VQb3dlcihyZXN1bHQpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbigndXNlU2tpbGxSZXN1bHQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXMpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ1c2VTa2lsbFJlc3VsdFwiLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5maXNoTWFpbi5jYXN0X3NraWxsX3IocmVzdWx0KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdmaXNoSGl0X2JvYXJkUmVzdWx0JywgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIHJlcyA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy51aWQgPT0gc2VsZi5wbGF5ZXJJbmZvLnBsYXllcklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ2FtZVNvY2tldC5lbWl0KCdmaXNoSGl0JywgcmVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbigndXNlckdvbGRVcGRhdGUnLCByZXMgPT4ge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ3Bvb2wnLCByZXMgPT4ge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ2Zpc2hTY2VuZUNoYW5nZScsIHJlcyA9PiB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbignZ2V0RmlzaExpc3RSZXN1bHQnLCByZXMgPT4ge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ2dldE1vZ3VpQ291bnRSZXN1bHQnLCByZXMgPT4ge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ2Jvb21GaXNoSGl0UmVzdWx0JywgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIFJlc3VsdERhdGE6e3VzZXJJZDpfdXNlcklkLGhpdFNvY3JlOnNjb3JlLGZpc2hMaXN0Om91dGZpc2hMaXN0fX1cclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBzZWxmLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24ocmVzKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4ub25Cb29tRmlzaEhpdChyZXN1bHQuUmVzdWx0RGF0YSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdkaXNjb25uZWN0JywgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4ub3BlbkFsZXJ0KCk7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNjLnN5cy5pc0Jyb3dzZXIgJiYgc2VsZi5maXNoU29ja2V0LmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnBsYXllckluZm8uZ2FtZURpc2Nvbm5lY3QgfHwgc2VsZi5sb2JieU1haW4uY29udGVudEdhbWVTZXJ2ZXJGYWlsX0Z1bmN0aW9uKFwiRmlzaFwiKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog5Lyg6YCSdGhpc+S9nOeUqOWfn1xyXG4gICAgICAgICAqIEBwYXJhbSB7Kn0gc2NlbmUg5p2l6IeqTG9iYnlNYWluLmpzXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5zZXRMb2JieU1haW5PYmpfRnVuY3Rpb24gPSBzY2VuZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubG9iYnlNYWluID0gc2NlbmU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog5L+d5a2Y5b2T5YmN5Zy65pmvXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5zZXRGaXNoT2JqX0Z1bnRpb24gPSBzY2VuZSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMuZmlzaE1haW4gPSBzY2VuZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDop6PmnpBKU09O5pWw5o2uXHJcbiAgICAgICAgICogQHBhcmFtIHsqfSByZXQgXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uID0gcmV0ID0+IHtcclxuICAgICAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmV0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBnZXRJbnN0YW50OiBuZXcgZ2V0SW5zdGFudCgpXHJcbiAgICB9XHJcbn0pKCk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEZpc2hOZXRXb3JrOyJdfQ==