
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Triangle/TriangleMain.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '042a83K4O5IvJiQQE2idlPG', 'TriangleMain');
// Script/Triangle/TriangleMain.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    unitNode: cc.Node,
    frameList: [cc.SpriteFrame],
    lineNode: cc.Node,
    moneyLbl: cc.Label,
    awardLbl: cc.Label,
    awardPoorLbl: cc.Label,
    betLbl: cc.Label,
    msgLayout: cc.Node
  },
  onLoad: function onLoad() {
    this.playerInfo = require("PlayerInfo").getInstant;
    this.net = this.node.getComponent('TriangleNetwork');
    this.audio = this.node.getComponent('TriangleAudio');
    this.status = 0;
    this.bet = 0;
  },
  start: function start() {
    this.betLbl.string = '0.00';
    this.awardLbl.string = '0.00';
    this.units = [];

    for (var i in this.unitNode.children) {
      var unit = this.unitNode.children[i];

      if (unit.name.indexOf('TriangleFrameBG') == -1) {
        this.units.push(unit);
        unit.originpos = unit.position;
      }
    }

    for (var _i in this.units) {
      this.units[_i].active = false;
    }

    this.unitNode.getChildByName("TriangleFrameBG01").zIndex = 40;
    this.unitNode.getChildByName("TriangleFrameBG02").zIndex = 20;
    this.hideLine(); // this.showLine(0, 3);
  },
  onClick: function onClick(ev, args) {
    if (args == 'close') {
      cc.director.loadScene("LobbyMain");
    } else if (args == 'up') {
      this.bet += 1;
      this.betLbl.string = this.bet.toFixed(2);
    } else if (args == 'down') {
      this.bet -= 1;
      this.bet = this.bet >= 0 ? this.bet : 0;
      this.betLbl.string = this.bet.toFixed(2);
    } else if (args == 'bet') {
      this.betFunc();
    }
  },
  betFunc: function betFunc() {
    if (this.status == 0 && this.bet > 0) {
      this.status = 1;
      this.audio.playBtnEf();
      this.msgLayout.removeAllChildren();
      this.net.socket.emit('lottery', this.bet * 100);
    }
  },
  showUnit: function showUnit(colorList) {
    var _this = this;

    var time_0 = 1;
    var time_1 = 0.1;
    this.scheduleOnce(function () {
      _this.audio.playFlyInEf();
    }, 0.8);

    for (var i in this.units) {
      var sp = this.units[i].getComponent(cc.Sprite);
      sp.spriteFrame = this.frameList[colorList[i]];
      var time_2 = parseInt(i) * 0.08;
      var unit = this.units[i];
      unit.active = true;
      unit.zIndex = 30;
      unit.scale = 1;
      unit.stopAllActions();
      unit.position = cc.v2(unit.originpos.x + 1150, unit.originpos.y);
      unit.runAction(cc.sequence(cc.delayTime(time_2), cc.jumpBy(time_0, cc.v2(-1200, 0), 75, 1), cc.callFunc(function () {
        _this.zIndex = 30;
      }, unit), cc.moveBy(time_1, 50, 0)));
      unit.runAction(cc.sequence(cc.delayTime(time_2), cc.repeat(cc.sequence(cc.scaleBy(0.2, 0.01, 1), cc.scaleBy(0.2, 100, 1)), 3)));
    }
  },
  changeColor: function changeColor(id, color) {
    var _this2 = this;

    var sp = this.units[id].getComponent(cc.Sprite);
    this.units[id].runAction(cc.sequence(cc.scaleBy(0.2, 0.01, 1), cc.scaleBy(0.2, 100, 1), cc.scaleBy(0.2, 0.01, 1), cc.scaleBy(0.2, 100, 1), cc.callFunc(function () {
      sp.spriteFrame = _this2.frameList[color];
    }), cc.scaleBy(0.2, 0.01, 1), cc.scaleBy(0.2, 100, 1)));
  },
  showLine: function showLine(id, color) {
    var nameList = ['GrayLineV', 'PurpleLineV', 'BlueLineV', 'CyanLineV', 'GreenLineV', 'YellowLineV', 'OrangeLineV', 'RedLineV'];
    var line = this.lineNode.getChildByName(id);
    var actNode = line.getChildByName(nameList[color]);
    actNode.active = true;
  },
  hideLine: function hideLine() {
    var linePr = this.lineNode.children;

    for (var i in linePr) {
      var pr = linePr[i].children;

      for (var j in pr) {
        pr[j].active = false;
      }
    }
  },
  wheelFunc: function wheelFunc(viewarray, data, index) {
    var _this3 = this;

    if (viewarray[index].client_win_color_dict.length == 0) {
      this.scheduleOnce(function () {
        _this3.status = 0;
      }, 1.5);
      this.awardLbl.string = (data.ResultData.winscore / 100).toFixed(2);
      this.moneyLbl.string = (data.ResultData.userscore / 100).toFixed(2);
      return;
    }

    this.scheduleOnce(function () {
      _this3.hideLine();

      var lines = viewarray[index].client_win_color_dict;

      for (var i in lines) {
        console.log(lines[i].s, lines[i].c);

        _this3.showLine(lines[i].s, lines[i].c);
      }

      var _loop = function _loop(_i2) {
        var data = viewarray[index].win_score_list[_i2];
        var node = new cc.Node();

        _this3.msgLayout.addChild(node);

        node.runAction(cc.sequence(cc.delayTime(1.5), cc.fadeOut(0.8), cc.callFunc(function () {
          node.removeFromParent();
        })));
        var colorList = [new cc.Color(125, 127, 127, 255), new cc.Color(89, 2, 171, 255), new cc.Color(13, 169, 198, 255), new cc.Color(195, 2, 194, 255), new cc.Color(67, 177, 0, 255), new cc.Color(215, 215, 0, 255), new cc.Color(187, 105, 0, 255), new cc.Color(229, 3, 3, 25)];
        var lbl = node.addComponent(cc.Label);
        lbl.string = '+' + (data.s / 100).toFixed(2); // node.color = 

        var outLine = node.addComponent(cc.LabelOutline);
        outLine.color = colorList[data.c];
        outLine.width = 5;
      };

      for (var _i2 in viewarray[index].win_score_list) {
        _loop(_i2);
      }
    }, 2.5);
    this.scheduleOnce(function () {
      _this3.hideLine();

      _this3.audio.playDelEf();

      var changeList = viewarray[index].win_index;
      var newList = viewarray[index + 1].res;

      for (var i in changeList) {
        _this3.changeColor(changeList[i], newList[changeList[i]]);
      }

      _this3.wheelFunc(viewarray, data, index + 1);
    }, 3);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxUcmlhbmdsZVxcVHJpYW5nbGVNYWluLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwidW5pdE5vZGUiLCJOb2RlIiwiZnJhbWVMaXN0IiwiU3ByaXRlRnJhbWUiLCJsaW5lTm9kZSIsIm1vbmV5TGJsIiwiTGFiZWwiLCJhd2FyZExibCIsImF3YXJkUG9vckxibCIsImJldExibCIsIm1zZ0xheW91dCIsIm9uTG9hZCIsInBsYXllckluZm8iLCJyZXF1aXJlIiwiZ2V0SW5zdGFudCIsIm5ldCIsIm5vZGUiLCJnZXRDb21wb25lbnQiLCJhdWRpbyIsInN0YXR1cyIsImJldCIsInN0YXJ0Iiwic3RyaW5nIiwidW5pdHMiLCJpIiwiY2hpbGRyZW4iLCJ1bml0IiwibmFtZSIsImluZGV4T2YiLCJwdXNoIiwib3JpZ2lucG9zIiwicG9zaXRpb24iLCJhY3RpdmUiLCJnZXRDaGlsZEJ5TmFtZSIsInpJbmRleCIsImhpZGVMaW5lIiwib25DbGljayIsImV2IiwiYXJncyIsImRpcmVjdG9yIiwibG9hZFNjZW5lIiwidG9GaXhlZCIsImJldEZ1bmMiLCJwbGF5QnRuRWYiLCJyZW1vdmVBbGxDaGlsZHJlbiIsInNvY2tldCIsImVtaXQiLCJzaG93VW5pdCIsImNvbG9yTGlzdCIsInRpbWVfMCIsInRpbWVfMSIsInNjaGVkdWxlT25jZSIsInBsYXlGbHlJbkVmIiwic3AiLCJTcHJpdGUiLCJzcHJpdGVGcmFtZSIsInRpbWVfMiIsInBhcnNlSW50Iiwic2NhbGUiLCJzdG9wQWxsQWN0aW9ucyIsInYyIiwieCIsInkiLCJydW5BY3Rpb24iLCJzZXF1ZW5jZSIsImRlbGF5VGltZSIsImp1bXBCeSIsImNhbGxGdW5jIiwibW92ZUJ5IiwicmVwZWF0Iiwic2NhbGVCeSIsImNoYW5nZUNvbG9yIiwiaWQiLCJjb2xvciIsInNob3dMaW5lIiwibmFtZUxpc3QiLCJsaW5lIiwiYWN0Tm9kZSIsImxpbmVQciIsInByIiwiaiIsIndoZWVsRnVuYyIsInZpZXdhcnJheSIsImRhdGEiLCJpbmRleCIsImNsaWVudF93aW5fY29sb3JfZGljdCIsImxlbmd0aCIsIlJlc3VsdERhdGEiLCJ3aW5zY29yZSIsInVzZXJzY29yZSIsImxpbmVzIiwiY29uc29sZSIsImxvZyIsInMiLCJjIiwid2luX3Njb3JlX2xpc3QiLCJhZGRDaGlsZCIsImZhZGVPdXQiLCJyZW1vdmVGcm9tUGFyZW50IiwiQ29sb3IiLCJsYmwiLCJhZGRDb21wb25lbnQiLCJvdXRMaW5lIiwiTGFiZWxPdXRsaW5lIiwid2lkdGgiLCJwbGF5RGVsRWYiLCJjaGFuZ2VMaXN0Iiwid2luX2luZGV4IiwibmV3TGlzdCIsInJlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQUEsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxhQUFTRCxFQUFFLENBQUNFLFNBRFA7QUFHTEMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLFFBQVEsRUFBRUosRUFBRSxDQUFDSyxJQURMO0FBRVJDLElBQUFBLFNBQVMsRUFBRSxDQUFDTixFQUFFLENBQUNPLFdBQUosQ0FGSDtBQUdSQyxJQUFBQSxRQUFRLEVBQUVSLEVBQUUsQ0FBQ0ssSUFITDtBQUlSSSxJQUFBQSxRQUFRLEVBQUVULEVBQUUsQ0FBQ1UsS0FKTDtBQUtSQyxJQUFBQSxRQUFRLEVBQUVYLEVBQUUsQ0FBQ1UsS0FMTDtBQU1SRSxJQUFBQSxZQUFZLEVBQUVaLEVBQUUsQ0FBQ1UsS0FOVDtBQU9SRyxJQUFBQSxNQUFNLEVBQUViLEVBQUUsQ0FBQ1UsS0FQSDtBQVFSSSxJQUFBQSxTQUFTLEVBQUVkLEVBQUUsQ0FBQ0s7QUFSTixHQUhQO0FBY0xVLEVBQUFBLE1BZEssb0JBY0k7QUFDTCxTQUFLQyxVQUFMLEdBQWtCQyxPQUFPLENBQUMsWUFBRCxDQUFQLENBQXNCQyxVQUF4QztBQUNBLFNBQUtDLEdBQUwsR0FBVyxLQUFLQyxJQUFMLENBQVVDLFlBQVYsQ0FBdUIsaUJBQXZCLENBQVg7QUFDQSxT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QUFLLEdBQUcsQ0FBVCxDQUFULENBQXFCeUIsR0FBbkM7O0FBQ0EsV0FBSyxJQUFJckYsQ0FBVCxJQUFja0YsVUFBZCxFQUEwQjtBQUN0QixRQUFBLE1BQUksQ0FBQ25DLFdBQUwsQ0FBaUJtQyxVQUFVLENBQUNsRixDQUFELENBQTNCLEVBQWdDb0YsT0FBTyxDQUFDRixVQUFVLENBQUNsRixDQUFELENBQVgsQ0FBdkM7QUFDSDs7QUFDRCxNQUFBLE1BQUksQ0FBQ3lELFNBQUwsQ0FBZUMsU0FBZixFQUEwQkMsSUFBMUIsRUFBZ0NDLEtBQUssR0FBRyxDQUF4QztBQUNILEtBVEQsRUFTRyxDQVRIO0FBVUg7QUEzS0ksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdW5pdE5vZGU6IGNjLk5vZGUsXG4gICAgICAgIGZyYW1lTGlzdDogW2NjLlNwcml0ZUZyYW1lXSxcbiAgICAgICAgbGluZU5vZGU6IGNjLk5vZGUsXG4gICAgICAgIG1vbmV5TGJsOiBjYy5MYWJlbCxcbiAgICAgICAgYXdhcmRMYmw6IGNjLkxhYmVsLFxuICAgICAgICBhd2FyZFBvb3JMYmw6IGNjLkxhYmVsLFxuICAgICAgICBiZXRMYmw6IGNjLkxhYmVsLFxuICAgICAgICBtc2dMYXlvdXQ6IGNjLk5vZGUsXG4gICAgfSxcblxuICAgIG9uTG9hZCgpIHtcbiAgICAgICAgdGhpcy5wbGF5ZXJJbmZvID0gcmVxdWlyZShcIlBsYXllckluZm9cIikuZ2V0SW5zdGFudDtcbiAgICAgICAgdGhpcy5uZXQgPSB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50KCdUcmlhbmdsZU5ldHdvcmsnKTtcbiAgICAgICAgdGhpcy5hdWRpbyA9IHRoaXMubm9kZS5nZXRDb21wb25lbnQoJ1RyaWFuZ2xlQXVkaW8nKTtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSAwO1xuICAgICAgICB0aGlzLmJldCA9IDA7XG4gICAgfSxcblxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLmJldExibC5zdHJpbmcgPSAnMC4wMCc7XG4gICAgICAgIHRoaXMuYXdhcmRMYmwuc3RyaW5nID0gJzAuMDAnO1xuICAgICAgICB0aGlzLnVuaXRzID0gW107XG4gICAgICAgIGZvciAobGV0IGkgaW4gdGhpcy51bml0Tm9kZS5jaGlsZHJlbikge1xuICAgICAgICAgICAgbGV0IHVuaXQgPSB0aGlzLnVuaXROb2RlLmNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgaWYgKHVuaXQubmFtZS5pbmRleE9mKCdUcmlhbmdsZUZyYW1lQkcnKSA9PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMudW5pdHMucHVzaCh1bml0KTtcbiAgICAgICAgICAgICAgICB1bml0Lm9yaWdpbnBvcyA9IHVuaXQucG9zaXRpb247XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLnVuaXRzKSB7XG4gICAgICAgICAgICB0aGlzLnVuaXRzW2ldLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy51bml0Tm9kZS5nZXRDaGlsZEJ5TmFtZShcIlRyaWFuZ2xlRnJhbWVCRzAxXCIpLnpJbmRleCA9IDQwO1xuICAgICAgICB0aGlzLnVuaXROb2RlLmdldENoaWxkQnlOYW1lKFwiVHJpYW5nbGVGcmFtZUJHMDJcIikuekluZGV4ID0gMjA7XG5cbiAgICAgICAgdGhpcy5oaWRlTGluZSgpO1xuICAgICAgICAvLyB0aGlzLnNob3dMaW5lKDAsIDMpO1xuICAgIH0sXG5cbiAgICBvbkNsaWNrKGV2LCBhcmdzKSB7XG4gICAgICAgIGlmIChhcmdzID09ICdjbG9zZScpIHtcbiAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZShcIkxvYmJ5TWFpblwiKTtcbiAgICAgICAgfSBlbHNlIGlmIChhcmdzID09ICd1cCcpIHtcbiAgICAgICAgICAgIHRoaXMuYmV0ICs9IDE7XG4gICAgICAgICAgICB0aGlzLmJldExibC5zdHJpbmcgPSB0aGlzLmJldC50b0ZpeGVkKDIpO1xuICAgICAgICB9IGVsc2UgaWYgKGFyZ3MgPT0gJ2Rvd24nKSB7XG4gICAgICAgICAgICB0aGlzLmJldCAtPSAxO1xuICAgICAgICAgICAgdGhpcy5iZXQgPSB0aGlzLmJldCA+PSAwID8gdGhpcy5iZXQgOiAwO1xuICAgICAgICAgICAgdGhpcy5iZXRMYmwuc3RyaW5nID0gdGhpcy5iZXQudG9GaXhlZCgyKTtcbiAgICAgICAgfSBlbHNlIGlmIChhcmdzID09ICdiZXQnKSB7XG4gICAgICAgICAgICB0aGlzLmJldEZ1bmMoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBiZXRGdW5jKCkge1xuICAgICAgICBpZiAodGhpcy5zdGF0dXMgPT0gMCAmJiB0aGlzLmJldCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gMTtcbiAgICAgICAgICAgIHRoaXMuYXVkaW8ucGxheUJ0bkVmKCk7XG4gICAgICAgICAgICB0aGlzLm1zZ0xheW91dC5yZW1vdmVBbGxDaGlsZHJlbigpO1xuICAgICAgICAgICAgdGhpcy5uZXQuc29ja2V0LmVtaXQoJ2xvdHRlcnknLCB0aGlzLmJldCAqIDEwMCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvd1VuaXQoY29sb3JMaXN0KSB7XG4gICAgICAgIGxldCB0aW1lXzAgPSAxO1xuICAgICAgICBsZXQgdGltZV8xID0gMC4xO1xuICAgICAgICB0aGlzLnNjaGVkdWxlT25jZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmF1ZGlvLnBsYXlGbHlJbkVmKCk7XG4gICAgICAgIH0sIDAuOCk7XG4gICAgICAgIGZvciAobGV0IGkgaW4gdGhpcy51bml0cykge1xuICAgICAgICAgICAgbGV0IHNwID0gdGhpcy51bml0c1tpXS5nZXRDb21wb25lbnQoY2MuU3ByaXRlKTtcbiAgICAgICAgICAgIHNwLnNwcml0ZUZyYW1lID0gdGhpcy5mcmFtZUxpc3RbY29sb3JMaXN0W2ldXTtcbiAgICAgICAgICAgIGxldCB0aW1lXzIgPSBwYXJzZUludChpKSAqIDAuMDg7XG4gICAgICAgICAgICBsZXQgdW5pdCA9IHRoaXMudW5pdHNbaV07XG4gICAgICAgICAgICB1bml0LmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB1bml0LnpJbmRleCA9IDMwO1xuICAgICAgICAgICAgdW5pdC5zY2FsZSA9IDE7XG4gICAgICAgICAgICB1bml0LnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgICAgICB1bml0LnBvc2l0aW9uID0gY2MudjIodW5pdC5vcmlnaW5wb3MueCArIDExNTAsIHVuaXQub3JpZ2lucG9zLnkpO1xuICAgICAgICAgICAgdW5pdC5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZGVsYXlUaW1lKHRpbWVfMiksIGNjLmp1bXBCeSh0aW1lXzAsIGNjLnYyKC0xMjAwLCAwKSwgNzUsIDEpLFxuICAgICAgICAgICAgICAgIGNjLmNhbGxGdW5jKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy56SW5kZXggPSAzMDtcbiAgICAgICAgICAgICAgICB9LCB1bml0KSwgY2MubW92ZUJ5KHRpbWVfMSwgNTAsIDApKSk7XG5cbiAgICAgICAgICAgIHVuaXQucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZSh0aW1lXzIpLCBjYy5yZXBlYXQoY2Muc2VxdWVuY2UoY2Muc2NhbGVCeSgwLjIsIDAuMDEsIDEpLCBjYy5zY2FsZUJ5KDAuMiwgMTAwLCAxKSksIDMpKSk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2hhbmdlQ29sb3IoaWQsIGNvbG9yKSB7XG4gICAgICAgIGxldCBzcCA9IHRoaXMudW5pdHNbaWRdLmdldENvbXBvbmVudChjYy5TcHJpdGUpO1xuICAgICAgICB0aGlzLnVuaXRzW2lkXS5ydW5BY3Rpb24oXG4gICAgICAgICAgICBjYy5zZXF1ZW5jZShcbiAgICAgICAgICAgICAgICBjYy5zY2FsZUJ5KDAuMiwgMC4wMSwgMSksIGNjLnNjYWxlQnkoMC4yLCAxMDAsIDEpLFxuICAgICAgICAgICAgICAgIGNjLnNjYWxlQnkoMC4yLCAwLjAxLCAxKSwgY2Muc2NhbGVCeSgwLjIsIDEwMCwgMSksXG4gICAgICAgICAgICAgICAgY2MuY2FsbEZ1bmMoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzcC5zcHJpdGVGcmFtZSA9IHRoaXMuZnJhbWVMaXN0W2NvbG9yXTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYy5zY2FsZUJ5KDAuMiwgMC4wMSwgMSksIGNjLnNjYWxlQnkoMC4yLCAxMDAsIDEpXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICB9LFxuXG4gICAgc2hvd0xpbmUoaWQsIGNvbG9yKSB7XG4gICAgICAgIGNvbnN0IG5hbWVMaXN0ID0gWydHcmF5TGluZVYnLCAnUHVycGxlTGluZVYnLCAnQmx1ZUxpbmVWJywgJ0N5YW5MaW5lVicsICdHcmVlbkxpbmVWJywgJ1llbGxvd0xpbmVWJywgJ09yYW5nZUxpbmVWJywgJ1JlZExpbmVWJ107XG4gICAgICAgIGxldCBsaW5lID0gdGhpcy5saW5lTm9kZS5nZXRDaGlsZEJ5TmFtZShpZCk7XG4gICAgICAgIGxldCBhY3ROb2RlID0gbGluZS5nZXRDaGlsZEJ5TmFtZShuYW1lTGlzdFtjb2xvcl0pO1xuICAgICAgICBhY3ROb2RlLmFjdGl2ZSA9IHRydWU7XG4gICAgfSxcblxuICAgIGhpZGVMaW5lKCkge1xuICAgICAgICBsZXQgbGluZVByID0gdGhpcy5saW5lTm9kZS5jaGlsZHJlbjtcbiAgICAgICAgZm9yIChsZXQgaSBpbiBsaW5lUHIpIHtcbiAgICAgICAgICAgIGxldCBwciA9IGxpbmVQcltpXS5jaGlsZHJlbjtcbiAgICAgICAgICAgIGZvciAobGV0IGogaW4gcHIpIHtcbiAgICAgICAgICAgICAgICBwcltqXS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICB3aGVlbEZ1bmModmlld2FycmF5LCBkYXRhLCBpbmRleCkge1xuICAgICAgICBpZiAodmlld2FycmF5W2luZGV4XS5jbGllbnRfd2luX2NvbG9yX2RpY3QubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVPbmNlKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IDA7XG4gICAgICAgICAgICB9LCAxLjUpO1xuICAgICAgICAgICAgdGhpcy5hd2FyZExibC5zdHJpbmcgPSAoZGF0YS5SZXN1bHREYXRhLndpbnNjb3JlIC8gMTAwKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgdGhpcy5tb25leUxibC5zdHJpbmcgPSAoZGF0YS5SZXN1bHREYXRhLnVzZXJzY29yZSAvIDEwMCkudG9GaXhlZCgyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNjaGVkdWxlT25jZSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmhpZGVMaW5lKCk7XG4gICAgICAgICAgICBsZXQgbGluZXMgPSB2aWV3YXJyYXlbaW5kZXhdLmNsaWVudF93aW5fY29sb3JfZGljdDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgaW4gbGluZXMpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhsaW5lc1tpXS5zLCBsaW5lc1tpXS5jKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dMaW5lKGxpbmVzW2ldLnMsIGxpbmVzW2ldLmMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKGxldCBpIGluIHZpZXdhcnJheVtpbmRleF0ud2luX3Njb3JlX2xpc3QpIHtcbiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHZpZXdhcnJheVtpbmRleF0ud2luX3Njb3JlX2xpc3RbaV07XG4gICAgICAgICAgICAgICAgbGV0IG5vZGUgPSBuZXcgY2MuTm9kZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMubXNnTGF5b3V0LmFkZENoaWxkKG5vZGUpO1xuICAgICAgICAgICAgICAgIG5vZGUucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZSgxLjUpLCBjYy5mYWRlT3V0KDAuOCksIGNjLmNhbGxGdW5jKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVGcm9tUGFyZW50KCk7XG4gICAgICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgICAgICAgICBsZXQgY29sb3JMaXN0ID0gW1xuICAgICAgICAgICAgICAgICAgICBuZXcgY2MuQ29sb3IoMTI1LCAxMjcsIDEyNywgMjU1KSwgbmV3IGNjLkNvbG9yKDg5LCAyLCAxNzEsIDI1NSksIG5ldyBjYy5Db2xvcigxMywgMTY5LCAxOTgsIDI1NSksIG5ldyBjYy5Db2xvcigxOTUsIDIsIDE5NCwgMjU1KSxcbiAgICAgICAgICAgICAgICAgICAgbmV3IGNjLkNvbG9yKDY3LCAxNzcsIDAsIDI1NSksIG5ldyBjYy5Db2xvcigyMTUsIDIxNSwgMCwgMjU1KSwgbmV3IGNjLkNvbG9yKDE4NywgMTA1LCAwLCAyNTUpLCBuZXcgY2MuQ29sb3IoMjI5LCAzLCAzLCAyNSlcbiAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIGxldCBsYmwgPSBub2RlLmFkZENvbXBvbmVudChjYy5MYWJlbCk7XG4gICAgICAgICAgICAgICAgbGJsLnN0cmluZyA9ICcrJyArIChkYXRhLnMgLyAxMDApLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgLy8gbm9kZS5jb2xvciA9IFxuICAgICAgICAgICAgICAgIGxldCBvdXRMaW5lID0gbm9kZS5hZGRDb21wb25lbnQoY2MuTGFiZWxPdXRsaW5lKTtcbiAgICAgICAgICAgICAgICBvdXRMaW5lLmNvbG9yID0gY29sb3JMaXN0W2RhdGEuY107XG4gICAgICAgICAgICAgICAgb3V0TGluZS53aWR0aCA9IDU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIDIuNSk7XG5cbiAgICAgICAgdGhpcy5zY2hlZHVsZU9uY2UoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5oaWRlTGluZSgpO1xuICAgICAgICAgICAgdGhpcy5hdWRpby5wbGF5RGVsRWYoKTtcbiAgICAgICAgICAgIGxldCBjaGFuZ2VMaXN0ID0gdmlld2FycmF5W2luZGV4XS53aW5faW5kZXg7XG4gICAgICAgICAgICBsZXQgbmV3TGlzdCA9IHZpZXdhcnJheVtpbmRleCArIDFdLnJlcztcbiAgICAgICAgICAgIGZvciAobGV0IGkgaW4gY2hhbmdlTGlzdCkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlQ29sb3IoY2hhbmdlTGlzdFtpXSwgbmV3TGlzdFtjaGFuZ2VMaXN0W2ldXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLndoZWVsRnVuYyh2aWV3YXJyYXksIGRhdGEsIGluZGV4ICsgMSk7XG4gICAgICAgIH0sIDMpO1xuICAgIH1cbn0pOyJdfQ==