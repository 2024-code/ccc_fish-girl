
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Fish_haiwang2/Fishhaiwang2NetWork.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'a704eFoM0BIHLbE9wUhspg2', 'Fishhaiwang2NetWork');
// Script/Fish_haiwang2/Fishhaiwang2NetWork.js

"use strict";

/**
 * 捕鱼达人SOCKET通讯
 */
var Fishhaiwang2NetWork = function () {
  /**
   * 单例模式
   */
  function getInstant() {
    var _instance;

    if (_instance === undefined) {
      _instance = new Single();
    }

    return _instance;
  }
  /**
   * 逻辑层
   */


  function Single() {
    var _this = this;

    //TODO:变量初始化未完成
    this.lobbyMain = null;
    this.fishMain = null;
    this.fishSocket = null;
    this.playerInfo = null;
    this.eventMgr = null;
    this.userList = null;
    this.tableId = -1;
    this.seatId = -1;
    this.seatIndex = -1;
    this.roomBet = 1;
    /**
     * 初始化
     */

    this.init = function () {
      _this.playerInfo = require("PlayerInfo").getInstant;
    };
    /**
     * 进入游戏
     * @param {*} loginIP 
     * @param {*} port 
     * @param {*} userid 
     * @param {*} sign 
     */


    var self = this;

    self.loginGame_Function = function (loginIP, port, userid, sign) {
      var socket = null;

      if (cc.sys.isNative) {
        self.fishSocket = SocketIO.connect(loginIP + ":" + port);
      } else {
        socket = require("socket-io");
        self.fishSocket = socket(loginIP + ":" + port);
      } //连接失败


      self.fishSocket.on("error", function () {
        try {
          cc.sys.isBrowser && self.fishSocket.close();
          self.fishSocket = null;
          self.playerInfo.gameDisconnect || self.lobbyMain.contentGameServerFail_Function("Fishhaiwang2");
        } catch (e) {
          self.fishMain.openAlert();
        }
      }); //连接失败

      self.fishSocket.on("connect_error", function () {
        try {
          cc.sys.isBrowser && self.fishSocket.close();
          self.fishSocket = null;
          self.playerInfo.gameDisconnect || self.lobbyMain.contentGameServerFail_Function("Fishhaiwang2");
        } catch (e) {
          self.fishMain.openAlert();
        }
      }); //连接超时

      self.fishSocket.on("connect_timeout", function () {
        try {
          cc.sys.isBrowser && self.fishSocket.close();
          self.fishSocket = null;
          self.playerInfo.gameDisconnect || self.lobbyMain.contentGameServerFail_Function("Fishhaiwang2");
        } catch (e) {
          self.fishMain.openAlert();
        }
      }); //连接

      self.fishSocket.on("connected", function (ret) {
        if (ret) {
          try {
            //进入游戏
            self.fishSocket.emit("LoginGame", {
              userid: userid,
              //用户ID
              gametype: 11,
              //游戏类型
              sign: sign //签名

            });
          } catch (error) {}
        }
      });
      self.fishSocket.on("loginGameResult", function (ret) {
        var result = self.changeResultJSON_Function(ret); //console.log('游戏登陆成功=======================' + JSON.stringify(result));

        if (result.resultid) {
          //游戏登录成功
          self.roomBet = result.Obj.bet;
          self.playerInfo.playerCoin = result.Obj.score;
          self.lobbyMain.getComponent("LobbyMain").netWork.socket.disconnect();
          self.setFishSocketOn_Fuction();
          self.loginRoom_Function();
          cc.find("Canvas/buttonCtrl").getComponent("LobbyButtonClick").QieHuanScene_normal("Fish_haiwang2Main", function () {
            self.fishSocket.emit("LoginRoom", {
              //登录游戏房间接口 roomid传 1 就好
              roomid: 1
            });
          });
        } else {
          //游戏登录失败
          if (self.lobbyMain.com_Tips) {
            self.lobbyMain.getComponent("LobbyMain").loadGameScene = false;
            self.lobbyMain.getComponent("LobbyMain").showMessagebox_Function(result.msg, 1, 4);
          } else {
            self.fishMain.openAlert();
          }
        }
      });
    };
    /**
     * 进入房间
     */


    self.loginRoom_Function = function () {
      //返回房间数据
      self.fishSocket.on("LoginRoomResult", function (ret) {
        var result = self.changeResultJSON_Function(ret);

        if (result.ResultCode) {
          self.tableId = result.ResultData.TableId;
          self.seatId = result.ResultData.seatId; //所有用户信息 userId: 3120, seatId: 0, nickname: "cv123456", score: 1004900, userType: 0,

          self.userList = result.ResultData.userList;
          self.playerInfo.gameDisconnect = false;
          self.playerInfo.gameName = "Fishhaiwang2";
          cc.audioEngine.stopAll();
          self.fishMain.start_();
        }
      });
    };
    /**
     * 长连通讯
     */


    self.setFishSocketOn_Fuction = function () {
      var _this2 = this;

      //击杀结果
      self.fishSocket.on('HitResult', function (res) {
        //console.log('hit: '+res);
        var result = self.changeResultJSON_Function(res);

        if (result.ResultCode == 1) {
          self.fishMain.onFishHit(result.ResultData);
        }
      }); //鱼进入场景

      self.fishSocket.on('FishOut', function (res) {
        // {"fishId":[7217],"fishType":18,"fishPath":13,"fishCount":1,"fishLineup":0,"lineup":false,"propCount":0}
        //console.log('1111111' + JSON.stringify(res));
        //console.log("出鱼："+JSON.stringify(res));
        var result = self.changeResultJSON_Function(res); // console.log(result);

        if (self.fishMain) {
          self.fishMain.createFish(result); //var t = result;
          //self.fishMain.BirdCreat_Function(t.fishId, 16, t.fishPath, t.fishCount, t.fishLineup, t.lineup, t.propCount)
        }
      }); //发射结果

      self.fishSocket.on('fishShoot', function (res) {
        var result = self.changeResultJSON_Function(res); //console.log('fishShoot=======================' + JSON.stringify(result));

        self.fishMain.shoot_r(result.userid, result.position, result.bet, result.bulletId);
      });
      self.fishSocket.on('getDownTimeResult', function (res) {
        var result = self.changeResultJSON_Function(ret); //console.log('getDownTimeResult=======================' + JSON.stringify(result));
      }); //用户进入

      self.fishSocket.on('playEnter', function (res) {
        var result = self.changeResultJSON_Function(res);

        if (result.ResultCode) {
          self.fishMain.setPlayerEnter(result.ResultData.UserId, result.ResultData.seatId, result.ResultData.nickname, result.ResultData.score, result.ResultData.headimgurl, result.ResultData.diamond);
        }
      }); //用户退出

      self.fishSocket.on('PlayerOut', function (res) {
        var result = self.changeResultJSON_Function(res);
        self.fishMain.setPlayerExit(result.PlayerSeatId);
      });
      self.fishSocket.on('changePowerResult', function (res) {
        var result = self.changeResultJSON_Function(res);
        self.fishMain.changePower(result);
      });
      self.fishSocket.on('useSkillResult', function (res) {
        var result = self.changeResultJSON_Function(res);
        console.log("useSkillResult", result);
        self.fishMain.cast_skill_r(result);
      });
      self.fishSocket.on('fishHit_boardResult', function (res) {
        res = self.changeResultJSON_Function(res);

        if (res.uid == self.playerInfo.playerId) {
          _this2._gameSocket.emit('fishHit', res);
        }
      });
      self.fishSocket.on('userGoldUpdate', function (res) {});
      self.fishSocket.on('pool', function (res) {});
      self.fishSocket.on('fishSceneChange', function (res) {});
      self.fishSocket.on('getFishListResult', function (res) {});
      self.fishSocket.on('getMoguiCountResult', function (res) {});
      self.fishSocket.on('boomFishHitResult', function (res) {
        // ResultData:{userId:_userId,hitSocre:score,fishList:outfishList}}
        var result = self.changeResultJSON_Function(res);
        self.fishMain.onBoomFishHit(result.ResultData);
      });
      self.fishSocket.on('disconnect', function (res) {
        self.fishMain.openAlert();

        try {
          cc.sys.isBrowser && self.fishSocket.close();
          self.fishSocket = null;
          self.playerInfo.gameDisconnect || self.lobbyMain.contentGameServerFail_Function("Fishhaiwang2");
        } catch (e) {}
      });
    };
    /**
     * 传递this作用域
     * @param {*} scene 来自LobbyMain.js
     */


    this.setLobbyMainObj_Function = function (scene) {
      _this.lobbyMain = scene;
    };
    /**
     * 保存当前场景
     */


    this.setFishObj_Funtion = function (scene) {
      _this.fishMain = scene;
    };
    /**
     * 解析JSON数据
     * @param {*} ret 
     */


    this.changeResultJSON_Function = function (ret) {
      if (cc.sys.isNative) {
        return JSON.parse(ret);
      }

      return ret;
    };

    this.init();
  }

  ;
  return {
    getInstant: new getInstant()
  };
}();

module.exports = Fishhaiwang2NetWork;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxGaXNoX2hhaXdhbmcyXFxGaXNoaGFpd2FuZzJOZXRXb3JrLmpzIl0sIm5hbWVzIjpbIkZpc2hoYWl3YW5nMk5ldFdvcmsiLCJnZXRJbnN0YW50IiwiX2luc3RhbmNlIiwidW5kZWZpbmVkIiwiU2luZ2xlIiwibG9iYnlNYWluIiwiZmlzaE1haW4iLCJmaXNoU29ja2V0IiwicGxheWVySW5mbyIsImV2ZW50TWdyIiwidXNlckxpc3QiLCJ0YWJsZUlkIiwic2VhdElkIiwic2VhdEluZGV4Iiwicm9vbUJldCIsImluaXQiLCJyZXF1aXJlIiwic2VsZiIsImxvZ2luR2FtZV9GdW5jdGlvbiIsImxvZ2luSVAiLCJwb3J0IiwidXNlcmlkIiwic2lnbiIsInNvY2tldCIsImNjIiwic3lzIiwiaXNOYXRpdmUiLCJTb2NrZXRJTyIsImNvbm5lY3QiLCJvbiIsImlzQnJvd3NlciIsImNsb3NlIiwiZ2FtZURpc2Nvbm5lY3QiLCJjb250ZW50R2FtZVNlcnZlckZhaWxfRnVuY3Rpb24iLCJlIiwib3BlbkFsZXJ0IiwicmV0IiwiZW1pdCIsImdhbWV0eXBlIiwiZXJyb3IiLCJyZXN1bHQiLCJjaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uIiwicmVzdWx0aWQiLCJPYmoiLCJiZXQiLCJwbGF5ZXJDb2luIiwic2NvcmUiLCJnZXRDb21wb25lbnQiLCJuZXRXb3JrIiwiZGlzY29ubmVjdCIsInNldEZpc2hTb2NrZXRPbl9GdWN0aW9uIiwibG9naW5Sb29tX0Z1bmN0aW9uIiwiZmluZCIsIlFpZUh1YW5TY2VuZV9ub3JtYWwiLCJyb29taWQiLCJjb21fVGlwcyIsImxvYWRHYW1lU2NlbmUiLCJzaG93TWVzc2FnZWJveF9GdW5jdGlvbiIsIm1zZyIsIlJlc3VsdENvZGUiLCJSZXN1bHREYXRhIiwiVGFibGVJZCIsImdhbWVOYW1lIiwiYXVkaW9FbmdpbmUiLCJzdG9wQWxsIiwic3RhcnRfIiwicmVzIiwib25GaXNoSGl0IiwiY3JlYXRlRmlzaCIsInNob290X3IiLCJwb3NpdGlvbiIsImJ1bGxldElkIiwic2V0UGxheWVyRW50ZXIiLCJVc2VySWQiLCJuaWNrbmFtZSIsImhlYWRpbWd1cmwiLCJkaWFtb25kIiwic2V0UGxheWVyRXhpdCIsIlBsYXllclNlYXRJZCIsImNoYW5nZVBvd2VyIiwiY29uc29sZSIsImxvZyIsImNhc3Rfc2tpbGxfciIsInVpZCIsInBsYXllcklkIiwiX2dhbWVTb2NrZXQiLCJvbkJvb21GaXNoSGl0Iiwic2V0TG9iYnlNYWluT2JqX0Z1bmN0aW9uIiwic2NlbmUiLCJzZXRGaXNoT2JqX0Z1bnRpb24iLCJKU09OIiwicGFyc2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBLElBQUlBLG1CQUFtQixHQUFJLFlBQU07QUFDN0I7QUFDSjtBQUNBO0FBQ0ksV0FBU0MsVUFBVCxHQUFzQjtBQUNsQixRQUFJQyxTQUFKOztBQUNBLFFBQUlBLFNBQVMsS0FBS0MsU0FBbEIsRUFBNkI7QUFDekJELE1BQUFBLFNBQVMsR0FBRyxJQUFJRSxNQUFKLEVBQVo7QUFDSDs7QUFDRCxXQUFPRixTQUFQO0FBQ0g7QUFFRDtBQUNKO0FBQ0E7OztBQUNJLFdBQVNFLE1BQVQsR0FBa0I7QUFBQTs7QUFDZDtBQUNBLFNBQUtDLFNBQUwsR0FBaUIsSUFBakI7QUFDQSxTQUFLQyxRQUFMLEdBQWdCLElBQWhCO0FBQ0EsU0FBS0MsVUFBTCxHQUFrQixJQUFsQjtBQUNBLFNBQUtDLFVBQUwsR0FBa0IsSUFBbEI7QUFDQSxTQUFLQyxRQUFMLEdBQWdCLElBQWhCO0FBQ0EsU0FBS0MsUUFBTCxHQUFnQixJQUFoQjtBQUNBLFNBQUtDLE9BQUwsR0FBZSxDQUFDLENBQWhCO0FBQ0EsU0FBS0MsTUFBTCxHQUFjLENBQUMsQ0FBZjtBQUNBLFNBQUtDLFNBQUwsR0FBaUIsQ0FBQyxDQUFsQjtBQUNBLFNBQUtDLE9BQUwsR0FBZSxDQUFmO0FBRUE7QUFDUjtBQUNBOztBQUNRLFNBQUtDLElB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biAqIOaNlemxvOi+vuS6ulNPQ0tFVOmAmuiur1xyXG4gKi9cclxudmFyIEZpc2hoYWl3YW5nMk5ldFdvcmsgPSAoKCkgPT4ge1xyXG4gICAgLyoqXHJcbiAgICAgKiDljZXkvovmqKHlvI9cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gZ2V0SW5zdGFudCgpIHtcclxuICAgICAgICB2YXIgX2luc3RhbmNlO1xyXG4gICAgICAgIGlmIChfaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBfaW5zdGFuY2UgPSBuZXcgU2luZ2xlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBfaW5zdGFuY2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDpgLvovpHlsYJcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gU2luZ2xlKCkge1xyXG4gICAgICAgIC8vVE9ETzrlj5jph4/liJ3lp4vljJbmnKrlrozmiJBcclxuICAgICAgICB0aGlzLmxvYmJ5TWFpbiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5maXNoTWFpbiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5maXNoU29ja2V0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnBsYXllckluZm8gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuZXZlbnRNZ3IgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudXNlckxpc3QgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudGFibGVJZCA9IC0xO1xyXG4gICAgICAgIHRoaXMuc2VhdElkID0gLTE7XHJcbiAgICAgICAgdGhpcy5zZWF0SW5kZXggPSAtMTtcclxuICAgICAgICB0aGlzLnJvb21CZXQgPSAxO1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDliJ3lp4vljJZcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmluaXQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGxheWVySW5mbyA9IHJlcXVpcmUoXCJQbGF5ZXJJbmZvXCIpLmdldEluc3RhbnQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog6L+b5YWl5ri45oiPXHJcbiAgICAgICAgICogQHBhcmFtIHsqfSBsb2dpbklQIFxyXG4gICAgICAgICAqIEBwYXJhbSB7Kn0gcG9ydCBcclxuICAgICAgICAgKiBAcGFyYW0geyp9IHVzZXJpZCBcclxuICAgICAgICAgKiBAcGFyYW0geyp9IHNpZ24gXHJcbiAgICAgICAgICovXHJcblxyXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcclxuXHJcbiAgICAgICAgc2VsZi5sb2dpbkdhbWVfRnVuY3Rpb24gPSAobG9naW5JUCwgcG9ydCwgdXNlcmlkLCBzaWduKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciBzb2NrZXQgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQgPSBTb2NrZXRJTy5jb25uZWN0KGxvZ2luSVAgKyBcIjpcIiArIHBvcnQpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc29ja2V0ID0gcmVxdWlyZShcInNvY2tldC1pb1wiKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldCA9IHNvY2tldChsb2dpbklQICsgXCI6XCIgKyBwb3J0KTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy/ov57mjqXlpLHotKVcclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKFwiZXJyb3JcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBjYy5zeXMuaXNCcm93c2VyICYmIHNlbGYuZmlzaFNvY2tldC5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5wbGF5ZXJJbmZvLmdhbWVEaXNjb25uZWN0IHx8IHNlbGYubG9iYnlNYWluLmNvbnRlbnRHYW1lU2VydmVyRmFpbF9GdW5jdGlvbihcIkZpc2hoYWl3YW5nMlwiKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmZpc2hNYWluLm9wZW5BbGVydCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy/ov57mjqXlpLHotKVcclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKFwiY29ubmVjdF9lcnJvclwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNjLnN5cy5pc0Jyb3dzZXIgJiYgc2VsZi5maXNoU29ja2V0LmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnBsYXllckluZm8uZ2FtZURpc2Nvbm5lY3QgfHwgc2VsZi5sb2JieU1haW4uY29udGVudEdhbWVTZXJ2ZXJGYWlsX0Z1bmN0aW9uKFwiRmlzaGhhaXdhbmcyXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4ub3BlbkFsZXJ0KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAvL+i/nuaOpei2heaXtlxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oXCJjb25uZWN0X3RpbWVvdXRcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICBjYy5zeXMuaXNCcm93c2VyICYmIHNlbGYuZmlzaFNvY2tldC5jbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5wbGF5ZXJJbmZvLmdhbWVEaXNjb25uZWN0IHx8IHNlbGYubG9iYnlNYWluLmNvbnRlbnRHYW1lU2VydmVyRmFpbF9GdW5jdGlvbihcIkZpc2hoYWl3YW5nMlwiKTtcclxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmZpc2hNYWluLm9wZW5BbGVydCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgLy/ov57mjqVcclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKFwiY29ubmVjdGVkXCIsIHJldCA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmV0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy/ov5vlhaXmuLjmiI9cclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0LmVtaXQoXCJMb2dpbkdhbWVcIiwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmlkOiB1c2VyaWQsIC8v55So5oi3SURcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWV0eXBlOiAxMSwgLy/muLjmiI/nsbvlnotcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ246IHNpZ24gLy/nrb7lkI1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbihcImxvZ2luR2FtZVJlc3VsdFwiLCByZXQgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXQpO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygn5ri45oiP55m76ZmG5oiQ5YqfPT09PT09PT09PT09PT09PT09PT09PT0nICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0KSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnJlc3VsdGlkKSB7IC8v5ri45oiP55m75b2V5oiQ5YqfXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5yb29tQmV0ID0gcmVzdWx0Lk9iai5iZXQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5wbGF5ZXJJbmZvLnBsYXllckNvaW4gPSByZXN1bHQuT2JqLnNjb3JlO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYubG9iYnlNYWluLmdldENvbXBvbmVudChcIkxvYmJ5TWFpblwiKS5uZXRXb3JrLnNvY2tldC5kaXNjb25uZWN0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0RmlzaFNvY2tldE9uX0Z1Y3Rpb24oKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2luUm9vbV9GdW5jdGlvbigpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBjYy5maW5kKFwiQ2FudmFzL2J1dHRvbkN0cmxcIikuZ2V0Q29tcG9uZW50KFwiTG9iYnlCdXR0b25DbGlja1wiKS5RaWVIdWFuU2NlbmVfbm9ybWFsKFwiRmlzaF9oYWl3YW5nMk1haW5cIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQuZW1pdChcIkxvZ2luUm9vbVwiLCB7IC8v55m75b2V5ri45oiP5oi/6Ze05o6l5Y+jIHJvb21pZOS8oCAxIOWwseWlvVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm9vbWlkOiAxXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAvL+a4uOaIj+eZu+W9leWksei0pVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxmLmxvYmJ5TWFpbi5jb21fVGlwcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvYmJ5TWFpbi5nZXRDb21wb25lbnQoXCJMb2JieU1haW5cIikubG9hZEdhbWVTY2VuZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvYmJ5TWFpbi5nZXRDb21wb25lbnQoXCJMb2JieU1haW5cIikuc2hvd01lc3NhZ2Vib3hfRnVuY3Rpb24ocmVzdWx0Lm1zZywgMSwgNCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5maXNoTWFpbi5vcGVuQWxlcnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOi/m+WFpeaIv+mXtFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHNlbGYubG9naW5Sb29tX0Z1bmN0aW9uID0gKCkgPT4ge1xyXG4gICAgICAgICAgICAvL+i/lOWbnuaIv+mXtOaVsOaNrlxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oXCJMb2dpblJvb21SZXN1bHRcIiwgcmV0ID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBzZWxmLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24ocmV0KTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuUmVzdWx0Q29kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYudGFibGVJZCA9IHJlc3VsdC5SZXN1bHREYXRhLlRhYmxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZWF0SWQgPSByZXN1bHQuUmVzdWx0RGF0YS5zZWF0SWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy/miYDmnInnlKjmiLfkv6Hmga8gdXNlcklkOiAzMTIwLCBzZWF0SWQ6IDAsIG5pY2tuYW1lOiBcImN2MTIzNDU2XCIsIHNjb3JlOiAxMDA0OTAwLCB1c2VyVHlwZTogMCxcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnVzZXJMaXN0ID0gcmVzdWx0LlJlc3VsdERhdGEudXNlckxpc3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5wbGF5ZXJJbmZvLmdhbWVEaXNjb25uZWN0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5wbGF5ZXJJbmZvLmdhbWVOYW1lID0gXCJGaXNoaGFpd2FuZzJcIjtcclxuICAgICAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5zdG9wQWxsKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5maXNoTWFpbi5zdGFydF8oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICog6ZW/6L+e6YCa6K6vXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2VsZi5zZXRGaXNoU29ja2V0T25fRnVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgLy/lh7vmnYDnu5PmnpxcclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdIaXRSZXN1bHQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnaGl0OiAnK3Jlcyk7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJlcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LlJlc3VsdENvZGUgPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4ub25GaXNoSGl0KHJlc3VsdC5SZXN1bHREYXRhKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvL+mxvOi/m+WFpeWcuuaZr1xyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ0Zpc2hPdXQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgLy8ge1wiZmlzaElkXCI6WzcyMTddLFwiZmlzaFR5cGVcIjoxOCxcImZpc2hQYXRoXCI6MTMsXCJmaXNoQ291bnRcIjoxLFwiZmlzaExpbmV1cFwiOjAsXCJsaW5ldXBcIjpmYWxzZSxcInByb3BDb3VudFwiOjB9XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCcxMTExMTExJyArIEpTT04uc3RyaW5naWZ5KHJlcykpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCLlh7rpsbzvvJpcIitKU09OLnN0cmluZ2lmeShyZXMpKTtcclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBzZWxmLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24ocmVzKTtcclxuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VsZi5maXNoTWFpbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4uY3JlYXRlRmlzaChyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vdmFyIHQgPSByZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9zZWxmLmZpc2hNYWluLkJpcmRDcmVhdF9GdW5jdGlvbih0LmZpc2hJZCwgMTYsIHQuZmlzaFBhdGgsIHQuZmlzaENvdW50LCB0LmZpc2hMaW5ldXAsIHQubGluZXVwLCB0LnByb3BDb3VudClcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAvL+WPkeWwhOe7k+aenFxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ2Zpc2hTaG9vdCcsIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJlcyk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdmaXNoU2hvb3Q9PT09PT09PT09PT09PT09PT09PT09PScgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4uc2hvb3RfcihyZXN1bHQudXNlcmlkLCByZXN1bHQucG9zaXRpb24sIHJlc3VsdC5iZXQsIHJlc3VsdC5idWxsZXRJZCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdnZXREb3duVGltZVJlc3VsdCcsIHJlcyA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzdWx0ID0gc2VsZi5jaGFuZ2VSZXN1bHRKU09OX0Z1bmN0aW9uKHJldCk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdnZXREb3duVGltZVJlc3VsdD09PT09PT09PT09PT09PT09PT09PT09JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIC8v55So5oi36L+b5YWlXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbigncGxheUVudGVyJywgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBzZWxmLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24ocmVzKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuUmVzdWx0Q29kZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4uc2V0UGxheWVyRW50ZXIocmVzdWx0LlJlc3VsdERhdGEuVXNlcklkLCByZXN1bHQuUmVzdWx0RGF0YS5zZWF0SWQsIHJlc3VsdC5SZXN1bHREYXRhLm5pY2tuYW1lLCByZXN1bHQuUmVzdWx0RGF0YS5zY29yZSwgcmVzdWx0LlJlc3VsdERhdGEuaGVhZGltZ3VybCwgcmVzdWx0LlJlc3VsdERhdGEuZGlhbW9uZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgLy/nlKjmiLfpgIDlh7pcclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdQbGF5ZXJPdXQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXMpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5maXNoTWFpbi5zZXRQbGF5ZXJFeGl0KHJlc3VsdC5QbGF5ZXJTZWF0SWQpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbignY2hhbmdlUG93ZXJSZXN1bHQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXMpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5maXNoTWFpbi5jaGFuZ2VQb3dlcihyZXN1bHQpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbigndXNlU2tpbGxSZXN1bHQnLCByZXMgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXMpO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ1c2VTa2lsbFJlc3VsdFwiLCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgc2VsZi5maXNoTWFpbi5jYXN0X3NraWxsX3IocmVzdWx0KTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdmaXNoSGl0X2JvYXJkUmVzdWx0JywgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIHJlcyA9IHNlbGYuY2hhbmdlUmVzdWx0SlNPTl9GdW5jdGlvbihyZXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlcy51aWQgPT0gc2VsZi5wbGF5ZXJJbmZvLnBsYXllcklkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZ2FtZVNvY2tldC5lbWl0KCdmaXNoSGl0JywgcmVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbigndXNlckdvbGRVcGRhdGUnLCByZXMgPT4ge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ3Bvb2wnLCByZXMgPT4ge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ2Zpc2hTY2VuZUNoYW5nZScsIHJlcyA9PiB7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHNlbGYuZmlzaFNvY2tldC5vbignZ2V0RmlzaExpc3RSZXN1bHQnLCByZXMgPT4ge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ2dldE1vZ3VpQ291bnRSZXN1bHQnLCByZXMgPT4ge1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBzZWxmLmZpc2hTb2NrZXQub24oJ2Jvb21GaXNoSGl0UmVzdWx0JywgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIC8vIFJlc3VsdERhdGE6e3VzZXJJZDpfdXNlcklkLGhpdFNvY3JlOnNjb3JlLGZpc2hMaXN0Om91dGZpc2hMaXN0fX1cclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBzZWxmLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24ocmVzKTtcclxuICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4ub25Cb29tRmlzaEhpdChyZXN1bHQuUmVzdWx0RGF0YSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0Lm9uKCdkaXNjb25uZWN0JywgcmVzID0+IHtcclxuICAgICAgICAgICAgICAgIHNlbGYuZmlzaE1haW4ub3BlbkFsZXJ0KCk7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNjLnN5cy5pc0Jyb3dzZXIgJiYgc2VsZi5maXNoU29ja2V0LmNsb3NlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5maXNoU29ja2V0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnBsYXllckluZm8uZ2FtZURpc2Nvbm5lY3QgfHwgc2VsZi5sb2JieU1haW4uY29udGVudEdhbWVTZXJ2ZXJGYWlsX0Z1bmN0aW9uKFwiRmlzaGhhaXdhbmcyXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDkvKDpgJJ0aGlz5L2c55So5Z+fXHJcbiAgICAgICAgICogQHBhcmFtIHsqfSBzY2VuZSDmnaXoh6pMb2JieU1haW4uanNcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnNldExvYmJ5TWFpbk9ial9GdW5jdGlvbiA9IHNjZW5lID0+IHtcclxuICAgICAgICAgICAgdGhpcy5sb2JieU1haW4gPSBzY2VuZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDkv53lrZjlvZPliY3lnLrmma9cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnNldEZpc2hPYmpfRnVudGlvbiA9IHNjZW5lID0+IHtcclxuICAgICAgICAgICAgdGhpcy5maXNoTWFpbiA9IHNjZW5lO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIOino+aekEpTT07mlbDmja5cclxuICAgICAgICAgKiBAcGFyYW0geyp9IHJldCBcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmNoYW5nZVJlc3VsdEpTT05fRnVuY3Rpb24gPSByZXQgPT4ge1xyXG4gICAgICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShyZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXQ7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIGdldEluc3RhbnQ6IG5ldyBnZXRJbnN0YW50KClcclxuICAgIH1cclxufSkoKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gRmlzaGhhaXdhbmcyTmV0V29yazsiXX0=