
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Texture/Slot_sandabaigujing/js/SDBGJWheel.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f19b5+wBtdAkaPZv800oaJF', 'SDBGJWheel');
// Texture/Slot_sandabaigujing/js/SDBGJWheel.js

"use strict";

var ROLENUM = 40; //每一轮的角色数量

var TIMEMIN = 1; //第一轮摇奖时间

cc.Class({
  "extends": cc.Component,
  properties: {
    wheelId: 0,
    excludeId: {
      "default": 0,
      displayName: '不会出现的数字id'
    }
  },
  onLoad: function onLoad() {
    this.audio = cc.director.getScene().getChildByName('Canvas').getComponent('SDBGJAudio');
    this.mainObj = cc.director.getScene().getChildByName('Canvas').getComponent('SDBGJMain');
    this.mainObj.wheelList[this.wheelId] = this;
    this.status = 0; //0停止 1转 

    this.lastResult = [0, 0, 0, 0, 0]; //中间三位是上一局结果 首位末尾是为了防止露出部分转起来不一样 

    this.rolePbList = []; //roles

    this.roleIdList = []; //role ID
  },
  start: function start() {
    //初始化场景role
    this.initWheel();
  },
  initWheel: function initWheel() {
    this.rolePbList = [];
    this.roleIdList = [];
    this.node.removeAllChildren();

    for (var i = 0; i < ROLENUM - 12; i++) {
      this.addRole(this.getRandomId());
    }

    this.addRole(this.getRandomId());
    this.node.y = 0;
    this.mainObj.rollIndex++;
    this.mainObj.closeShine();
  },
  startRoll: function startRoll() {
    var _this = this;

    this.status = 1;
    this.rolePbList = [];
    this.roleIdList = [];
    this.node.removeAllChildren();
    this.node.y = 0; //滚轮启动位移距离

    for (var i in this.lastResult) {
      this.lastResult[i] = this.lastResult[i] == 0 ? this.getRandomId() : this.lastResult[i];
      this.addRole(this.lastResult[i]);
    }

    for (var _i = 0; _i < ROLENUM - 12; _i++) {
      this.addRole(this.getRandomId());
    }

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    for (var _i2 in args) {
      this.addRole(args[_i2]);
    }

    this.addRole(this.getRandomId());
    setTimeout(function () {
      var timer = TIMEMIN + _this.wheelId * 0.2;
      timer = !_this.mainObj.auto ? TIMEMIN : timer;

      _this.node.runAction(cc.sequence(cc.delayTime(0.2), cc.moveTo(timer, cc.v2(_this.node.x, -_this.node.height + 585)), cc.moveTo(0.1, cc.v2(_this.node.x, -_this.node.height + 640)), cc.moveTo(0.1, cc.v2(_this.node.x, -_this.node.height + 585)), cc.callFunc(_this.rollCallBack.bind(_this))));
    }, 100);
  },
  getRandomId: function getRandomId() {
    var randomId = 0;

    while (randomId == 0) {
      if (this.mainObj.freeTimes > 0 || this.mainObj.stopFree) {
        randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);
        randomId = randomId == 10 ? 1 : randomId;
      } else {
        randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);
      }

      randomId = randomId == this.excludeId ? 0 : randomId;
    }

    ;
    return randomId;
  },
  addRole: function addRole(id) {
    var pb = cc.instantiate(this.mainObj.rolePb[id]);
    this.rolePbList.push(pb);
    this.roleIdList.push(id);
    this.node.addChild(pb);
  },
  rollCallBack: function rollCallBack() {
    this.audio.playStopWheel();
    this.lastResult = this.roleIdList.slice(-5);
    this.status = 0;
    this.mainObj.stateCallBack();
  },
  stopImmediately: function stopImmediately() {
    var _this2 = this;

    this.lastResult = this.roleIdList.slice(-5);
    this.node.stopAllActions();
    setTimeout(function () {
      _this2.node.y = -_this2.node.height + 585;
    }, 50);
    this.status = 0;
    this.mainObj.stateCallBack();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcVGV4dHVyZVxcU2xvdF9zYW5kYWJhaWd1amluZ1xcanNcXFNEQkdKV2hlZWwuanMiXSwibmFtZXMiOlsiUk9MRU5VTSIsIlRJTUVNSU4iLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIndoZWVsSWQiLCJleGNsdWRlSWQiLCJkaXNwbGF5TmFtZSIsIm9uTG9hZCIsImF1ZGlvIiwiZGlyZWN0b3IiLCJnZXRTY2VuZSIsImdldENoaWxkQnlOYW1lIiwiZ2V0Q29tcG9uZW50IiwibWFpbk9iaiIsIndoZWVsTGlzdCIsInN0YXR1cyIsImxhc3RSZXN1bHQiLCJyb2xlUGJMaXN0Iiwicm9sZUlkTGlzdCIsInN0YXJ0IiwiaW5pdFdoZWVsIiwibm9kZSIsInJlbW92ZUFsbENoaWxkcmVuIiwiaSIsImFkZFJvbGUiLCJnZXRSYW5kb21JZCIsInkiLCJyb2xsSW5kZXgiLCJjbG9zZVNoaW5lIiwic3RhcnRSb2xsIiwiYXJncyIsInNldFRpbWVvdXQiLCJ0aW1lciIsImF1dG8iLCJydW5BY3Rpb24iLCJzZXF1ZW5jZSIsImRlbGF5VGltZSIsIm1vdmVUbyIsInYyIiwieCIsImhlaWdodCIsImNhbGxGdW5jIiwicm9sbENhbGxCYWNrIiwiYmluZCIsInJhbmRvbUlkIiwiZnJlZVRpbWVzIiwic3RvcEZyZWUiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJyb2xlUGIiLCJsZW5ndGgiLCJpZCIsInBiIiwiaW5zdGFudGlhdGUiLCJwdXNoIiwiYWRkQ2hpbGQiLCJwbGF5U3RvcFdoZWVsIiwic2xpY2UiLCJzdGF0ZUNhbGxCYWNrIiwic3RvcEltbWVkaWF0ZWx5Iiwic3RvcEFsbEFjdGlvbnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBTUEsT0FBTyxHQUFHLEVBQWhCLEVBQW9COztBQUNwQixJQUFNQyxPQUFPLEdBQUcsQ0FBaEIsRUFBbUI7O0FBRW5CQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFB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LFlBNUZLLDBCQTRGVTtBQUNYLFNBQUtsQyxLQUFMLENBQVdpRCxhQUFYO0FBQ0EsU0FBS3pDLFVBQUwsR0FBa0IsS0FBS0UsVUFBTCxDQUFnQndDLEtBQWhCLENBQXNCLENBQUMsQ0FBdkIsQ0FBbEI7QUFDQSxTQUFLM0MsTUFBTCxHQUFjLENBQWQ7QUFDQSxTQUFLRixPQUFMLENBQWE4QyxhQUFiO0FBQ0gsR0FqR0k7QUFtR0xDLEVBQUFBLGVBbkdLLDZCQW1HYTtBQUFBOztBQUNkLFNBQUs1QyxVQUFMLEdBQWtCLEtBQUtFLFVBQUwsQ0FBZ0J3QyxLQUFoQixDQUFzQixDQUFDLENBQXZCLENBQWxCO0FBQ0EsU0FBS3JDLElBQUwsQ0FBVXdDLGNBQVY7QUFDQTlCLElBQUFBLFVBQVUsQ0FBQyxZQUFNO0FBQ2IsTUFBQSxNQUFJLENBQUNWLElBQUwsQ0FBVUssQ0FBVixHQUFjLENBQUMsTUFBSSxDQUFDTCxJQUFMLENBQVVtQixNQUFYLEdBQW9CLEdBQWxDO0FBQ0gsS0FGUyxFQUVQLEVBRk8sQ0FBVjtBQUdBLFNBQUt6QixNQUFMLEdBQWMsQ0FBZDtBQUNBLFNBQUtGLE9BQUwsQ0FBYThDLGFBQWI7QUFDSDtBQTNHSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBST0xFTlVNID0gNDA7IC8v5q+P5LiA6L2u55qE6KeS6Imy5pWw6YePXHJcbmNvbnN0IFRJTUVNSU4gPSAxOyAvL+esrOS4gOi9ruaRh+WlluaXtumXtFxyXG5cclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICB3aGVlbElkOiAwLFxyXG4gICAgICAgIGV4Y2x1ZGVJZDoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiAwLFxyXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ+S4jeS8muWHuueOsOeahOaVsOWtl2lkJyxcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuXHJcbiAgICBvbkxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5hdWRpbyA9IGNjLmRpcmVjdG9yLmdldFNjZW5lKCkuZ2V0Q2hpbGRCeU5hbWUoJ0NhbnZhcycpLmdldENvbXBvbmVudCgnU0RCR0pBdWRpbycpO1xyXG4gICAgICAgIHRoaXMubWFpbk9iaiA9IGNjLmRpcmVjdG9yLmdldFNjZW5lKCkuZ2V0Q2hpbGRCeU5hbWUoJ0NhbnZhcycpLmdldENvbXBvbmVudCgnU0RCR0pNYWluJyk7XHJcbiAgICAgICAgdGhpcy5tYWluT2JqLndoZWVsTGlzdFt0aGlzLndoZWVsSWRdID0gdGhpcztcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IDA7IC8vMOWBnOatoiAx6L2sIFxyXG4gICAgICAgIHRoaXMubGFzdFJlc3VsdCA9IFswLCAwLCAwLCAwLCAwXTsgLy/kuK3pl7TkuInkvY3mmK/kuIrkuIDlsYDnu5Pmnpwg6aaW5L2N5pyr5bC+5piv5Li65LqG6Ziy5q2i6Zyy5Ye66YOo5YiG6L2s6LW35p2l5LiN5LiA5qC3IFxyXG4gICAgICAgIHRoaXMucm9sZVBiTGlzdCA9IFtdOyAvL3JvbGVzXHJcbiAgICAgICAgdGhpcy5yb2xlSWRMaXN0ID0gW107IC8vcm9sZSBJRFxyXG4gICAgfSxcclxuXHJcbiAgICBzdGFydCgpIHtcclxuICAgICAgICAvL+WIneWni+WMluWcuuaZr3JvbGVcclxuICAgICAgICB0aGlzLmluaXRXaGVlbCgpO1xyXG4gICAgfSxcclxuXHJcbiAgICBpbml0V2hlZWwoKSB7XHJcbiAgICAgICAgdGhpcy5yb2xlUGJMaXN0ID0gW107XHJcbiAgICAgICAgdGhpcy5yb2xlSWRMaXN0ID0gW107XHJcbiAgICAgICAgdGhpcy5ub2RlLnJlbW92ZUFsbENoaWxkcmVuKCk7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBST0xFTlVNIC0gMTI7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmFkZFJvbGUodGhpcy5nZXRSYW5kb21JZCgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hZGRSb2xlKHRoaXMuZ2V0UmFuZG9tSWQoKSk7XHJcbiAgICAgICAgdGhpcy5ub2RlLnkgPSAwOyAgXHJcbiAgICAgICAgdGhpcy5tYWluT2JqLnJvbGxJbmRleCsrO1xyXG4gICAgICAgIHRoaXMubWFpbk9iai5jbG9zZVNoaW5lKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHN0YXJ0Um9sbCguLi5hcmdzKSB7XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSAxO1xyXG4gICAgICAgIHRoaXMucm9sZVBiTGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMucm9sZUlkTGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMubm9kZS5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMubm9kZS55ID0gMDsgLy/mu5rova7lkK/liqjkvY3np7vot53nprtcclxuICAgICAgICBmb3IgKGxldCBpIGluIHRoaXMubGFzdFJlc3VsdCkge1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RSZXN1bHRbaV0gPSB0aGlzLmxhc3RSZXN1bHRbaV0gPT0gMCA/IHRoaXMuZ2V0UmFuZG9tSWQoKSA6IHRoaXMubGFzdFJlc3VsdFtpXTtcclxuICAgICAgICAgICAgdGhpcy5hZGRSb2xlKHRoaXMubGFzdFJlc3VsdFtpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgUk9MRU5VTSAtIDEyOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5hZGRSb2xlKHRoaXMuZ2V0UmFuZG9tSWQoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgaW4gYXJncykge1xyXG4gICAgICAgICAgICB0aGlzLmFkZFJvbGUoYXJnc1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWRkUm9sZSh0aGlzLmdldFJhbmRvbUlkKCkpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICBsZXQgdGltZXIgPSBUSU1FTUlOICsgdGhpcy53aGVlbElkICogMC4yO1xyXG4gICAgICAgICAgICB0aW1lciA9ICF0aGlzLm1haW5PYmouYXV0byA/IFRJTUVNSU4gOiB0aW1lcjtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLnJ1bkFjdGlvbihcclxuICAgICAgICAgICAgICAgIGNjLnNlcXVlbmNlKFxyXG4gICAgICAgICAgICAgICAgICAgIGNjLmRlbGF5VGltZSgwLjIpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNjLm1vdmVUbyh0aW1lciwgY2MudjIodGhpcy5ub2RlLngsIC10aGlzLm5vZGUuaGVpZ2h0ICsgNTg1KSksXHJcbiAgICAgICAgICAgICAgICAgICAgY2MubW92ZVRvKDAuMSwgY2MudjIodGhpcy5ub2RlLngsIC10aGlzLm5vZGUuaGVpZ2h0ICsgNjQwKSksXHJcbiAgICAgICAgICAgICAgICAgICAgY2MubW92ZVRvKDAuMSwgY2MudjIodGhpcy5ub2RlLngsIC10aGlzLm5vZGUuaGVpZ2h0ICsgNTg1KSksXHJcbiAgICAgICAgICAgICAgICAgICAgY2MuY2FsbEZ1bmModGhpcy5yb2xsQ2FsbEJhY2suYmluZCh0aGlzKSlcclxuICAgICAgICAgICAgICAgIClcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9LCAxMDApO1xyXG4gICAgfSxcclxuXHJcbiAgICBnZXRSYW5kb21JZCgpIHtcclxuICAgICAgICBsZXQgcmFuZG9tSWQgPSAwO1xyXG4gICAgICAgIHdoaWxlIChyYW5kb21JZCA9PSAwKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1haW5PYmouZnJlZVRpbWVzID4gMCB8fCB0aGlzLm1haW5PYmouc3RvcEZyZWUpIHtcclxuICAgICAgICAgICAgICAgIHJhbmRvbUlkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHRoaXMubWFpbk9iai5yb2xlUGIubGVuZ3RoIC0gMSkgKyAxKTtcclxuICAgICAgICAgICAgICAgIHJhbmRvbUlkID0gcmFuZG9tSWQgPT0gMTAgPyAxIDogcmFuZG9tSWQ7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByYW5kb21JZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0aGlzLm1haW5PYmoucm9sZVBiLmxlbmd0aCAtIDEpICsgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmFuZG9tSWQgPSByYW5kb21JZCA9PSB0aGlzLmV4Y2x1ZGVJZCA/IDAgOiByYW5kb21JZDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiByYW5kb21JZDtcclxuICAgIH0sXHJcblxyXG4gICAgYWRkUm9sZShpZCkge1xyXG4gICAgICAgIGxldCBwYiA9IGNjLmluc3RhbnRpYXRlKHRoaXMubWFpbk9iai5yb2xlUGJbaWRdKTtcclxuICAgICAgICB0aGlzLnJvbGVQYkxpc3QucHVzaChwYik7XHJcbiAgICAgICAgdGhpcy5yb2xlSWRMaXN0LnB1c2goaWQpO1xyXG4gICAgICAgIHRoaXMubm9kZS5hZGRDaGlsZChwYik7XHJcbiAgICB9LFxyXG5cclxuICAgIHJvbGxDYWxsQmFjaygpIHtcclxuICAgICAgICB0aGlzLmF1ZGlvLnBsYXlTdG9wV2hlZWwoKTtcclxuICAgICAgICB0aGlzLmxhc3RSZXN1bHQgPSB0aGlzLnJvbGVJZExpc3Quc2xpY2UoLTUpO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gMDtcclxuICAgICAgICB0aGlzLm1haW5PYmouc3RhdGVDYWxsQmFjaygpO1xyXG4gICAgfSxcclxuXHJcbiAgICBzdG9wSW1tZWRpYXRlbHkoKSB7XHJcbiAgICAgICAgdGhpcy5sYXN0UmVzdWx0ID0gdGhpcy5yb2xlSWRMaXN0LnNsaWNlKC01KTtcclxuICAgICAgICB0aGlzLm5vZGUuc3RvcEFsbEFjdGlvbnMoKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgdGhpcy5ub2RlLnkgPSAtdGhpcy5ub2RlLmhlaWdodCArIDU4NTtcclxuICAgICAgICB9LCA1MCk7XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSAwO1xyXG4gICAgICAgIHRoaXMubWFpbk9iai5zdGF0ZUNhbGxCYWNrKCk7XHJcbiAgICB9LFxyXG59KTsiXX0=