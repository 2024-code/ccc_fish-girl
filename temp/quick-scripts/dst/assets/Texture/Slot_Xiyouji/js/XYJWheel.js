
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Texture/Slot_Xiyouji/js/XYJWheel.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '3dbdfu2dslKYrFQROqQCQnn', 'XYJWheel');
// Texture/Slot_Xiyouji/js/XYJWheel.js

"use strict";

var ROLENUM = 40; //每一轮的角色数量

var TIMEMIN = 1; //第一轮摇奖时间

cc.Class({
  "extends": cc.Component,
  properties: {
    wheelId: 0,
    excludeId: {
      "default": 0,
      displayName: '不会出现的数字id'
    }
  },
  onLoad: function onLoad() {
    this.audio = cc.director.getScene().getChildByName('Canvas').getComponent('XYJAudio');
    this.mainObj = cc.director.getScene().getChildByName('Canvas').getComponent('XYJMain');
    this.mainObj.wheelList[this.wheelId] = this;
    this.status = 0; //0停止 1转 

    this.lastResult = [0, 0, 0, 0, 0]; //中间三位是上一局结果 首位末尾是为了防止露出部分转起来不一样 

    this.rolePbList = []; //roles

    this.roleIdList = []; //role ID
  },
  start: function start() {
    //初始化场景role
    this.initWheel();
  },
  initWheel: function initWheel() {
    this.rolePbList = [];
    this.roleIdList = [];
    this.node.removeAllChildren();

    for (var i = 0; i < ROLENUM - 12; i++) {
      this.addRole(this.getRandomId());
    }

    this.addRole(this.getRandomId());
    this.node.y = -200;
    this.mainObj.rollIndex++;
    this.mainObj.closeShine();
  },
  startRoll: function startRoll() {
    var _this = this;

    this.status = 1;
    this.rolePbList = [];
    this.roleIdList = [];
    this.node.removeAllChildren();
    this.node.y = -200;

    for (var i in this.lastResult) {
      this.lastResult[i] = this.lastResult[i] == 0 ? this.getRandomId() : this.lastResult[i];
      this.addRole(this.lastResult[i]);
    }

    for (var _i = 0; _i < ROLENUM - 12; _i++) {
      this.addRole(this.getRandomId());
    }

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    for (var _i2 in args) {
      this.addRole(args[_i2]);
    }

    this.addRole(this.getRandomId());
    setTimeout(function () {
      var timer = TIMEMIN + _this.wheelId * 0.2;
      timer = !_this.mainObj.auto ? TIMEMIN : timer;

      _this.node.runAction(cc.sequence(cc.delayTime(0.2), cc.moveTo(timer, cc.v2(_this.node.x, -_this.node.height + 880)), cc.moveTo(0.1, cc.v2(_this.node.x, -_this.node.height + 800)), cc.moveTo(0.1, cc.v2(_this.node.x, -_this.node.height + 880)), cc.callFunc(_this.rollCallBack.bind(_this))));
    }, 100);
  },
  getRandomId: function getRandomId() {
    var randomId = 0;

    while (randomId == 0) {
      if (this.mainObj.freeTimes > 0 || this.mainObj.stopFree) {
        randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);
        randomId = randomId == 9 ? 1 : randomId;
      } else {
        randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);
      }

      randomId = randomId == this.excludeId ? 0 : randomId;
    }

    ;
    return randomId;
  },
  addRole: function addRole(id) {
    var pb = cc.instantiate(this.mainObj.rolePb[id]);
    this.rolePbList.push(pb);
    this.roleIdList.push(id);
    this.node.addChild(pb);
  },
  rollCallBack: function rollCallBack() {
    this.audio.playStopWheel();
    this.lastResult = this.roleIdList.slice(-5);
    this.status = 0;
    this.mainObj.stateCallBack();
  },
  stopImmediately: function stopImmediately() {
    var _this2 = this;

    this.lastResult = this.roleIdList.slice(-5);
    this.node.stopAllActions();
    setTimeout(function () {
      _this2.node.y = -_this2.node.height + 880;
    }, 50);
    this.status = 0;
    this.mainObj.stateCallBack();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcVGV4dHVyZVxcU2xvdF9YaXlvdWppXFxqc1xcWFlKV2hlZWwuanMiXSwibmFtZXMiOlsiUk9MRU5VTSIsIlRJTUVNSU4iLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIndoZWVsSWQiLCJleGNsdWRlSWQiLCJkaXNwbGF5TmFtZSIsIm9uTG9hZCIsImF1ZGlvIiwiZGlyZWN0b3IiLCJnZXRTY2VuZSIsImdldENoaWxkQnlOYW1lIiwiZ2V0Q29tcG9uZW50IiwibWFpbk9iaiIsIndoZWVsTGlzdCIsInN0YXR1cyIsImxhc3RSZXN1bHQiLCJyb2xlUGJMaXN0Iiwicm9sZUlkTGlzdCIsInN0YXJ0IiwiaW5pdFdoZWVsIiwibm9kZSIsInJlbW92ZUFsbENoaWxkcmVuIiwiaSIsImFkZFJvbGUiLCJnZXRSYW5kb21JZCIsInkiLCJyb2xsSW5kZXgiLCJjbG9zZVNoaW5lIiwic3RhcnRSb2xsIiwiYXJncyIsInNldFRpbWVvdXQiLCJ0aW1lciIsImF1dG8iLCJydW5BY3Rpb24iLCJzZXF1ZW5jZSIsImRlbGF5VGltZSIsIm1vdmVUbyIsInYyIiwieCIsImhlaWdodCIsImNhbGxGdW5jIiwicm9sbENhbGxCYWNrIiwiYmluZCIsInJhbmRvbUlkIiwiZnJlZVRpbWVzIiwic3RvcEZyZWUiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJyb2xlUGIiLCJsZW5ndGgiLCJpZCIsInBiIiwiaW5zdGFudGlhdGUiLCJwdXNoIiwiYWRkQ2hpbGQiLCJwbGF5U3RvcFdoZWVsIiwic2xpY2UiLCJzdGF0ZUNhbGxCYWNrIiwic3RvcEltbWVkaWF0ZWx5Iiwic3RvcEFsbEFjdGlvbnMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBTUEsT0FBTyxHQUFHLEVBQWhCLEVBQW9COztBQUNwQixJQUFNQyxPQUFPLEdBQUcsQ0FBaEIsRUFBbUI7O0FBRW5CQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUs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NEZVO0FBQ1gsU0FBS2xDLEtBQUwsQ0FBV2lELGFBQVg7QUFDQSxTQUFLekMsVUFBTCxHQUFrQixLQUFLRSxVQUFMLENBQWdCd0MsS0FBaEIsQ0FBc0IsQ0FBQyxDQUF2QixDQUFsQjtBQUNBLFNBQUszQyxNQUFMLEdBQWMsQ0FBZDtBQUNBLFNBQUtGLE9BQUwsQ0FBYThDLGFBQWI7QUFDSCxHQWpHSTtBQW1HTEMsRUFBQUEsZUFuR0ssNkJBbUdhO0FBQUE7O0FBQ2QsU0FBSzVDLFVBQUwsR0FBa0IsS0FBS0UsVUFBTCxDQUFnQndDLEtBQWhCLENBQXNCLENBQUMsQ0FBdkIsQ0FBbEI7QUFDQSxTQUFLckMsSUFBTCxDQUFVd0MsY0FBVjtBQUNBOUIsSUFBQUEsVUFBVSxDQUFDLFlBQU07QUFDYixNQUFBLE1BQUksQ0FBQ1YsSUFBTCxDQUFVSyxDQUFWLEdBQWMsQ0FBQyxNQUFJLENBQUNMLElBQUwsQ0FBVW1CLE1BQVgsR0FBb0IsR0FBbEM7QUFDSCxLQUZTLEVBRVAsRUFGTyxDQUFWO0FBR0EsU0FBS3pCLE1BQUwsR0FBYyxDQUFkO0FBQ0EsU0FBS0YsT0FBTCxDQUFhOEMsYUFBYjtBQUNIO0FBM0dJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFJPTEVOVU0gPSA0MDsgLy/mr4/kuIDova7nmoTop5LoibLmlbDph49cclxuY29uc3QgVElNRU1JTiA9IDE7IC8v56ys5LiA6L2u5pGH5aWW5pe26Ze0XHJcblxyXG5jYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIHdoZWVsSWQ6IDAsXHJcbiAgICAgICAgZXhjbHVkZUlkOiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IDAsXHJcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lOiAn5LiN5Lya5Ye6546w55qE5pWw5a2XaWQnLFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG5cclxuICAgIG9uTG9hZCgpIHtcclxuICAgICAgICB0aGlzLmF1ZGlvID0gY2MuZGlyZWN0b3IuZ2V0U2NlbmUoKS5nZXRDaGlsZEJ5TmFtZSgnQ2FudmFzJykuZ2V0Q29tcG9uZW50KCdYWUpBdWRpbycpO1xyXG4gICAgICAgIHRoaXMubWFpbk9iaiA9IGNjLmRpcmVjdG9yLmdldFNjZW5lKCkuZ2V0Q2hpbGRCeU5hbWUoJ0NhbnZhcycpLmdldENvbXBvbmVudCgnWFlKTWFpbicpO1xyXG4gICAgICAgIHRoaXMubWFpbk9iai53aGVlbExpc3RbdGhpcy53aGVlbElkXSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSAwOyAvLzDlgZzmraIgMei9rCBcclxuICAgICAgICB0aGlzLmxhc3RSZXN1bHQgPSBbMCwgMCwgMCwgMCwgMF07IC8v5Lit6Ze05LiJ5L2N5piv5LiK5LiA5bGA57uT5p6cIOmmluS9jeacq+WwvuaYr+S4uuS6humYsuatoumcsuWHuumDqOWIhui9rOi1t+adpeS4jeS4gOagtyBcclxuICAgICAgICB0aGlzLnJvbGVQYkxpc3QgPSBbXTsgLy9yb2xlc1xyXG4gICAgICAgIHRoaXMucm9sZUlkTGlzdCA9IFtdOyAvL3JvbGUgSURcclxuICAgIH0sXHJcblxyXG4gICAgc3RhcnQoKSB7XHJcbiAgICAgICAgLy/liJ3lp4vljJblnLrmma9yb2xlXHJcbiAgICAgICAgdGhpcy5pbml0V2hlZWwoKTtcclxuICAgIH0sXHJcblxyXG4gICAgaW5pdFdoZWVsKCkge1xyXG4gICAgICAgIHRoaXMucm9sZVBiTGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMucm9sZUlkTGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMubm9kZS5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgUk9MRU5VTSAtIDEyOyBpKyspIHtcclxuICAgICAgICAgICAgdGhpcy5hZGRSb2xlKHRoaXMuZ2V0UmFuZG9tSWQoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWRkUm9sZSh0aGlzLmdldFJhbmRvbUlkKCkpO1xyXG4gICAgICAgIHRoaXMubm9kZS55ID0gLTIwMDtcclxuICAgICAgICB0aGlzLm1haW5PYmoucm9sbEluZGV4Kys7XHJcbiAgICAgICAgdGhpcy5tYWluT2JqLmNsb3NlU2hpbmUoKTtcclxuICAgIH0sXHJcblxyXG4gICAgc3RhcnRSb2xsKC4uLmFyZ3MpIHtcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IDE7XHJcbiAgICAgICAgdGhpcy5yb2xlUGJMaXN0ID0gW107XHJcbiAgICAgICAgdGhpcy5yb2xlSWRMaXN0ID0gW107XHJcbiAgICAgICAgdGhpcy5ub2RlLnJlbW92ZUFsbENoaWxkcmVuKCk7XHJcbiAgICAgICAgdGhpcy5ub2RlLnkgPSAtMjAwO1xyXG4gICAgICAgIGZvciAobGV0IGkgaW4gdGhpcy5sYXN0UmVzdWx0KSB7XHJcbiAgICAgICAgICAgIHRoaXMubGFzdFJlc3VsdFtpXSA9IHRoaXMubGFzdFJlc3VsdFtpXSA9PSAwID8gdGhpcy5nZXRSYW5kb21JZCgpIDogdGhpcy5sYXN0UmVzdWx0W2ldO1xyXG4gICAgICAgICAgICB0aGlzLmFkZFJvbGUodGhpcy5sYXN0UmVzdWx0W2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBST0xFTlVNIC0gMTI7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmFkZFJvbGUodGhpcy5nZXRSYW5kb21JZCgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSBpbiBhcmdzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkUm9sZShhcmdzW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hZGRSb2xlKHRoaXMuZ2V0UmFuZG9tSWQoKSk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB0aW1lciA9IFRJTUVNSU4gKyB0aGlzLndoZWVsSWQgKiAwLjI7XHJcbiAgICAgICAgICAgIHRpbWVyID0gIXRoaXMubWFpbk9iai5hdXRvID8gVElNRU1JTiA6IHRpbWVyO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUucnVuQWN0aW9uKFxyXG4gICAgICAgICAgICAgICAgY2Muc2VxdWVuY2UoXHJcbiAgICAgICAgICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDAuMiksXHJcbiAgICAgICAgICAgICAgICAgICAgY2MubW92ZVRvKHRpbWVyLCBjYy52Mih0aGlzLm5vZGUueCwgLXRoaXMubm9kZS5oZWlnaHQgKyA4ODApKSxcclxuICAgICAgICAgICAgICAgICAgICBjYy5tb3ZlVG8oMC4xLCBjYy52Mih0aGlzLm5vZGUueCwgLXRoaXMubm9kZS5oZWlnaHQgKyA4MDApKSxcclxuICAgICAgICAgICAgICAgICAgICBjYy5tb3ZlVG8oMC4xLCBjYy52Mih0aGlzLm5vZGUueCwgLXRoaXMubm9kZS5oZWlnaHQgKyA4ODApKSxcclxuICAgICAgICAgICAgICAgICAgICBjYy5jYWxsRnVuYyh0aGlzLnJvbGxDYWxsQmFjay5iaW5kKHRoaXMpKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0sIDEwMCk7XHJcbiAgICB9LFxyXG5cclxuICAgIGdldFJhbmRvbUlkKCkge1xyXG4gICAgICAgIGxldCByYW5kb21JZCA9IDA7XHJcbiAgICAgICAgd2hpbGUgKHJhbmRvbUlkID09IDApIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubWFpbk9iai5mcmVlVGltZXMgPiAwIHx8IHRoaXMubWFpbk9iai5zdG9wRnJlZSkge1xyXG4gICAgICAgICAgICAgICAgcmFuZG9tSWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy5tYWluT2JqLnJvbGVQYi5sZW5ndGggLSAxKSArIDEpO1xyXG4gICAgICAgICAgICAgICAgcmFuZG9tSWQgPSByYW5kb21JZCA9PSA5ID8gMSA6IHJhbmRvbUlkO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmFuZG9tSWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy5tYWluT2JqLnJvbGVQYi5sZW5ndGggLSAxKSArIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJhbmRvbUlkID0gcmFuZG9tSWQgPT0gdGhpcy5leGNsdWRlSWQgPyAwIDogcmFuZG9tSWQ7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gcmFuZG9tSWQ7XHJcbiAgICB9LFxyXG5cclxuICAgIGFkZFJvbGUoaWQpIHtcclxuICAgICAgICBsZXQgcGIgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLm1haW5PYmoucm9sZVBiW2lkXSk7XHJcbiAgICAgICAgdGhpcy5yb2xlUGJMaXN0LnB1c2gocGIpO1xyXG4gICAgICAgIHRoaXMucm9sZUlkTGlzdC5wdXNoKGlkKTtcclxuICAgICAgICB0aGlzLm5vZGUuYWRkQ2hpbGQocGIpO1xyXG4gICAgfSxcclxuXHJcbiAgICByb2xsQ2FsbEJhY2soKSB7XHJcbiAgICAgICAgdGhpcy5hdWRpby5wbGF5U3RvcFdoZWVsKCk7XHJcbiAgICAgICAgdGhpcy5sYXN0UmVzdWx0ID0gdGhpcy5yb2xlSWRMaXN0LnNsaWNlKC01KTtcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IDA7XHJcbiAgICAgICAgdGhpcy5tYWluT2JqLnN0YXRlQ2FsbEJhY2soKTtcclxuICAgIH0sXHJcblxyXG4gICAgc3RvcEltbWVkaWF0ZWx5KCkge1xyXG4gICAgICAgIHRoaXMubGFzdFJlc3VsdCA9IHRoaXMucm9sZUlkTGlzdC5zbGljZSgtNSk7XHJcbiAgICAgICAgdGhpcy5ub2RlLnN0b3BBbGxBY3Rpb25zKCk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS55ID0gLXRoaXMubm9kZS5oZWlnaHQgKyA4ODA7XHJcbiAgICAgICAgfSwgNTApO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gMDtcclxuICAgICAgICB0aGlzLm1haW5PYmouc3RhdGVDYWxsQmFjaygpO1xyXG4gICAgfSxcclxufSk7Il19