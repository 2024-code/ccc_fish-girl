
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Texture/Slot_EgyptianTreasures/js/EFWheel.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '7c6c1r8W+ZBkZAF6ABKc9cW', 'EFWheel');
// Texture/Slot_EgyptianTreasures/js/EFWheel.js

"use strict";

var ROLENUM = 40; //每一轮的角色数量

var TIMEMIN = 1; //第一轮摇奖时间

cc.Class({
  "extends": cc.Component,
  properties: {
    wheelId: 0,
    excludeId: {
      "default": 0,
      displayName: '不会出现的数字id'
    }
  },
  onLoad: function onLoad() {
    this.audio = cc.director.getScene().getChildByName('Canvas').getComponent('EFAudio');
    this.mainObj = cc.director.getScene().getChildByName('Canvas').getComponent('EFMain');
    this.mainObj.wheelList[this.wheelId] = this;
    this.status = 0; //0停止 1转 

    this.lastResult = [0, 0, 0, 0, 0]; //中间三位是上一局结果 首位末尾是为了防止露出部分转起来不一样 

    this.rolePbList = []; //role

    this.roleIdList = []; //role ID
  },
  start: function start() {
    //初始化场景role
    this.initWheel();
  },
  initWheel: function initWheel() {
    this.rolePbList = [];
    this.roleIdList = [];
    this.node.removeAllChildren();

    for (var i in this.lastResult) {
      this.lastResult[i] = this.getRandomId();
      this.addRole(this.lastResult[i]);
    }

    this.addRole(this.getRandomId());
    this.node.y = -250;
    this.mainObj.rollIndex++;
    this.mainObj.closeShine();
  },
  startRoll: function startRoll() {
    var _this = this;

    this.status = 1;
    this.rolePbList = [];
    this.roleIdList = [];
    this.node.removeAllChildren();
    this.node.y = -250;

    for (var i in this.lastResult) {
      this.lastResult[i] = this.lastResult[i] == 0 ? this.getRandomId() : this.lastResult[i];
      this.addRole(this.lastResult[i]);
    }

    for (var _i = 0; _i < ROLENUM - 9; _i++) {
      this.addRole(this.getRandomId());
    }

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    for (var _i2 in args) {
      this.addRole(args[_i2]);
    }

    this.addRole(this.getRandomId());
    setTimeout(function () {
      var timer = TIMEMIN + _this.wheelId * 0.2;
      timer = !_this.mainObj.auto ? TIMEMIN : timer;

      _this.node.runAction(cc.sequence(cc.delayTime(0.2), cc.moveTo(timer, cc.v2(_this.node.x, -_this.node.height + 935)), cc.moveTo(0.1, cc.v2(_this.node.x, -_this.node.height + 850)), cc.moveTo(0.1, cc.v2(_this.node.x, -_this.node.height + 935)), cc.callFunc(_this.rollCallBack.bind(_this))));
    }, 100);
  },
  getRandomId: function getRandomId() {
    var randomId = 0;

    while (randomId == 0) {
      if (this.mainObj.freeTimes > 0 || this.mainObj.stopFree) {
        var hashSet = null;

        if (this.wheelId == 0 || this.wheelId == 2 || this.wheelId == 4) {
          hashSet = new Set([12].concat(this.mainObj.bigWinResList));
        } else if (this.wheelId == 1 || this.wheelId == 3) {
          hashSet = new Set([11].concat(this.mainObj.bigWinResList));
        }

        randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);
        randomId = hashSet.has(randomId) ? randomId : 0;
      } else {
        randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);

        if (this.wheelId == 1 || this.wheelId == 3) {
          randomId = randomId == 11 ? 0 : randomId;
        }
      }

      randomId = randomId == this.excludeId ? 0 : randomId;
    }

    ;
    return randomId;
  },
  addRole: function addRole(id) {
    var pb = cc.instantiate(this.mainObj.rolePb[id]);
    this.rolePbList.push(pb);
    this.roleIdList.push(id);
    this.node.addChild(pb);
  },
  rollCallBack: function rollCallBack() {
    this.audio.playStopWheel();
    this.lastResult = this.roleIdList.slice(-5);
    this.status = 0;
    this.mainObj.stateCallBack();
  },
  stopImmediately: function stopImmediately() {
    var _this2 = this;

    this.lastResult = this.roleIdList.slice(-5);
    this.node.stopAllActions();
    setTimeout(function () {
      _this2.node.y = -_this2.node.height + 935;
    }, 50);
    this.status = 0;
    this.mainObj.stateCallBack();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcVGV4dHVyZVxcU2xvdF9FZ3lwdGlhblRyZWFzdXJlc1xcanNcXEVGV2hlZWwuanMiXSwibmFtZXMiOlsiUk9MRU5VTSIsIlRJTUVNSU4iLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsIndoZWVsSWQiLCJleGNsdWRlSWQiLCJkaXNwbGF5TmFtZSIsIm9uTG9hZCIsImF1ZGlvIiwiZGlyZWN0b3IiLCJnZXRTY2VuZSIsImdldENoaWxkQnlOYW1lIiwiZ2V0Q29tcG9uZW50IiwibWFpbk9iaiIsIndoZWVsTGlzdCIsInN0YXR1cyIsImxhc3RSZXN1bHQiLCJyb2xlUGJMaXN0Iiwicm9sZUlkTGlzdCIsInN0YXJ0IiwiaW5pdFdoZWVsIiwibm9kZSIsInJlbW92ZUFsbENoaWxkcmVuIiwiaSIsImdldFJhbmRvbUlkIiwiYWRkUm9sZSIsInkiLCJyb2xsSW5kZXgiLCJjbG9zZVNoaW5lIiwic3RhcnRSb2xsIiwiYXJncyIsInNldFRpbWVvdXQiLCJ0aW1lciIsImF1dG8iLCJydW5BY3Rpb24iLCJzZXF1ZW5jZSIsImRlbGF5VGltZSIsIm1vdmVUbyIsInYyIiwieCIsImhlaWdodCIsImNhbGxGdW5jIiwicm9sbENhbGxCYWNrIiwiYmluZCIsInJhbmRvbUlkIiwiZnJlZVRpbWVzIiwic3RvcEZyZWUiLCJoYXNoU2V0IiwiU2V0IiwiYmlnV2luUmVzTGlzdCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInJvbGVQYiIsImxlbmd0aCIsImhhcyIsImlkIiwicGIiLCJpbnN0YW50aWF0ZSIsInB1c2giLCJhZGRDaGlsZCIsInBsYXlTdG9wV2hlZWwiLCJzbGljZSIsInN0YXRlQ2FsbEJhY2siLCJzdG9wSW1tZWRpYXRlbHkiLCJzdG9wQWxsQWN0aW9ucyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFNQSxPQUFPLEdBQUcsRUFBaEIsRUFBb0I7O0FBQ3BCLElBQU1DLE9BQU8sR0FBRyxDQUFoQixFQUFtQjs7QUFFbkJDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxPQUFPLEVBQUUsQ0FERDtBQUVSQyxJQUFBQSxTQUFTLEVBQUU7QUFDUCxpQkFBUyxDQURGO0FBRVBDLE1BQUFBLFdBQVcsRUFBRTtBQUZOO0FBRkgsR0FIUDtBQVdMQyxFQUFBQSxNQVhLLG9CQVdJO0FBQ0wsU0FBS0MsS0FBTCxHQUFhUixFQUFFLENBQUNTLFFBQUgsQ0FBWUMsUUFBWixHQUF1QkMsY0FBdkIsQ0FBc0MsUUFBdEMsRUFBZ0RDLFlBQWhELENBQTZELFNBQTdELENBQWI7QUFDQSxTQUFLQyxPQUFMLEdBQWViLEVBQUUsQ0FBQ1MsUUFBSCxDQUFZQyxRQUFaLEdBQXVCQyxjQUF2QixDQUFzQyxRQUF0QyxFQUFnREMsWUFBaEQsQ0FBNkQsUUFBN0QsQ0FBZjtBQUNBLFNBQUtDLE9BQUwsQ0FBYUMsU0FBYixDQUF1QixLQUFLVixPQUE1QixJQUF1QyxJQUF2QztBQUNBLFNBQUtXLE1BQUwsR0FBYyxDQUFkLENBSkssQ0FJWTs7QUFDakIsU0FBS0MsVUFBTCxHQUFrQixDQUFDLENBQUQsRUFBSSxDQUFKLEVBQU8sQ0FBUCxFQUFVLENBQVYsRUFBYSxDQUFiLENBQWxCLENBTEssQ0FLOEI7O0FBQ25DLFNBQUtDLFVBQUwsR0FBa0IsRUFBbEIsQ0FOSyxDQU1pQjs7QUFDdEIsU0FBS0MsVUFBTCxHQUFrQixFQUFsQixDQVBLLENBT2lCO0FBQ3pCLEdBbkJJO0FBcUJMQyxFQUFBQSxLQXJCSyxtQkFxQkc7QUFDSjtBQUNBLFNBQUtDLFNBQUw7QUFDSCxHQXhCSTtBQTBCTEEsRUFBQUEsU0ExQkssdUJBMEJPO0FBQ1IsU0FBS0gsVUFBTCxHQUFrQixFQUFsQjtBQUNBLFNBQUtDLFVBQUwsR0FBa0IsRUFBbEI7QUFDQSxTQUFLRyxJQUFMLENBQVVDLGlCQUFWOztBQUNBLFNBQUssSUFBSUMsQ0FBVCxJQUFjLEtBQUtQLFVBQW5CLEVBQStCO0FBQzNCLFdBQUtBLFVBQUwsQ0FBZ0JPLENBQWhCLElBQXFCLEtBQUtDLFdBQUwsRUFBckI7QUFDQSxXQUFLQyxPQUFMLENBQWEsS0FBS1QsVUFBTCxDQUFnQk8sQ0FBaEIsQ0FBYjtBQUNIOztBQUNELFNBQUtFLE9BQUwsQ0FBYSxLQUFLRCxXQUFMLEVBQWI7QUFDQSxTQUFLSCxJQUFMLENBQVVLLENBQVYsR0FBYyxDQUFDLEdBQWY7QUFDQSxTQUFLYixPQUFMLENBQWFjLFNBQWI7QUFDQSxTQUFLZCxPQUFMLENBQWFlLFVBQWI7QUFDSCxHQXRDSTtBQXdDTEMsRUFBQUEsU0F4Q0ssdUJBd0NjO0FBQUE7O0FBQ2YsU0FBS2QsTUFBTCxHQUFjLENBQWQ7QUFDQSxTQUFLRSxVQUFMLEdBQWtCLEVBQWxCO0FBQ0EsU0FBS0MsVUFBTCxHQUFrQixFQUFsQjtBQUNBLFNBQUtHLElBQUwsQ0FBVUMsaUJBQVY7QUFDQSxTQUFLRCxJQUFMLENBQVVLLENBQVYsR0FBYyxDQUFDLEdBQWY7O0FBQ0EsU0FBSyxJQUFJSCxDQUFULElBQWMsS0FBS1AsVUFBbkIsRUFBK0I7QUFDM0IsV0FBS0EsVUFBTCxDQUFnQk8sQ0FBaEIsSUFBcUIsS0FBS1AsVUFBTCxDQUFnQk8sQ0FBaEIsS0FBc0IsQ0FBdEIsR0FBMEIsS0FBS0MsV0FBTCxFQUExQixHQUErQyxLQUFLUixVQUFMLENBQWdCTyxDQUFoQixDQUFwRTtBQUNBLFdBQUtFLE9BQUwsQ0FBYSxLQUFLVCxVQUFMLENBQWdCTyxDQUFoQixDQUFiO0FBQ0g7O0FBQ0QsU0FBSyxJQUFJQSxFQUFDLEdBQUcsQ0FBYixFQUFnQkEsRUFBQyxHQUFHekIsT0FBTyxHQUFHLENBQTlCLEVBQWlDeUIsRUFBQyxFQUFsQyxFQUFzQztBQUNsQyxXQUFLRSxPQUFMLENBQWEsS0FBS0QsV0FBTCxFQUFiO0FBQ0g7O0FBWmMsc0NBQU5NLElBQU07QUFBTkEsTUFBQUEsSUFBTTtBQUFBOztBQWFmLFNBQUssSUFBSVAsR0FBVCxJQUFjTyxJQUFkLEVBQW9CO0FBQ2hCLFdBQUtMLE9BQUwsQ0FBYUssSUFBSSxDQUFDUCxHQUFELENBQWpCO0FBQ0g7O0FBQ0QsU0FBS0UsT0FBTCxDQUFhLEtBQUtELFdBQUwsRUFBYjtBQUNBTyxJQUFBQSxVQUFVLENBQUMsWUFBTTtBQUNiLFVBQUlDLEtBQUssR0FBR2pDLE9BQU8sR0FBRyxLQUFJLENBQUNLLE9BQUwsR0FBZSxHQUFyQztBQUNBNEIsTUFBQUEsS0FBSyxHQUFHLENBQUMsS0FBSSxDQUFDbkIsT0FBTCxDQUFhb0IsSUFBZCxHQUFxQmxDLE9BQXJCLEdBQStCaUMsS0FBdkM7O0FBQ0EsTUFBQSxLQUFJLENBQUNYLElBQUwsQ0FBVWEsU0FBVixDQUNJbEMsRUFBRSxDQUFDbUMsUUFBSCxDQUNJbkMsRUFBRSxDQUFDb0MsU0FBSCxDQUFhLEdBQWIsQ0FESixFQUVJcEMsRUFBRSxDQUFDcUMsTUFBSCxDQUFVTCxLQUFWLEVBQWlCaEMsRUFBRSxDQUFDc0MsRUFBSCxDQUFNLEtBQUksQ0FBQ2pCLElBQUwsQ0FBVWtCLENBQWhCLEVBQW1CLENBQUMsS0FBSSxDQUFDbEIsSUFBTCxDQUFVbUIsTUFBWCxHQUFvQixHQUF2QyxDQUFqQixDQUZKLEVBR0l4QyxFQUFFLENBQUNxQyxNQUFILENBQVUsR0FBVixFQUFlckMsRUFBRSxDQUFDc0MsRUFBSCxDQUFNLEtBQUksQ0FBQ2pCLElBQUwsQ0FBVWtCLENBQWhCLEVBQW1CLENBQUMsS0FBSSxDQUFDbEIsSUFBTCxDQUFVbUIsTUFBWCxHQUFvQixHQUF2QyxDQUFmLENBSEosRUFJSXhDLEVBQUUsQ0FBQ3FDLE1BQUgsQ0FBVSxHQUFWLEVBQWVyQyxFQUFFLENBQUNzQyxFQUFILENBQU0sS0FBSSxDQUFDakIsSUFBTCxDQUFVa0IsQ0FBaEIsRUFBbUIsQ0FBQyxLQUFJLENBQUNsQixJQUFMLENBQVVtQixNQUFYLEdBQW9CLEdBQXZDLENBQWYsQ0FKSixFQUtJeEMsRUFBRSxDQUFDeUMsUUFBSCxDQUFZLEtBQUksQ0FBQ0MsWUFBTCxDQUFrQkMsSUFBbEIsQ0FBdUIsS0FBdkIsQ0FBWixDQUxKLENBREo7QUFTSCxLQVpTLEVBWVAsR0FaTyxDQUFWO0FBYUgsR0F0RUk7QUF3RUxuQixFQUFBQSxXQXhFSyx5QkF3RVM7QUFDVixRQUFJb0IsUUFBUSxHQUFHLENBQWY7O0FBQ0EsV0FBT0EsUUFBUSxJQUFJLENBQW5CLEVBQXNCO0FBQ2xCLFVBQUksS0FBSy9CLE9BQUwsQ0FBYWdDLFNBQWIsR0FBeUIsQ0FBekIsSUFBOEIsS0FBS2hDLE9BQUwsQ0FBYWlDLFFBQS9DLEVBQXlEO0FBQ3JELFlBQUlDLE9BQU8sR0FBRyxJQUFkOztBQUNBLFlBQUksS0FBSzNDLE9BQUwsSUFBZ0IsQ0FBaEIsSUFBcUIsS0FBS0EsT0FBTCxJQUFnQixDQUFyQyxJQUEwQyxLQUFLQSxPQUFMLElBQWdCLENBQTlELEVBQWlFO0FBQzdEMkMsVUFBQUEsT0FBTyxHQUFHLElBQUlDLEdBQUosRUFBUyxFQUFULFNBQWdCLEtBQUtuQyxPQUFMLENBQWFvQyxhQUE3QixFQUFWO0FBQ0gsU0FGRCxNQUVPLElBQUksS0FBSzdDLE9BQUwsSUFBZ0IsQ0FBaEIsSUFBcUIsS0FBS0EsT0FBTCxJQUFnQixDQUF6QyxFQUE0QztBQUMvQzJDLFVBQUFBLE9BQU8sR0FBRyxJQUFJQyxHQUFKLEVBQVMsRUFBVCxTQUFnQixLQUFLbkMsT0FBTCxDQUFhb0MsYUFBN0IsRUFBVjtBQUNIOztBQUNETCxRQUFBQSxRQUFRLEdBQUdNLElBQUksQ0FBQ0MsS0FBTCxDQUFXRCxJQUFJLENBQUNFLE1BQUwsTUFBaUIsS0FBS3ZDLE9BQUwsQ0FBYXdDLE1BQWIsQ0FBb0JDLE1BQXBCLEdBQTZCLENBQTlDLElBQW1ELENBQTlELENBQVg7QUFDQVYsUUFBQUEsUUFBUSxHQUFHRyxPQUFPLENBQUNRLEdBQVIsQ0FBWVgsUUFBWixJQUF3QkEsUUFBeEIsR0FBbUMsQ0FBOUM7QUFDSCxPQVRELE1BU087QUFDSEEsUUFBQUEsUUFBUSxHQUFHTSxJQUFJLENBQUNDLEtBQUwsQ0FBV0QsSUFBSSxDQUFDRSxNQUFMLE1BQWlCLEtBQUt2QyxPQUFMLENBQWF3QyxNQUFiLENBQW9CQyxNQUFwQixHQUE2QixDQUE5QyxJQUFtRCxDQUE5RCxDQUFYOztBQUNBLFlBQUksS0FBS2xELE9BQUwsSUFBZ0IsQ0FBaEIsSUFBcUIsS0FBS0EsT0FBTCxJQUFnQixDQUF6QyxFQUE0QztBQUN4Q3dDLFVBQUFBLFFBQVEsR0FBR0EsUUFBUSxJQUFJLEVBQVosR0FBaUIsQ0FBakIsR0FBcUJBLFFBQWhDO0FBQ0g7QUFDSjs7QUFDREEsTUFBQUEsUUFBUSxHQUFHQSxRQUFRLElBQUksS0FBS3ZDLFNBQWpCLEdBQTZCLENBQTdCLEdBQWlDdUMsUUFBNUM7QUFDSDs7QUFBQTtBQUNELFdBQU9BLFFBQVA7QUFDSCxHQTdGSTtBQStGTG5CLEVBQUFBLE9BL0ZLLG1CQStGRytCLEVBL0ZILEVBK0ZPO0FBQ1IsUUFBSUMsRUFBRSxHQUFHekQsRUFBRSxDQUFDMEQsV0FBSCxDQUFlLEtBQUs3QyxPQUFMLENBQWF3QyxNQUFiLENBQW9CRyxFQUFwQixDQUFmLENBQVQ7QUFDQSxTQUFLdkMsVUFBTCxDQUFnQjBDLElBQWhCLENBQXFCRixFQUFyQjtBQUNBLFNBQUt2QyxVQUFMLENBQWdCeUMsSUFBaEIsQ0FBcUJILEVBQXJCO0FBQ0EsU0FBS25DLElBQUwsQ0FBVXVDLFFBQVYsQ0FBbUJILEVBQW5CO0FBQ0gsR0FwR0k7QUFzR0xmLEVBQUFBLFlBdEdLLDBCQXNHVTtBQUNYLFNBQUtsQyxLQUFMLENBQVdxRCxhQUFYO0FBQ0EsU0FBSzdDLFVBQUwsR0FBa0IsS0FBS0UsVUFBTCxDQUFnQjRDLEtBQWhCLENBQXNCLENBQUMsQ0FBdkIsQ0FBbEI7QUFDQSxTQUFLL0MsTUFBTCxHQUFjLENBQWQ7QUFDQSxTQUFLRixPQUFMLENBQWFrRCxhQUFiO0FBQ0gsR0EzR0k7QUE2R0xDLEVBQUFBLGVBN0dLLDZCQTZHYTtBQUFBOztBQUNkLFNBQUtoRCxVQUFMLEdBQWtCLEtBQUtFLFVBQUwsQ0FBZ0I0QyxLQUFoQixDQUFzQixDQUFDLENBQXZCLENBQWxCO0FBQ0EsU0FBS3pDLElBQUwsQ0FBVTRDLGNBQVY7QUFDQWxDLElBQUFBLFVBQVUsQ0FBQyxZQUFNO0FBQ2IsTUFBQSxNQUFJLENBQUNWLElBQUwsQ0FBVUssQ0FBVixHQUFjLENBQUMsTUFBSSxDQUFDTCxJQUFMLENBQVVtQixNQUFYLEdBQW9CLEdBQWxDO0FBQ0gsS0FGUyxFQUVQLEVBRk8sQ0FBVjtBQUdBLFNBQUt6QixNQUFMLEdBQWMsQ0FBZDtBQUNBLFNBQUtGLE9BQUwsQ0FBYWtELGFBQWI7QUFDSDtBQXJISSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBST0xFTlVNID0gNDA7IC8v5q+P5LiA6L2u55qE6KeS6Imy5pWw6YePXHJcbmNvbnN0IFRJTUVNSU4gPSAxOyAvL+esrOS4gOi9ruaRh+WlluaXtumXtFxyXG5cclxuY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICB3aGVlbElkOiAwLFxyXG4gICAgICAgIGV4Y2x1ZGVJZDoge1xyXG4gICAgICAgICAgICBkZWZhdWx0OiAwLFxyXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogJ+S4jeS8muWHuueOsOeahOaVsOWtl2lkJyxcclxuICAgICAgICB9LFxyXG4gICAgfSxcclxuXHJcbiAgICBvbkxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5hdWRpbyA9IGNjLmRpcmVjdG9yLmdldFNjZW5lKCkuZ2V0Q2hpbGRCeU5hbWUoJ0NhbnZhcycpLmdldENvbXBvbmVudCgnRUZBdWRpbycpO1xyXG4gICAgICAgIHRoaXMubWFpbk9iaiA9IGNjLmRpcmVjdG9yLmdldFNjZW5lKCkuZ2V0Q2hpbGRCeU5hbWUoJ0NhbnZhcycpLmdldENvbXBvbmVudCgnRUZNYWluJyk7XHJcbiAgICAgICAgdGhpcy5tYWluT2JqLndoZWVsTGlzdFt0aGlzLndoZWVsSWRdID0gdGhpcztcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IDA7IC8vMOWBnOatoiAx6L2sIFxyXG4gICAgICAgIHRoaXMubGFzdFJlc3VsdCA9IFswLCAwLCAwLCAwLCAwXTsgLy/kuK3pl7TkuInkvY3mmK/kuIrkuIDlsYDnu5Pmnpwg6aaW5L2N5pyr5bC+5piv5Li65LqG6Ziy5q2i6Zyy5Ye66YOo5YiG6L2s6LW35p2l5LiN5LiA5qC3IFxyXG4gICAgICAgIHRoaXMucm9sZVBiTGlzdCA9IFtdOyAvL3JvbGVcclxuICAgICAgICB0aGlzLnJvbGVJZExpc3QgPSBbXTsgLy9yb2xlIElEXHJcbiAgICB9LFxyXG5cclxuICAgIHN0YXJ0KCkge1xyXG4gICAgICAgIC8v5Yid5aeL5YyW5Zy65pmvcm9sZVxyXG4gICAgICAgIHRoaXMuaW5pdFdoZWVsKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIGluaXRXaGVlbCgpIHtcclxuICAgICAgICB0aGlzLnJvbGVQYkxpc3QgPSBbXTtcclxuICAgICAgICB0aGlzLnJvbGVJZExpc3QgPSBbXTtcclxuICAgICAgICB0aGlzLm5vZGUucmVtb3ZlQWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICBmb3IgKGxldCBpIGluIHRoaXMubGFzdFJlc3VsdCkge1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RSZXN1bHRbaV0gPSB0aGlzLmdldFJhbmRvbUlkKCk7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkUm9sZSh0aGlzLmxhc3RSZXN1bHRbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFkZFJvbGUodGhpcy5nZXRSYW5kb21JZCgpKTtcclxuICAgICAgICB0aGlzLm5vZGUueSA9IC0yNTA7XHJcbiAgICAgICAgdGhpcy5tYWluT2JqLnJvbGxJbmRleCsrO1xyXG4gICAgICAgIHRoaXMubWFpbk9iai5jbG9zZVNoaW5lKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHN0YXJ0Um9sbCguLi5hcmdzKSB7XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSAxO1xyXG4gICAgICAgIHRoaXMucm9sZVBiTGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMucm9sZUlkTGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMubm9kZS5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIHRoaXMubm9kZS55ID0gLTI1MDtcclxuICAgICAgICBmb3IgKGxldCBpIGluIHRoaXMubGFzdFJlc3VsdCkge1xyXG4gICAgICAgICAgICB0aGlzLmxhc3RSZXN1bHRbaV0gPSB0aGlzLmxhc3RSZXN1bHRbaV0gPT0gMCA/IHRoaXMuZ2V0UmFuZG9tSWQoKSA6IHRoaXMubGFzdFJlc3VsdFtpXTtcclxuICAgICAgICAgICAgdGhpcy5hZGRSb2xlKHRoaXMubGFzdFJlc3VsdFtpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgUk9MRU5VTSAtIDk7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmFkZFJvbGUodGhpcy5nZXRSYW5kb21JZCgpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSBpbiBhcmdzKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkUm9sZShhcmdzW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5hZGRSb2xlKHRoaXMuZ2V0UmFuZG9tSWQoKSk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCB0aW1lciA9IFRJTUVNSU4gKyB0aGlzLndoZWVsSWQgKiAwLjI7XHJcbiAgICAgICAgICAgIHRpbWVyID0gIXRoaXMubWFpbk9iai5hdXRvID8gVElNRU1JTiA6IHRpbWVyO1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUucnVuQWN0aW9uKFxyXG4gICAgICAgICAgICAgICAgY2Muc2VxdWVuY2UoXHJcbiAgICAgICAgICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDAuMiksXHJcbiAgICAgICAgICAgICAgICAgICAgY2MubW92ZVRvKHRpbWVyLCBjYy52Mih0aGlzLm5vZGUueCwgLXRoaXMubm9kZS5oZWlnaHQgKyA5MzUpKSxcclxuICAgICAgICAgICAgICAgICAgICBjYy5tb3ZlVG8oMC4xLCBjYy52Mih0aGlzLm5vZGUueCwgLXRoaXMubm9kZS5oZWlnaHQgKyA4NTApKSxcclxuICAgICAgICAgICAgICAgICAgICBjYy5tb3ZlVG8oMC4xLCBjYy52Mih0aGlzLm5vZGUueCwgLXRoaXMubm9kZS5oZWlnaHQgKyA5MzUpKSxcclxuICAgICAgICAgICAgICAgICAgICBjYy5jYWxsRnVuYyh0aGlzLnJvbGxDYWxsQmFjay5iaW5kKHRoaXMpKVxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgIH0sIDEwMCk7XHJcbiAgICB9LFxyXG5cclxuICAgIGdldFJhbmRvbUlkKCkge1xyXG4gICAgICAgIGxldCByYW5kb21JZCA9IDA7XHJcbiAgICAgICAgd2hpbGUgKHJhbmRvbUlkID09IDApIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubWFpbk9iai5mcmVlVGltZXMgPiAwIHx8IHRoaXMubWFpbk9iai5zdG9wRnJlZSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGhhc2hTZXQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMud2hlZWxJZCA9PSAwIHx8IHRoaXMud2hlZWxJZCA9PSAyIHx8IHRoaXMud2hlZWxJZCA9PSA0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaGFzaFNldCA9IG5ldyBTZXQoWzEyLCAuLi50aGlzLm1haW5PYmouYmlnV2luUmVzTGlzdF0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLndoZWVsSWQgPT0gMSB8fCB0aGlzLndoZWVsSWQgPT0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgIGhhc2hTZXQgPSBuZXcgU2V0KFsxMSwgLi4udGhpcy5tYWluT2JqLmJpZ1dpblJlc0xpc3RdKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJhbmRvbUlkID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHRoaXMubWFpbk9iai5yb2xlUGIubGVuZ3RoIC0gMSkgKyAxKTtcclxuICAgICAgICAgICAgICAgIHJhbmRvbUlkID0gaGFzaFNldC5oYXMocmFuZG9tSWQpID8gcmFuZG9tSWQgOiAwO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmFuZG9tSWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy5tYWluT2JqLnJvbGVQYi5sZW5ndGggLSAxKSArIDEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMud2hlZWxJZCA9PSAxIHx8IHRoaXMud2hlZWxJZCA9PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmFuZG9tSWQgPSByYW5kb21JZCA9PSAxMSA/IDAgOiByYW5kb21JZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByYW5kb21JZCA9IHJhbmRvbUlkID09IHRoaXMuZXhjbHVkZUlkID8gMCA6IHJhbmRvbUlkO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIHJhbmRvbUlkO1xyXG4gICAgfSxcclxuXHJcbiAgICBhZGRSb2xlKGlkKSB7XHJcbiAgICAgICAgbGV0IHBiID0gY2MuaW5zdGFudGlhdGUodGhpcy5tYWluT2JqLnJvbGVQYltpZF0pO1xyXG4gICAgICAgIHRoaXMucm9sZVBiTGlzdC5wdXNoKHBiKTtcclxuICAgICAgICB0aGlzLnJvbGVJZExpc3QucHVzaChpZCk7XHJcbiAgICAgICAgdGhpcy5ub2RlLmFkZENoaWxkKHBiKTtcclxuICAgIH0sXHJcblxyXG4gICAgcm9sbENhbGxCYWNrKCkge1xyXG4gICAgICAgIHRoaXMuYXVkaW8ucGxheVN0b3BXaGVlbCgpO1xyXG4gICAgICAgIHRoaXMubGFzdFJlc3VsdCA9IHRoaXMucm9sZUlkTGlzdC5zbGljZSgtNSk7XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSAwO1xyXG4gICAgICAgIHRoaXMubWFpbk9iai5zdGF0ZUNhbGxCYWNrKCk7XHJcbiAgICB9LFxyXG5cclxuICAgIHN0b3BJbW1lZGlhdGVseSgpIHtcclxuICAgICAgICB0aGlzLmxhc3RSZXN1bHQgPSB0aGlzLnJvbGVJZExpc3Quc2xpY2UoLTUpO1xyXG4gICAgICAgIHRoaXMubm9kZS5zdG9wQWxsQWN0aW9ucygpO1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLm5vZGUueSA9IC10aGlzLm5vZGUuaGVpZ2h0ICsgOTM1O1xyXG4gICAgICAgIH0sIDUwKTtcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IDA7XHJcbiAgICAgICAgdGhpcy5tYWluT2JqLnN0YXRlQ2FsbEJhY2soKTtcclxuICAgIH0sXHJcbn0pOyJdfQ==