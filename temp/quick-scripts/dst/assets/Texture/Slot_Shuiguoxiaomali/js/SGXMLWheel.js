
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Texture/Slot_Shuiguoxiaomali/js/SGXMLWheel.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'c3221DvGIJBVq8NclLRhdb4', 'SGXMLWheel');
// Texture/Slot_Shuiguoxiaomali/js/SGXMLWheel.js

"use strict";

var ROLENUM = 40; //每一轮的角色数量

var TIMEMIN = 1; //第一轮摇奖时间

cc.Class({
  "extends": cc.Component,
  properties: {
    wheelId: 0,
    excludeId: {
      "default": 0,
      displayName: '不会出现的数字id'
    }
  },
  onLoad: function onLoad() {
    this.audio = cc.director.getScene().getChildByName('Canvas').getComponent('SGXMLAudio');
    this.mainObj = cc.director.getScene().getChildByName('Canvas').getComponent('SGXMLMain');
    this.mainObj.wheelList[this.wheelId] = this;
    this.status = 0; //0停止 1转 

    this.lastResult = [0, 0, 0, 0, 0]; //中间三位是上一局结果 首位末尾是为了防止露出部分转起来不一样 

    this.rolePbList = []; //roles

    this.roleIdList = []; //role ID
  },
  start: function start() {
    //初始化场景role
    this.initWheel();
  },
  initWheel: function initWheel() {
    this.rolePbList = [];
    this.roleIdList = [];
    this.node.removeAllChildren();

    for (var i in this.lastResult) {
      this.lastResult[i] = this.getRandomId();
      this.addRole(this.lastResult[i]);
    }

    this.addRole(this.getRandomId());
    this.node.y = 0;
    this.mainObj.rollIndex++;
    this.mainObj.closeShine();
  },
  startRoll: function startRoll() {
    var _this = this;

    this.status = 1;
    this.rolePbList = [];
    this.roleIdList = [];
    this.node.removeAllChildren();
    this.node.y = 0; //滚轮启动位移距离

    for (var i in this.lastResult) {
      this.lastResult[i] = this.lastResult[i] == 0 ? this.getRandomId() : this.lastResult[i];
      this.addRole(this.lastResult[i]);
    }

    for (var _i = 0; _i < ROLENUM - 12; _i++) {
      this.addRole(this.getRandomId());
    }

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    for (var _i2 in args) {
      this.addRole(args[_i2]);
    }

    this.addRole(this.getRandomId());
    setTimeout(function () {
      var timer = TIMEMIN + _this.wheelId * 0.2;
      timer = !_this.mainObj.auto ? TIMEMIN : timer;

      _this.node.runAction(cc.sequence(cc.delayTime(0.2), cc.moveTo(timer, cc.v2(_this.node.x, -_this.node.height + 485)), cc.moveTo(0.1, cc.v2(_this.node.x, -_this.node.height + 500)), cc.moveTo(0.1, cc.v2(_this.node.x, -_this.node.height + 485)), cc.callFunc(_this.rollCallBack.bind(_this))));
    }, 100);
  },
  getRandomId: function getRandomId() {
    var randomId = 0;

    while (randomId == 0) {
      if (this.mainObj.freeTimes > 0 || this.mainObj.stopFree) {
        randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);
        randomId = randomId == 6 ? 12 : randomId;
      } else {
        randomId = Math.floor(Math.random() * (this.mainObj.rolePb.length - 1) + 1);
      }

      randomId = randomId == this.excludeId ? 0 : randomId;
    }

    ;
    return randomId;
  },
  addRole: function addRole(id) {
    var pb = cc.instantiate(this.mainObj.rolePb[id]);
    this.rolePbList.push(pb);
    this.roleIdList.push(id);
    this.node.addChild(pb);
  },
  rollCallBack: function rollCallBack() {
    this.audio.playStopWheel();
    this.lastResult = this.roleIdList.slice(-5);
    this.status = 0;
    this.mainObj.stateCallBack();
  },
  stopImmediately: function stopImmediately() {
    var _this2 = this;

    this.lastResult = this.roleIdList.slice(-5);
    this.node.stopAllActions();
    setTimeout(function () {
      _this2.node.y = -_this2.node.height + 485;
    }, 50);
    this.status = 0;
    this.mainObj.stateCallBack();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcVGV4dHVyZVxcU2xvdF9TaHVpZ3VveGlhb21hbGlcXGpzXFxTR1hNTFdoZWVsLmpzIl0sIm5hbWVzIjpbIlJPTEVOVU0iLCJUSU1FTUlOIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJ3aGVlbElkIiwiZXhjbHVkZUlkIiwiZGlzcGxheU5hbWUiLCJvbkxvYWQiLCJhdWRpbyIsImRpcmVjdG9yIiwiZ2V0U2NlbmUiLCJnZXRDaGlsZEJ5TmFtZSIsImdldENvbXBvbmVudCIsIm1haW5PYmoiLCJ3aGVlbExpc3QiLCJzdGF0dXMiLCJsYXN0UmVzdWx0Iiwicm9sZVBiTGlzdCIsInJvbGVJZExpc3QiLCJzdGFydCIsImluaXRXaGVlbCIsIm5vZGUiLCJyZW1vdmVBbGxDaGlsZHJlbiIsImkiLCJnZXRSYW5kb21JZCIsImFkZFJvbGUiLCJ5Iiwicm9sbEluZGV4IiwiY2xvc2VTaGluZSIsInN0YXJ0Um9sbCIsImFyZ3MiLCJzZXRUaW1lb3V0IiwidGltZXIiLCJhdXRvIiwicnVuQWN0aW9uIiwic2VxdWVuY2UiLCJkZWxheVRpbWUiLCJtb3ZlVG8iLCJ2MiIsIngiLCJoZWlnaHQiLCJjYWxsRnVuYyIsInJvbGxDYWxsQmFjayIsImJpbmQiLCJyYW5kb21JZCIsImZyZWVUaW1lcyIsInN0b3BGcmVlIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicm9sZVBiIiwibGVuZ3RoIiwiaWQiLCJwYiIsImluc3RhbnRpYXRlIiwicHVzaCIsImFkZENoaWxkIiwicGxheVN0b3BXaGVlbCIsInNsaWNlIiwic3RhdGVDYWxsQmFjayIsInN0b3BJbW1lZGlhdGVseSIsInN0b3BBbGxBY3Rpb25zIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQU1BLE9BQU8sR0FBRyxFQUFoQixFQUFvQjs7QUFDcEIsSUFBTUMsT0FBTyxHQUFHLENBQWhCLEVBQW1COztBQUVuQkMsRUFBRSxDQUFDQyxLQUFILENBQVM7QUFDTCxh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LEdBM0ZJO0FBNkZMWCxFQUFBQSxZQTdGSywwQkE2RlU7QUFDWCxTQUFLbEMsS0FBTCxDQUFXaUQsYUFBWDtBQUNBLFNBQUt6QyxVQUFMLEdBQWtCLEtBQUtFLFVBQUwsQ0FBZ0J3QyxLQUFoQixDQUFzQixDQUFDLENBQXZCLENBQWxCO0FBQ0EsU0FBSzNDLE1BQUwsR0FBYyxDQUFkO0FBQ0EsU0FBS0YsT0FBTCxDQUFhOEMsYUFBYjtBQUNILEdBbEdJO0FBb0dMQyxFQUFBQSxlQXBHSyw2QkFvR2E7QUFBQTs7QUFDZCxTQUFLNUMsVUFBTCxHQUFrQixLQUFLRSxVQUFMLENBQWdCd0MsS0FBaEIsQ0FBc0IsQ0FBQyxDQUF2QixDQUFsQjtBQUNBLFNBQUtyQyxJQUFMLENBQVV3QyxjQUFWO0FBQ0E5QixJQUFBQSxVQUFVLENBQUMsWUFBTTtBQUNiLE1BQUEsTUFBSSxDQUFDVixJQUFMLENBQVVLLENBQVYsR0FBYyxDQUFDLE1BQUksQ0FBQ0wsSUFBTCxDQUFVbUIsTUFBWCxHQUFvQixHQUFsQztBQUNILEtBRlMsRUFFUCxFQUZPLENBQVY7QUFHQSxTQUFLekIsTUFBTCxHQUFjLENBQWQ7QUFDQSxTQUFLRixPQUFMLENBQWE4QyxhQUFiO0FBQ0g7QUE1R0ksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgUk9MRU5VTSA9IDQwOyAvL+avj+S4gOi9rueahOinkuiJsuaVsOmHj1xyXG5jb25zdCBUSU1FTUlOID0gMTsgLy/nrKzkuIDova7mkYflpZbml7bpl7RcclxuXHJcbmNjLkNsYXNzKHtcclxuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcclxuXHJcbiAgICBwcm9wZXJ0aWVzOiB7XHJcbiAgICAgICAgd2hlZWxJZDogMCxcclxuICAgICAgICBleGNsdWRlSWQ6IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogMCxcclxuICAgICAgICAgICAgZGlzcGxheU5hbWU6ICfkuI3kvJrlh7rnjrDnmoTmlbDlrZdpZCcsXHJcbiAgICAgICAgfSxcclxuICAgIH0sXHJcblxyXG4gICAgb25Mb2FkKCkge1xyXG4gICAgICAgIHRoaXMuYXVkaW8gPSBjYy5kaXJlY3Rvci5nZXRTY2VuZSgpLmdldENoaWxkQnlOYW1lKCdDYW52YXMnKS5nZXRDb21wb25lbnQoJ1NHWE1MQXVkaW8nKTtcclxuICAgICAgICB0aGlzLm1haW5PYmogPSBjYy5kaXJlY3Rvci5nZXRTY2VuZSgpLmdldENoaWxkQnlOYW1lKCdDYW52YXMnKS5nZXRDb21wb25lbnQoJ1NHWE1MTWFpbicpO1xyXG4gICAgICAgIHRoaXMubWFpbk9iai53aGVlbExpc3RbdGhpcy53aGVlbElkXSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5zdGF0dXMgPSAwOyAvLzDlgZzmraIgMei9rCBcclxuICAgICAgICB0aGlzLmxhc3RSZXN1bHQgPSBbMCwgMCwgMCwgMCwgMF07IC8v5Lit6Ze05LiJ5L2N5piv5LiK5LiA5bGA57uT5p6cIOmmluS9jeacq+WwvuaYr+S4uuS6humYsuatoumcsuWHuumDqOWIhui9rOi1t+adpeS4jeS4gOagtyBcclxuICAgICAgICB0aGlzLnJvbGVQYkxpc3QgPSBbXTsgLy9yb2xlc1xyXG4gICAgICAgIHRoaXMucm9sZUlkTGlzdCA9IFtdOyAvL3JvbGUgSURcclxuICAgIH0sXHJcblxyXG4gICAgc3RhcnQoKSB7XHJcbiAgICAgICAgLy/liJ3lp4vljJblnLrmma9yb2xlXHJcbiAgICAgICAgdGhpcy5pbml0V2hlZWwoKTtcclxuICAgIH0sXHJcblxyXG4gICAgaW5pdFdoZWVsKCkge1xyXG4gICAgICAgIHRoaXMucm9sZVBiTGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMucm9sZUlkTGlzdCA9IFtdO1xyXG4gICAgICAgIHRoaXMubm9kZS5yZW1vdmVBbGxDaGlsZHJlbigpO1xyXG4gICAgICAgIGZvciAobGV0IGkgaW4gdGhpcy5sYXN0UmVzdWx0KSB7XHJcbiAgICAgICAgICAgIHRoaXMubGFzdFJlc3VsdFtpXSA9IHRoaXMuZ2V0UmFuZG9tSWQoKTtcclxuICAgICAgICAgICAgdGhpcy5hZGRSb2xlKHRoaXMubGFzdFJlc3VsdFtpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYWRkUm9sZSh0aGlzLmdldFJhbmRvbUlkKCkpO1xyXG4gICAgICAgIHRoaXMubm9kZS55ID0gMDsgIFxyXG4gICAgICAgIHRoaXMubWFpbk9iai5yb2xsSW5kZXgrKztcclxuICAgICAgICB0aGlzLm1haW5PYmouY2xvc2VTaGluZSgpO1xyXG4gICAgfSxcclxuXHJcbiAgICBzdGFydFJvbGwoLi4uYXJncykge1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gMTtcclxuICAgICAgICB0aGlzLnJvbGVQYkxpc3QgPSBbXTtcclxuICAgICAgICB0aGlzLnJvbGVJZExpc3QgPSBbXTtcclxuICAgICAgICB0aGlzLm5vZGUucmVtb3ZlQWxsQ2hpbGRyZW4oKTtcclxuICAgICAgICB0aGlzLm5vZGUueSA9IDA7IC8v5rua6L2u5ZCv5Yqo5L2N56e76Led56a7XHJcbiAgICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLmxhc3RSZXN1bHQpIHtcclxuICAgICAgICAgICAgdGhpcy5sYXN0UmVzdWx0W2ldID0gdGhpcy5sYXN0UmVzdWx0W2ldID09IDAgPyB0aGlzLmdldFJhbmRvbUlkKCkgOiB0aGlzLmxhc3RSZXN1bHRbaV07XHJcbiAgICAgICAgICAgIHRoaXMuYWRkUm9sZSh0aGlzLmxhc3RSZXN1bHRbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IFJPTEVOVU0gLSAxMjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkUm9sZSh0aGlzLmdldFJhbmRvbUlkKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpIGluIGFyZ3MpIHtcclxuICAgICAgICAgICAgdGhpcy5hZGRSb2xlKGFyZ3NbaV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmFkZFJvbGUodGhpcy5nZXRSYW5kb21JZCgpKTtcclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgbGV0IHRpbWVyID0gVElNRU1JTiArIHRoaXMud2hlZWxJZCAqIDAuMjtcclxuICAgICAgICAgICAgdGltZXIgPSAhdGhpcy5tYWluT2JqLmF1dG8gPyBUSU1FTUlOIDogdGltZXI7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS5ydW5BY3Rpb24oXHJcbiAgICAgICAgICAgICAgICBjYy5zZXF1ZW5jZShcclxuICAgICAgICAgICAgICAgICAgICBjYy5kZWxheVRpbWUoMC4yKSxcclxuICAgICAgICAgICAgICAgICAgICBjYy5tb3ZlVG8odGltZXIsIGNjLnYyKHRoaXMubm9kZS54LCAtdGhpcy5ub2RlLmhlaWdodCArIDQ4NSkpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNjLm1vdmVUbygwLjEsIGNjLnYyKHRoaXMubm9kZS54LCAtdGhpcy5ub2RlLmhlaWdodCArIDUwMCkpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNjLm1vdmVUbygwLjEsIGNjLnYyKHRoaXMubm9kZS54LCAtdGhpcy5ub2RlLmhlaWdodCArIDQ4NSkpLFxyXG4gICAgICAgICAgICAgICAgICAgIGNjLmNhbGxGdW5jKHRoaXMucm9sbENhbGxCYWNrLmJpbmQodGhpcykpXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgfSwgMTAwKTtcclxuICAgIH0sXHJcblxyXG4gICAgZ2V0UmFuZG9tSWQoKSB7XHJcbiAgICAgICAgbGV0IHJhbmRvbUlkID0gMDtcclxuICAgICAgICB3aGlsZSAocmFuZG9tSWQgPT0gMCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5tYWluT2JqLmZyZWVUaW1lcyA+IDAgfHwgdGhpcy5tYWluT2JqLnN0b3BGcmVlKSB7XHJcbiAgICAgICAgICAgICAgICByYW5kb21JZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqICh0aGlzLm1haW5PYmoucm9sZVBiLmxlbmd0aCAtIDEpICsgMSk7XHJcbiAgICAgICAgICAgICAgICByYW5kb21JZCA9IHJhbmRvbUlkID09IDYgPyAxMiA6IHJhbmRvbUlkO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmFuZG9tSWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAodGhpcy5tYWluT2JqLnJvbGVQYi5sZW5ndGggLSAxKSArIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJhbmRvbUlkID0gcmFuZG9tSWQgPT0gdGhpcy5leGNsdWRlSWQgPyAwIDogcmFuZG9tSWQ7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gcmFuZG9tSWQ7XHJcbiAgICB9LFxyXG5cclxuICAgIGFkZFJvbGUoaWQpIHtcclxuICAgICAgICBsZXQgcGIgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLm1haW5PYmoucm9sZVBiW2lkXSk7XHJcbiAgICAgICAgdGhpcy5yb2xlUGJMaXN0LnB1c2gocGIpO1xyXG4gICAgICAgIHRoaXMucm9sZUlkTGlzdC5wdXNoKGlkKTtcclxuICAgICAgICB0aGlzLm5vZGUuYWRkQ2hpbGQocGIpO1xyXG4gICAgfSxcclxuXHJcbiAgICByb2xsQ2FsbEJhY2soKSB7XHJcbiAgICAgICAgdGhpcy5hdWRpby5wbGF5U3RvcFdoZWVsKCk7XHJcbiAgICAgICAgdGhpcy5sYXN0UmVzdWx0ID0gdGhpcy5yb2xlSWRMaXN0LnNsaWNlKC01KTtcclxuICAgICAgICB0aGlzLnN0YXR1cyA9IDA7XHJcbiAgICAgICAgdGhpcy5tYWluT2JqLnN0YXRlQ2FsbEJhY2soKTtcclxuICAgIH0sXHJcblxyXG4gICAgc3RvcEltbWVkaWF0ZWx5KCkge1xyXG4gICAgICAgIHRoaXMubGFzdFJlc3VsdCA9IHRoaXMucm9sZUlkTGlzdC5zbGljZSgtNSk7XHJcbiAgICAgICAgdGhpcy5ub2RlLnN0b3BBbGxBY3Rpb25zKCk7XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubm9kZS55ID0gLXRoaXMubm9kZS5oZWlnaHQgKyA0ODU7XHJcbiAgICAgICAgfSwgNTApO1xyXG4gICAgICAgIHRoaXMuc3RhdHVzID0gMDtcclxuICAgICAgICB0aGlzLm1haW5PYmouc3RhdGVDYWxsQmFjaygpO1xyXG4gICAgfSxcclxufSk7Il19