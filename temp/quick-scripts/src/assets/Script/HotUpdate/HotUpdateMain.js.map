{"version":3,"sources":["assets\\Script\\HotUpdate\\HotUpdateMain.js"],"names":["cc","Class","Component","properties","panel","type","Node","com_MessageBox","manifestUrl","Asset","sp_BG","Sprite","pb_Loading","com_MessageBox_Update","_updating","_canRetry","progressUI","ProgressBar","progress_lab","Label","hallName","checkCb","event","getEventCode","jsb","EventAssetsManager","ERROR_NO_LOCAL_MANIFEST","getComponent","string","ERROR_DOWNLOAD_MANIFEST","ERROR_PARSE_MANIFEST","ALREADY_UP_TO_DATE","NEW_VERSION_FOUND","eventManager","removeListener","_checkListener","updateCb","isFinished","isUpdate","UPDATE_PROGRESSION","progress","getDownloadedBytes","getTotalBytes","message","getMessage","playerInfo","localVersion","serverVersion","writeGameVersion_Function","game","restart","UPDATE_FINISHED","UPDATE_FAILED","ERROR_UPDATING","getAssetId","ERROR_DECOMPRESS","_updateListener","paths","fileUtils","getSearchPaths","local_paths","_am","getLocalManifest","Array","prototype","unshift","sys","localStorage","setItem","JSON","stringify","setSearchPaths","audioEngine","stopAll","retry","downloadFailedAssets","checkUpdate","isLoaded","EventListenerAssetsManager","bind","addListener","hotUpdate","_failCount","update","onLoad","debug","setDisplayStats","renderType","RENDER_TYPE_CANVAS","renderer","enableDirtyRegion","self","require","getInstant","view","setResizeCallback","uiResize_Function","uiInit_Function","loader","loadRes","error","ret","json","iosPay","strver","versionCode","index","indexOf","substring","window","game_ver","configData","loginIp","console","log","Lhjconfig","Server_IP","lastIndexOf","guest","exchangeRate","getIp_Function","size","getVisibleSize","scale","width","node","scaleX","scaleY","loadScene_Function","path","xhr","XMLHttpRequest","onreadystatechange","readyState","status","response","parse","checkGameVersion_Function","onerror","active","getChildByName","open","send","data","info","gameVersion","getItem","os","OS_IOS","parseInt","lobby","toString","charAt","versionArray","showGame","iosUpdate","i","showgame","length","director","loadScene","setOrientation","macro","ORIENTATION_LANDSCAPE","children","cowgame_qiang","fish","cowgame_jindian","game82","game28","linegame","land","run","needToUpdate","changeScene_Funtion","gameUpdate_Function","instance","version","p","preloadScene","tc","item","toFixed","board","find","versionUrl","url","e","callback","lobby_path","getWritablePath","AssetsManager","ENABLE_GC_FOR_NATIVE_OBJECTS","retain","setVersionCompareHandle","loacl_version","server_version","loacl_version_list","split","server_version_list","loaclVersion","setVerifyCallback","compressed","md5","OS_ANDROID","setMaxConcurrentTask","onDestroy","release"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        panel: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        com_MessageBox: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        manifestUrl: {\r\n            type: cc.Asset,\r\n            default: null\r\n        },\r\n        sp_BG: {\r\n            default: null,\r\n            type: cc.Sprite\r\n        },\r\n        pb_Loading: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        com_MessageBox_Update: {\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        _updating: false,\r\n        _canRetry: false,\r\n        progressUI: cc.ProgressBar,\r\n        progress_lab: cc.Label,\r\n        hallName: \"\"\r\n    },\r\n    /**\r\n     * 检测版本\r\n     * @param {*} event \r\n     */\r\n    checkCb: function (event) {\r\n        switch (event.getEventCode()) {\r\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\r\n                this.panel.getComponent(cc.Label).string = \"没找到本地更新文件\";\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\r\n                this.panel.getComponent(cc.Label).string = \"更新文件下载失败\";\r\n                break;\r\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\r\n                this.panel.getComponent(cc.Label).string = \"开始更新\";\r\n                break;\r\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\r\n                this.panel.getComponent(cc.Label).string = \"游戏新版本查找失败\";\r\n                break;\r\n            default:\r\n                return;\r\n        }\r\n        cc.eventManager.removeListener(this._checkListener);\r\n        this._checkListener = null;\r\n        this._updating = false;\r\n    },\r\n    /**\r\n     * 更新版本\r\n     * @param {*} event \r\n     */\r\n    updateCb: function (event) {\r\n        //cc.log(\"***************************yyy*****************************\");\r\n        //是否更新完成\r\n        var isFinished = false;\r\n        //是否需要更新\r\n        var isUpdate = false;\r\n        switch (event.getEventCode()) {\r\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\r\n                this.panel.getComponent(\"cc.Label\").string = \"没找到本地更新文件\";\r\n                isUpdate = true;\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\r\n                this.pb_Loading.getComponent(\"cc.ProgressBar\").progress = event.getDownloadedBytes() / event.getTotalBytes();\r\n                //获得消息\r\n                var message = event.getMessage();\r\n                if (message) {\r\n                    this.panel.getComponent(\"cc.Label\").string = \"更新中...\" + message;\r\n                }\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\r\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\r\n                this.panel.getComponent(\"cc.Label\").string = \"更新文件下载失败\";\r\n                isUpdate = true;\r\n                break;\r\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\r\n                this.panel.getComponent(\"cc.Label\").string = \"已是最新版本\";\r\n                this.playerInfo.localVersion[0] = this.serverVersion;\r\n                this.writeGameVersion_Function(this.playerInfo.localVersion, function () {\r\n                    // cc.log(\"***************************vvv*****************************\");\r\n                    cc.game.restart();\r\n                });\r\n                isUpdate = true;\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\r\n                this.panel.getComponent(\"cc.Label\").string = \"更新完成\" + event.getMessage();\r\n                isFinished = true;\r\n                //cc.log(\"***************************uuu*****************************\");\r\n                break;\r\n            case jsb.EventAssetsManager.UPDATE_FAILED:\r\n                this.panel.getComponent(\"cc.Label\").string = \"更新失败\" + event.getMessage();\r\n                this._updating = false;\r\n                this._canRetry = true;\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_UPDATING:\r\n                this.panel.getComponent(\"cc.Label\").string = \"资源更新错误: \" + event.getAssetId() + \", \" + event.getMessage();\r\n                break;\r\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\r\n                this.panel.getComponent(\"cc.Label\").string = event.getMessage();\r\n        }\r\n\r\n        //需要更新时处理事件\r\n        if (isUpdate) {\r\n            cc.eventManager.removeListener(this._updateListener);\r\n            this._updateListener = null;\r\n            this._updating = false;\r\n        }\r\n        //更新完成后处理事件\r\n        if (isFinished) {\r\n            cc.eventManager.removeListener(this._updateListener);\r\n            this._updateListener = null;\r\n            //获得更新路径\r\n            var paths = jsb.fileUtils.getSearchPaths();\r\n            var local_paths = this._am.getLocalManifest().getSearchPaths();\r\n            Array.prototype.unshift(paths, local_paths);\r\n            //搜索热更新文件\r\n            cc.sys.localStorage.setItem(\"HotUpdateSearchPaths\", JSON.stringify(paths));\r\n            jsb.fileUtils.setSearchPaths(paths);\r\n            cc.audioEngine.stopAll();\r\n            //设置版本\r\n            this.playerInfo.localVersion[0] = this.serverVersion;\r\n            //重启\r\n            this.writeGameVersion_Function(this.playerInfo.localVersion, function () {\r\n                cc.game.restart();\r\n            });\r\n        }\r\n\r\n    },\r\n    /*\r\n     * 尝试重新下载资源 \r\n     */\r\n    retry: function () {\r\n        if (!this._updating && this._canRetry) {\r\n            this._canRetry = false, this.panel.getComponent(\"cc.Label\").string = \"尝试重新下载资源\";\r\n            this._am.downloadFailedAssets();\r\n        }\r\n    },\r\n\r\n    /*\r\n     *检查更新\r\n     */\r\n    checkUpdate: function () {\r\n\r\n        if (this._updating) {\r\n            this.panel.getComponent(\"cc.Label\").string = \"检测更新中 ...\";\r\n        } else {\r\n            if (this._am.getLocalManifest().isLoaded()) {\r\n                this._checkListener = new jsb.EventListenerAssetsManager(this._am, this.checkCb.bind(this));\r\n                cc.eventManager.addListener(this._checkListener, 1);\r\n                this._am.checkUpdate();\r\n                this._updating = true;\r\n                this.panel.getComponent(\"cc.Label\").string = \"检测完成\";\r\n            } else {\r\n                this.panel.getComponent(\"cc.Label\").string = \"加载本地更新文件失败 ...\";\r\n            }\r\n        }\r\n    },\r\n\r\n    /*\r\n     *热更新方法\r\n     */\r\n    hotUpdate: function () {\r\n        this.panel.getComponent(cc.Label).string = \"更新中\";\r\n        this._updateListener = new jsb.EventListenerAssetsManager(this._am, this.updateCb.bind(this));\r\n        cc.eventManager.addListener(this._updateListener, 1);\r\n        this._failCount = 0;\r\n        this._am.update();\r\n        this._updating = true;\r\n    },\r\n\r\n    onLoad: function () {\r\n        cc.debug.setDisplayStats(false);\r\n        //关闭脏矩形\r\n        if (cc.renderType === cc.game.RENDER_TYPE_CANVAS) {\r\n            cc.renderer.enableDirtyRegion(false);\r\n        }\r\n\r\n        var self = this;\r\n        //设置玩家信息\r\n        this.playerInfo = require(\"PlayerInfo\").getInstant;\r\n\r\n        cc.view.setResizeCallback(function () {\r\n            self.uiResize_Function();\r\n        });\r\n        this.uiInit_Function();\r\n        //加载配置文件\r\n        cc.loader.loadRes('Configuration/Configuration', function (error, ret) {\r\n            // cc.loader.load(\"res/raw-assets/Texture/Configuration/Configuration.json\", function(error, ret){\r\n            ret = ret.json;\r\n            if (typeof ret.iosPay === \"undefined\") {\r\n                self.playerInfo.iosPay = 0;\r\n            } else {\r\n                self.playerInfo.iosPay = ret.iosPay;\r\n            }\r\n\r\n            var strver = ret.versionCode;\r\n            var index = strver.indexOf('_');\r\n            strver = strver.substring(index + 1);\r\n\r\n            window.game_ver = 'v' + strver;\r\n\r\n            self.configData = ret;\r\n            self.playerInfo.versionCode = ret.versionCode;\r\n            self.playerInfo.loginIp = ret.loginIp;\r\n            console.log(ret.loginIp);\r\n            Lhjconfig.Server_IP = ret.loginIp.substring(0, ret.loginIp.lastIndexOf(':')); //给老虎机的服务器地址赋值\r\n            self.playerInfo.guest = ret.guest;\r\n            self.playerInfo.exchangeRate = ret.exchangeRate;\r\n            self.getIp_Function(ret);\r\n        });\r\n        window.hallName = this.hallName;\r\n    },\r\n\r\n    /*\r\n     *热更新UI初始化\r\n     */\r\n    uiInit_Function: function () {\r\n        var size = cc.view.getVisibleSize();\r\n        var scale = size.width / 1334;\r\n        if (size.width > 1334) {\r\n            this.sp_BG.node.scaleX = scale;\r\n            this.sp_BG.node.scaleY = scale;\r\n        } else if (size.width < 1334) {\r\n            this.sp_BG.node.scaleX = 1 / scale;\r\n            this.sp_BG.node.scaleY = 1 / scale;\r\n        }\r\n    },\r\n\r\n    /*\r\n     *热更新进度条计算\r\n     */\r\n    uiResize_Function: function () {\r\n        var size = cc.view.getVisibleSize();\r\n        var scale = size.width / 1334;\r\n        if (size.width > 1334) {\r\n            this.sp_BG.node.scaleX = scale;\r\n            this.sp_BG.node.scaleY = scale;\r\n        } else if (size.width < 1334) {\r\n            this.sp_BG.node.scaleX = 1 / scale;\r\n            this.sp_BG.node.scaleY = 1 / scale;\r\n        }\r\n    },\r\n\r\n    /*\r\n     * 获取IP地址\r\n     */\r\n    getIp_Function: function (ret) {\r\n        //if (!cc.sys.isNative) \r\n        return void this.loadScene_Function();\r\n        var self = this;\r\n        var path = ret.loginIp + \"/logitech\";\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState === 4 && xhr.status === 200) {\r\n                var response = xhr.response;\r\n                if (xhr.response !== null) {\r\n                    try {\r\n                        response = JSON.parse(response);\r\n                        self.checkGameVersion_Function(ret, response);\r\n                    } catch (error) {\r\n                        console.log(\"JSON wrong\");\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        xhr.onerror = function () {\r\n            self.com_MessageBox.active = true;\r\n            self.com_MessageBox.getChildByName(\"lb_Tips\").getComponent(\"cc.Label\").string = \"连接服务器出错，请检测网络\";\r\n        };\r\n        xhr.open(\"get\", path);\r\n        xhr.send();\r\n    },\r\n\r\n    /*\r\n     *校验游戏版本\r\n     */\r\n    checkGameVersion_Function: function (data, info) {\r\n        //获取缓存中的游戏版本信息\r\n        var gameVersion = JSON.parse(cc.sys.localStorage.getItem(\"gameVersion\"));\r\n\r\n        if (cc.sys.os === cc.sys.OS_IOS) {\r\n            if (gameVersion === null) {\r\n                if (parseInt(info.lobby.toString().charAt(0)) > parseInt(data.versionArray.toString().charAt(0))) {\r\n                    this.com_MessageBox_Update.active = true;\r\n                } else if (parseInt(info.lobby.toString().charAt(0)) > parseInt(gameVersion.gameVersion.toString().charAt(0))) {\r\n                    this.com_MessageBox_Update.active = true;\r\n                }\r\n            }\r\n        }\r\n        if (typeof data.showGame == \"undefined\") {\r\n            data.showGame = 0;\r\n        }\r\n        if (typeof data.iosUpdate == \"undefined\") {\r\n            data.iosUpdate = 0;\r\n        }\r\n\r\n        if (cc.sys.os === cc.sys.OS_IOS) {\r\n            for (var i = 0; i < info.showgame.length; ++i) {\r\n                if (data.showGame === info.showgame[i]) {\r\n                    cc.director.loadScene(\"FarmGuanQia\");\r\n                }\r\n            }\r\n            for (var i = 0; i < info.iosUpdate.length; ++i) {\r\n                if (data.iosUpdate === info.iosUpdate[i]) {\r\n                    cc.director.loadScene(\"FarmGuanQia\");\r\n                }\r\n            }\r\n        }\r\n\r\n        cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE);\r\n\r\n        for (var i = 0; i < 4; ++i) {\r\n            this.node.children[i].active = true;\r\n        }\r\n\r\n        if (!data.isUpdate) {\r\n            this.loadScene_Function();\r\n        }\r\n\r\n        //设置子游戏版本信息\r\n        this.playerInfo.serverVersion[0] = info.lobby;\r\n        this.playerInfo.serverVersion[1] = info.cowgame_qiang;\r\n        this.playerInfo.serverVersion[2] = info.fish;\r\n        this.playerInfo.serverVersion[3] = info.cowgame_jindian;\r\n        this.playerInfo.serverVersion[4] = info.game82;\r\n        this.playerInfo.serverVersion[5] = info.game28;\r\n        this.playerInfo.serverVersion[6] = info.linegame;\r\n        this.playerInfo.serverVersion[7] = info.land;\r\n        this.playerInfo.serverVersion[8] = info.run;\r\n\r\n        if (gameVersion !== null) {\r\n            this.playerInfo.localVersion = gameVersion.gameVersion;\r\n        } else {\r\n            this.playerInfo.localVersion = data.versionArray;\r\n        }\r\n        //版本长度比较\r\n        if (this.playerInfo.localVersion.length === this.playerInfo.serverVersion.length) {\r\n            for (var i = 0; i < this.playerInfo.serverVersion.length; ++i) {\r\n                if (this.playerInfo.serverVersion[i] !== this.playerInfo.localVersion[i]) {\r\n                    this.playerInfo.needToUpdate[i] = 1;\r\n                }\r\n            }\r\n            this.changeScene_Funtion();\r\n        } else {\r\n            this.playerInfo.localVersion[this.playerInfo.localVersion.length] = \"1.0\";\r\n            this.writeGameVersion_Function(this.playerInfo.localVersion, function () {\r\n                this.playerInfo.needToUpdate[0] = 1;\r\n                this.changeScene_Funtion();\r\n            }.bind(this));\r\n        }\r\n        cc.log(this.playerInfo.localVersion);\r\n        cc.log(this.playerInfo.serverVersion);\r\n        cc.log(this.playerInfo.needToUpdate);\r\n    },\r\n\r\n    /*\r\n     *修改跟新进度条\r\n     */\r\n    changeScene_Funtion: function () {\r\n        if (this.playerInfo.needToUpdate[0]) {\r\n            //cc.log(\"******************************ccc***************************************\");\r\n            this.gameUpdate_Function();\r\n        } else {\r\n            // cc.log(\"******************************ddd***************************************\");\r\n            this.node.getChildByName(\"pb_Loading\").getComponent(\"cc.ProgressBar\").progress = 1;\r\n            this.loadScene_Function();\r\n        }\r\n        // 这是上面if语句的简写\r\n        // return this.playerInfo.needToUpdate[0] ? (cc.log(\"******************************ccc***************************************\"), void this.gameUpdate_Function()) : (cc.log(\"******************************ddd***************************************\"), this.node.getChildByName(\"pb_Loading\").getComponent(\"cc.ProgressBar\").progress = 1, void this.loadScene_Function())\r\n    },\r\n\r\n    /*\r\n     *跳转场景方法\r\n     */\r\n    loadScene_Function: function () {\r\n        let path = this.playerInfo.loginIp + \"/checkVersion\";\r\n        let instance = this;\r\n        let xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = () => {\r\n            if (xhr.readyState === 4 && xhr.status === 200) {\r\n                if (!!xhr.response) {\r\n                    try {\r\n                        const response = JSON.parse(xhr.response);\r\n                        if (response.version == instance.playerInfo.versionCode) {\r\n                            // progressUI\r\n                            this.p = 0;\r\n                            cc.director.preloadScene(window.hallName, (cc, tc, item) => {\r\n                                if (this.p < cc / tc) {\r\n                                    this.p = cc / tc;\r\n                                    this.progressUI.progress = cc / tc;\r\n                                    this.progress_lab.string = ((cc / tc) * 100).toFixed(2) + \"%\";\r\n                                }\r\n                            }, () => {\r\n                                cc.director.loadScene(window.hallName);\r\n                            })\r\n\r\n\r\n                        } else {\r\n                            let board = cc.find('Canvas/com_NewVersion');\r\n                            board.active = true;\r\n                            window.versionUrl = response.url;\r\n                        }\r\n                    } catch (e) {\r\n                        console.error('json解析错误');\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        xhr.open(\"post\", path);\r\n        xhr.send();\r\n    },\r\n    /**\r\n     * \r\n     * @param {*} version \r\n     * @param {*} callback \r\n     */\r\n    writeGameVersion_Function: function (version, callback) {\r\n        cc.sys.localStorage.setItem(\"gameVersion\", JSON.stringify({\r\n            gameVersion: version\r\n        }));\r\n        callback && callback();\r\n    },\r\n\r\n    /*\r\n     * 热更新方法\r\n     */\r\n    gameUpdate_Function: function () {\r\n        var lobby_path = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : \"/\") + \"lobby\";\r\n        this._am = new jsb.AssetsManager(this.manifestUrl, lobby_path);\r\n        if (!cc.sys.ENABLE_GC_FOR_NATIVE_OBJECTS) {\r\n            this._am.retain();\r\n        }\r\n        var self = this;\r\n        //版本比较\r\n        this._am.setVersionCompareHandle(function (loacl_version, server_version) {\r\n            self.serverVersion = server_version;\r\n            var loacl_version_list = loacl_version.split(\".\");\r\n            var server_version_list = server_version.split(\".\")\r\n            for (var i = 0; i < loacl_version_list.length; i++) {\r\n                var loaclVersion = parseInt(loacl_version_list[i]);\r\n                var serverVersion = parseInt(server_version_list[i] || 0);\r\n                if (loaclVersion !== serverVersion) return -1;\r\n            }\r\n            if (server_version_list.length != loacl_version_list.length) {\r\n                return -1;\r\n            } else {\r\n                return 0;\r\n            }\r\n\r\n        });\r\n        var panel = this.panel;\r\n        this._am.setVerifyCallback(function (error, ret) {\r\n            var compressed = ret.compressed;\r\n            var md5 = ret.md5;\r\n            var path = ret.path;\r\n            ret.size;\r\n            if (compressed) {\r\n                panel.getComponent(\"cc.Label\").string = \"Verification passed : \" + path;\r\n            } else {\r\n                panel.getComponent(\"cc.Label\").string = \"Verification passed : \" + path + \" (\" + md5 + \")\";\r\n            }\r\n        });\r\n        this.panel.getComponent(\"cc.Label\").string = \"更新已准备好，正在检测地址\";\r\n        if (cc.sys.os === cc.sys.OS_ANDROID) {\r\n            this._am.setMaxConcurrentTask(1);\r\n            this.panel.getComponent(\"cc.Label\").string = \"Max concurrent tasks count have been limited to 1\";\r\n        }\r\n        this.hotUpdate();\r\n    },\r\n    /**\r\n     * 销毁\r\n     */\r\n    onDestroy: function () {\r\n        if (this._updateListener) {\r\n            cc.eventManager.removeListener(this._updateListener);\r\n            this._updateListener = null;\r\n        }\r\n        if (this._am && !cc.sys.ENABLE_GC_FOR_NATIVE_OBJECTS) {\r\n            this._am.release();\r\n        }\r\n    },\r\n});"]}