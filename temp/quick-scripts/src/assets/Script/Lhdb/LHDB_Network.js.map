{"version":3,"sources":["assets\\Script\\Lhdb\\LHDB_Network.js"],"names":["cc","Class","Component","onLoad","playerInfo","require","getInstant","gameMain","node","getComponent","sign","gameSign","userId","playerId","port","timer","sys","isNative","socket","SocketIO","connect","Lhjconfig","Server_IP","registEvent","on","ret","log","emit","JSON","stringify","userid","gametype","result","changeResultJSON_Function","LHDB_LOBBYNET","disconnect","lblAllCoin","string","Helper","fixNum","Obj","score","resultid","roomid","msg","lblCoin","ResultData","gameDict","big_win_score","toFixed","lblGoldPool","score_pool","setLevel","game_level_num","list","levelList","level","children","i","zuan_tou","active","exitGame","data","dictAnalyseResult","ResultCode","gemList","gemPidList","areaList","removeAllChildren","scheduleOnce","j","res_list","parseInt","levelDown","length","audio","playLandAudio","win_temp_list","gemBoo","playBoo","cleanBoo","tmOffset","startBtn","interactable","tuoguan","is_big_win","startGame","user_game_dict","user_score","tuoguanList","setBox","big_win","showTip","parse"],"mappings":";;;;;;AAAAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,MAHK,oBAGI;AACL,SAAKC,UAAL,GAAkBC,OAAO,CAAC,YAAD,CAAP,CAAsBC,UAAxC;AACA,SAAKC,QAAL,GAAgB,KAAKC,IAAL,CAAUC,YAAV,CAAuB,WAAvB,CAAhB;AACA,SAAKC,IAAL,GAAY,KAAKN,UAAL,CAAgBO,QAA5B;AACA,SAAKC,MAAL,GAAc,KAAKR,UAAL,CAAgBS,QAA9B;AACA,SAAKC,IAAL,GAAY,QAAZ;AACA,SAAKC,KAAL,GAAa,CAAb,CANK,CAOL;;AACA,QAAIf,EAAE,CAACgB,GAAH,CAAOC,QAAX,EAAqB;AACjB,WAAKC,MAAL,GAAcC,QAAQ,CAACC,OAAT,CAAiBC,SAAS,CAACC,SAAV,GAAsB,KAAKR,IAA5C,CAAd;AACH,KAFD,MAEO;AACH,UAAII,MAAM,GAAGb,OAAO,CAAC,WAAD,CAApB;;AACA,WAAKa,MAAL,GAAcA,MAAM,CAACG,SAAS,CAACC,SAAV,GAAsB,KAAKR,IAA5B,CAApB;AACH;;AACD,SAAKS,WAAL;AACH,GAlBI;AAoBLA,EAAAA,WApBK,yBAoBS;AAAA;;AACV,SAAKL,MAAL,CAAYM,EAAZ,CAAe,WAAf,EAA4B,UAAAC,GAAG,EAAI;AAC/BzB,MAAAA,EAAE,CAAC0B,GAAH,CAAO,eAAeD,GAAtB;;AACA,UAAIA,GAAJ,EAAS;AACL,QAAA,KAAI,CAACP,MAAL,CAAYS,IAAZ,CAAiB,WAAjB,EAA8BC,IAAI,CAACC,SAAL,CAAe;AACzCC,UAAAA,MAAM,EAAE,KAAI,CAAClB,MAD4B;AACpB;AACrBmB,UAAAA,QAAQ,EAAE,EAF+B;AAE3B;AACdrB,UAAAA,IAAI,EAAE,KAAI,CAACA,IAH8B,CAGzB;;AAHyB,SAAf,CAA9B;AAKH;AACJ,KATD;AAWA,SAAKQ,MAAL,CAAYM,EAAZ,CAAe,iBAAf,EAAkC,UAAAC,GAAG,EAAI;AACrC,UAAIO,MAAM,GAAG,KAAI,CAACC,yBAAL,CAA+BR,GAA/B,CAAb;;AACAzB,MAAAA,EAAE,CAAC0B,GAAH,CAAO,kCAAkCE,IAAI,CAACC,SAAL,CAAeG,MAAf,CAAzC;AACAE,MAAAA,aAAa,CAACC,UAAd;AACA,MAAA,KAAI,CAAC5B,QAAL,CAAc6B,UAAd,CAAyBC,MAAzB,GAAkCC,MAAM,CAACC,MAAP,CAAcP,MAAM,CAACQ,GAAP,CAAWC,KAAzB,CAAlC;;AACA,UAAIT,MAAM,CAACU,QAAX,EAAqB;AAAE;AACnB,QAAA,KAAI,CAACxB,MAAL,CAAYS,IAAZ,CAAiB,WAAjB,EAA8BC,IAAI,CAACC,SAAL,CAAe;AACzCc,UAAAA,MAAM,EAAE;AADiC,SAAf,CAA9B;AAGH,OAJD,MAIO;AACH3C,QAAAA,EAAE,CAAC0B,GAAH,CAAOM,MAAM,CAACY,GAAd;AACH;AACJ,KAZD;AAcA,SAAK1B,MAAL,CAAYM,EAAZ,CAAe,iBAAf,EAAkC,UAAAC,GAAG,EAAI;AACrC,UAAIO,MAAM,GAAG,KAAI,CAACC,yBAAL,CAA+BR,GAA/B,CAAb;;AACAzB,MAAAA,EAAE,CAAC0B,GAAH,CAAO,gBAAgBE,IAAI,CAACC,SAAL,CAAeG,MAAf,CAAvB,EAFqC,CAGrC;;AACA,MAAA,KAAI,CAACzB,QAAL,CAAcsC,OAAd,CAAsBR,MAAtB,GAA+B,CAACL,MAAM,CAACc,UAAP,CAAkBC,QAAlB,CAA2BC,aAA3B,GAA2C,IAA5C,EAAkDC,OAAlD,CAA0D,CAA1D,CAA/B;AACA,MAAA,KAAI,CAAC1C,QAAL,CAAc2C,WAAd,CAA0Bb,MAA1B,GAAmCL,MAAM,CAACc,UAAP,CAAkBK,UAArD;;AACA,MAAA,KAAI,CAAC5C,QAAL,CAAc6C,QAAd,CAAuBpB,MAAM,CAACc,UAAP,CAAkBC,QAAlB,CAA2BM,cAAlD;;AACA,UAAIC,IAAI,GAAG,KAAI,CAAC/C,QAAL,CAAcgD,SAAd,CAAwB,KAAI,CAAChD,QAAL,CAAciD,KAAd,GAAsB,CAA9C,EAAiDC,QAA5D;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG1B,MAAM,CAACc,UAAP,CAAkBC,QAAlB,CAA2BY,QAA/C,EAAyDD,CAAC,EAA1D,EAA8D;AAC1DJ,QAAAA,IAAI,CAACI,CAAD,CAAJ,CAAQE,MAAR,GAAiB,KAAjB;AACH;AACJ,KAXD;AAaA,SAAK1C,MAAL,CAAYM,EAAZ,CAAe,qBAAf,EAAsC,UAAAC,GAAG,EAAI;AACzC,UAAIO,MAAM,GAAG,KAAI,CAACC,yBAAL,CAA+BR,GAA/B,CAAb;;AACA,UAAIO,MAAJ,EAAY;AACR,QAAA,KAAI,CAACzB,QAAL,CAAcsD,QAAd;AACH;AACJ,KALD;AAOA,SAAK3C,MAAL,CAAYM,EAAZ,CAAe,eAAf,EAAgC,UAAAC,GAAG,EAAI;AACnC,UAAIO,MAAM,GAAG,KAAI,CAACC,yBAAL,CAA+BR,GAA/B,CAAb;;AACAzB,MAAAA,EAAE,CAAC0B,GAAH,CAAO,SAASE,IAAI,CAACC,SAAL,CAAeG,MAAf,CAAhB;AACA,UAAM8B,IAAI,GAAG9B,MAAM,CAAC+B,iBAApB;;AACA,UAAI/B,MAAM,CAACgC,UAAP,IAAqB,CAAzB,EAA4B;AACxB,QAAA,KAAI,CAACzD,QAAL,CAAc0D,OAAd,GAAwB,EAAxB;AACA,QAAA,KAAI,CAAC1D,QAAL,CAAc2D,UAAd,GAA2B,EAA3B;;AACA,QAAA,KAAI,CAAC3D,QAAL,CAAc4D,QAAd,CAAuBL,IAAI,CAACT,cAAL,GAAsB,CAA7C,EAAgDe,iBAAhD;;AAHwB,mCAIfV,CAJe;AAKpB,UAAA,KAAI,CAACnD,QAAL,CAAc8D,YAAd,CAA2B,YAAM;AAC7B,iBAAK,IAAIC,CAAT,IAAcR,IAAI,CAACS,QAAL,CAAcb,CAAd,CAAd,EAAgC;AAC5B,kBAAIc,QAAQ,CAACd,CAAD,CAAR,GAAc,CAAlB,EAAqB;AACjB,oBAAI,KAAI,CAACnD,QAAL,CAAc2D,UAAd,CAAyBI,CAAzB,KAA+BR,IAAI,CAACS,QAAL,CAAcb,CAAd,EAAiBY,CAAjB,CAAnC,EAAwD;AACpD,kBAAA,KAAI,CAAC/D,QAAL,CAAckE,SAAd,CAAwBX,IAAI,CAACT,cAA7B,EAA6CmB,QAAQ,CAACF,CAAD,CAArD,EAA0DR,IAAI,CAACS,QAAL,CAAcb,CAAd,EAAiBY,CAAjB,CAA1D;AACH;AACJ,eAJD,MAIO;AACH,gBAAA,KAAI,CAAC/D,QAAL,CAAckE,SAAd,CAAwBX,IAAI,CAACT,cAA7B,EAA6CmB,QAAQ,CAACF,CAAD,CAArD,EAA0DR,IAAI,CAACS,QAAL,CAAcb,CAAd,EAAiBY,CAAjB,CAA1D;AACH;AACJ;;AACD,gBAAI,CAAC,CAACR,IAAI,CAACS,QAAL,CAAcb,CAAd,CAAF,IAAsBI,IAAI,CAACS,QAAL,CAAcb,CAAd,EAAiBgB,MAAjB,GAA0B,CAApD,EAAuD;AACnD,cAAA,KAAI,CAACL,YAAL,CAAkB,YAAM;AACpB,gBAAA,KAAI,CAAC9D,QAAL,CAAcoE,KAAd,CAAoBC,aAApB;AACH,eAFD,EAEG,GAFH;AAGH;;AAED,YAAA,KAAI,CAACrE,QAAL,CAAc8D,YAAd,CAA2B,YAAM;AAC7B,mBAAK,IAAIC,EAAT,IAAcR,IAAI,CAACe,aAAL,CAAmBnB,CAAnB,CAAd,EAAqC;AACjC,gBAAA,KAAI,CAACnD,QAAL,CAAcuE,MAAd,CAAqBhB,IAAI,CAACe,aAAL,CAAmBnB,CAAnB,EAAsBY,EAAtB,CAArB;AACH;;AACD,kBAAI,CAAC,CAACR,IAAI,CAACe,aAAL,CAAmBnB,CAAnB,CAAF,IAA2BI,IAAI,CAACe,aAAL,CAAmBnB,CAAnB,EAAsBgB,MAAtB,GAA+B,CAA9D,EAAiE;AAC7D,gBAAA,KAAI,CAACnE,QAAL,CAAcoE,KAAd,CAAoBI,OAApB;AACH;AACJ,aAPD,EAOG,CAPH;;AAQA,YAAA,KAAI,CAACxE,QAAL,CAAc8D,YAAd,CAA2B,YAAM;AAC7B,cAAA,KAAI,CAAC9D,QAAL,CAAcyE,QAAd,CAAuBlB,IAAI,CAACT,cAA5B;AACH,aAFD,EAEG,GAFH;AAGH,WA3BD,EA2BGmB,QAAQ,CAACd,CAAD,CAAR,GAAc,GA3BjB;AALoB;;AAIxB,aAAK,IAAIA,CAAT,IAAcI,IAAI,CAACS,QAAnB,EAA6B;AAAA,gBAApBb,CAAoB;AA6B5B;;AACD,QAAA,KAAI,CAACnD,QAAL,CAAc8D,YAAd,CAA2B,YAAM;AAC7B,UAAA,KAAI,CAAC9D,QAAL,CAAc0E,QAAd,GAAyB,IAAzB;AACA,UAAA,KAAI,CAAC1E,QAAL,CAAc2E,QAAd,CAAuBC,YAAvB,GAAsC,IAAtC;AACA,UAAA,KAAI,CAAC5E,QAAL,CAAc6E,OAAd,IAAyB,CAACtB,IAAI,CAACuB,UAA/B,IAA6C,KAAI,CAAC9E,QAAL,CAAc+E,SAAd,EAA7C;AACA,UAAA,KAAI,CAAC/E,QAAL,CAAcsC,OAAd,CAAsBR,MAAtB,GAA+BC,MAAM,CAACC,MAAP,CAAcuB,IAAI,CAACyB,cAAL,CAAoBvC,aAAlC,CAA/B;AACA,UAAA,KAAI,CAACzC,QAAL,CAAc6B,UAAd,CAAyBC,MAAzB,GAAkCC,MAAM,CAACC,MAAP,CAAcuB,IAAI,CAAC0B,UAAnB,CAAlC;;AACA,cAAI1B,IAAI,CAACyB,cAAL,CAAoBlC,cAApB,IAAsC,KAAI,CAAC9C,QAAL,CAAciD,KAAxD,EAA+D;AAC3D,YAAA,KAAI,CAACjD,QAAL,CAAc6C,QAAd,CAAuBU,IAAI,CAACyB,cAAL,CAAoBlC,cAA3C;AACH;;AACD,cAAIS,IAAI,CAACuB,UAAT,EAAqB;AAAA;;AACjB,gBAAI,KAAI,CAAC9E,QAAL,CAAc6E,OAAlB,EAA2B;AACvB,cAAA,KAAI,CAAC7E,QAAL,CAAc6E,OAAd,GAAwB,CAAC,KAAI,CAAC7E,QAAL,CAAc6E,OAAvC;AACA,cAAA,KAAI,CAAC7E,QAAL,CAAckF,WAAd,CAA0B,CAA1B,EAA6B7B,MAA7B,GAAsC,CAAC,KAAI,CAACrD,QAAL,CAAc6E,OAArD;AACA,cAAA,KAAI,CAAC7E,QAAL,CAAckF,WAAd,CAA0B,CAA1B,EAA6B7B,MAA7B,GAAsC,KAAI,CAACrD,QAAL,CAAc6E,OAApD;AACH;;AACD,8BAAA,KAAI,CAAC7E,QAAL,EAAcmF,MAAd,uBAAwB5B,IAAI,CAAC6B,OAA7B;AACH;AACJ,SAjBD,EAiBG7B,IAAI,CAACS,QAAL,CAAcG,MAAd,GAAuB,GAjB1B;AAkBH,OApDD,MAoDO,IAAI1C,MAAM,CAACgC,UAAP,IAAqB,CAAC,CAA1B,EAA6B;AAChC,QAAA,KAAI,CAACzD,QAAL,CAAcqF,OAAd,CAAsB,OAAtB;;AACA,QAAA,KAAI,CAACrF,QAAL,CAAc2E,QAAd,CAAuBC,YAAvB,GAAsC,IAAtC;AACA,QAAA,KAAI,CAAC5E,QAAL,CAAc0E,QAAd,GAAyB,IAAzB;;AACA,YAAI,KAAI,CAAC1E,QAAL,CAAc6E,OAAlB,EAA2B;AACvB,UAAA,KAAI,CAAC7E,QAAL,CAAc6E,OAAd,GAAwB,CAAC,KAAI,CAAC7E,QAAL,CAAc6E,OAAvC;AACA,UAAA,KAAI,CAAC7E,QAAL,CAAckF,WAAd,CAA0B,CAA1B,EAA6B7B,MAA7B,GAAsC,CAAC,KAAI,CAACrD,QAAL,CAAc6E,OAArD;AACA,UAAA,KAAI,CAAC7E,QAAL,CAAckF,WAAd,CAA0B,CAA1B,EAA6B7B,MAA7B,GAAsC,KAAI,CAACrD,QAAL,CAAc6E,OAApD;AACH;AACJ;AACJ,KAlED;AAmEH,GArII;AAuILnD,EAAAA,yBAvIK,qCAuIqBR,GAvIrB,EAuI0B;AAC3B,QAAIzB,EAAE,CAACgB,GAAH,CAAOC,QAAX,EAAqB;AACjB,aAAOW,IAAI,CAACiE,KAAL,CAAWpE,GAAX,CAAP;AACH;;AACD,WAAOA,GAAP;AACH;AA5II,CAAT","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    onLoad() {\r\n        this.playerInfo = require(\"PlayerInfo\").getInstant;\r\n        this.gameMain = this.node.getComponent('LHDB_Main');\r\n        this.sign = this.playerInfo.gameSign;\r\n        this.userId = this.playerInfo.playerId;\r\n        this.port = ':15200';\r\n        this.timer = 0;\r\n        //连接网络\r\n        if (cc.sys.isNative) {\r\n            this.socket = SocketIO.connect(Lhjconfig.Server_IP + this.port);\r\n        } else {\r\n            let socket = require(\"socket-io\");\r\n            this.socket = socket(Lhjconfig.Server_IP + this.port);\r\n        }\r\n        this.registEvent();\r\n    },\r\n\r\n    registEvent() {\r\n        this.socket.on(\"connected\", ret => {\r\n            cc.log('connected:' + ret);\r\n            if (ret) {\r\n                this.socket.emit(\"LoginGame\", JSON.stringify({\r\n                    userid: this.userId, //用户ID\r\n                    gametype: 11, //游戏类型\r\n                    sign: this.sign //签名\r\n                }));\r\n            }\r\n        });\r\n\r\n        this.socket.on(\"loginGameResult\", ret => {\r\n            let result = this.changeResultJSON_Function(ret);\r\n            cc.log('游戏登陆成功=======================' + JSON.stringify(result));\r\n            LHDB_LOBBYNET.disconnect();\r\n            this.gameMain.lblAllCoin.string = Helper.fixNum(result.Obj.score);\r\n            if (result.resultid) { //游戏登录成功\r\n                this.socket.emit(\"LoginRoom\", JSON.stringify({\r\n                    roomid: 1\r\n                }));\r\n            } else {\r\n                cc.log(result.msg);\r\n            }\r\n        });\r\n\r\n        this.socket.on(\"LoginRoomResult\", ret => {\r\n            let result = this.changeResultJSON_Function(ret);\r\n            cc.log('LoginRoom结果' + JSON.stringify(result));\r\n            //设置奖池\r\n            this.gameMain.lblCoin.string = (result.ResultData.gameDict.big_win_score * 0.01).toFixed(2);\r\n            this.gameMain.lblGoldPool.string = result.ResultData.score_pool;\r\n            this.gameMain.setLevel(result.ResultData.gameDict.game_level_num);\r\n            let list = this.gameMain.levelList[this.gameMain.level - 1].children;\r\n            for (let i = 0; i < result.ResultData.gameDict.zuan_tou; i++) {\r\n                list[i].active = false;\r\n            }\r\n        })\r\n\r\n        this.socket.on(\"clearGameDictResult\", ret => {\r\n            let result = this.changeResultJSON_Function(ret);\r\n            if (result) {\r\n                this.gameMain.exitGame();\r\n            }\r\n        })\r\n\r\n        this.socket.on(\"lotteryResult\", ret => {\r\n            let result = this.changeResultJSON_Function(ret);\r\n            cc.log('下注结果' + JSON.stringify(result));\r\n            const data = result.dictAnalyseResult;\r\n            if (result.ResultCode >= 1) {\r\n                this.gameMain.gemList = [];\r\n                this.gameMain.gemPidList = [];\r\n                this.gameMain.areaList[data.game_level_num - 1].removeAllChildren();\r\n                for (let i in data.res_list) {\r\n                    this.gameMain.scheduleOnce(() => {\r\n                        for (let j in data.res_list[i]) {\r\n                            if (parseInt(i) > 0) {\r\n                                if (this.gameMain.gemPidList[j] != data.res_list[i][j]) {\r\n                                    this.gameMain.levelDown(data.game_level_num, parseInt(j), data.res_list[i][j]);\r\n                                }\r\n                            } else {\r\n                                this.gameMain.levelDown(data.game_level_num, parseInt(j), data.res_list[i][j]);\r\n                            }\r\n                        }\r\n                        if (!!data.res_list[i] && data.res_list[i].length > 0) {\r\n                            this.scheduleOnce(() => {\r\n                                this.gameMain.audio.playLandAudio();\r\n                            }, 0.7)\r\n                        }\r\n\r\n                        this.gameMain.scheduleOnce(() => {\r\n                            for (let j in data.win_temp_list[i]) {\r\n                                this.gameMain.gemBoo(data.win_temp_list[i][j]);\r\n                            }\r\n                            if (!!data.win_temp_list[i] && data.win_temp_list[i].length > 0) {\r\n                                this.gameMain.audio.playBoo();\r\n                            }\r\n                        }, 1);\r\n                        this.gameMain.scheduleOnce(() => {\r\n                            this.gameMain.cleanBoo(data.game_level_num);\r\n                        }, 1.6);\r\n                    }, parseInt(i) * 1.8);\r\n                }\r\n                this.gameMain.scheduleOnce(() => {\r\n                    this.gameMain.tmOffset = true;\r\n                    this.gameMain.startBtn.interactable = true;\r\n                    this.gameMain.tuoguan && !data.is_big_win && this.gameMain.startGame();\r\n                    this.gameMain.lblCoin.string = Helper.fixNum(data.user_game_dict.big_win_score);\r\n                    this.gameMain.lblAllCoin.string = Helper.fixNum(data.user_score);\r\n                    if (data.user_game_dict.game_level_num != this.gameMain.level) {\r\n                        this.gameMain.setLevel(data.user_game_dict.game_level_num);\r\n                    }\r\n                    if (data.is_big_win) {\r\n                        if (this.gameMain.tuoguan) {\r\n                            this.gameMain.tuoguan = !this.gameMain.tuoguan;\r\n                            this.gameMain.tuoguanList[0].active = !this.gameMain.tuoguan;\r\n                            this.gameMain.tuoguanList[1].active = this.gameMain.tuoguan;\r\n                        }\r\n                        this.gameMain.setBox(...data.big_win);\r\n                    }\r\n                }, data.res_list.length * 1.8)\r\n            } else if (result.ResultCode == -2) {\r\n                this.gameMain.showTip('游戏币不足');\r\n                this.gameMain.startBtn.interactable = true;\r\n                this.gameMain.tmOffset = true;\r\n                if (this.gameMain.tuoguan) {\r\n                    this.gameMain.tuoguan = !this.gameMain.tuoguan;\r\n                    this.gameMain.tuoguanList[0].active = !this.gameMain.tuoguan;\r\n                    this.gameMain.tuoguanList[1].active = this.gameMain.tuoguan;\r\n                }\r\n            }\r\n        })\r\n    },\r\n\r\n    changeResultJSON_Function(ret) {\r\n        if (cc.sys.isNative) {\r\n            return JSON.parse(ret);\r\n        }\r\n        return ret;\r\n    },\r\n});"]}