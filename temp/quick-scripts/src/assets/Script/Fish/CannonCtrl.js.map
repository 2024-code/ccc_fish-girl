{"version":3,"sources":["assets\\Script\\Fish\\CannonCtrl.js"],"names":["cc","Class","Component","properties","seatID","goldLbl","Label","diamondLbl","nameLbl","betLbl","cannonAnim","Animation","onLoad","cannonPos","node","convertToWorldSpaceAR","position","fishMain","find","getComponent","cannonList","playerInfo","require","getInstant","onEnable","dataInfo","playerList","string","name","window","setHeadTexture","getChildByName","head","Helper","fixNum","roomBet","update","dt","score","diamond","uid","playerId","bulletPower","isLockFish","active","bang","pos","bet","bid","angle","Math","PI","atan","x","y","play","bullet","getBullet","bulletPos","bulletBg","convertToNodeSpaceAR","sin","cos","init","userID","parent","bulletId","bigfishid","getBigFishId","autoId","addscore","addDiamond","d","check_pan","fishType","labelBaseNode","labelNode","stopAllActions","runAction","sequence","show","delayTime","hide","i","children","onSkill","sid","time","skillTime"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        seatID: 0, //座位号\r\n        goldLbl: cc.Label, //金币显示\r\n        diamondLbl: cc.Label, //金币显示\r\n        nameLbl: cc.Label, //名字显示\r\n        betLbl: cc.Label, //当前倍数显示\r\n        cannonAnim: cc.Animation, //大炮动画\r\n    },\r\n\r\n    onLoad() {\r\n        this.cannonPos = this.node.convertToWorldSpaceAR(this.cannonAnim.node.position);\r\n        this.fishMain = cc.find('Canvas').getComponent('FishMain');\r\n        this.fishMain.cannonList[this.seatID] = this;\r\n        this.playerInfo = require('PlayerInfo').getInstant;\r\n        //this.autoTime = 0;\r\n\r\n    },\r\n\r\n    onEnable() {\r\n        this.dataInfo = this.fishMain.playerList[this.seatID];\r\n        this.nameLbl.string = this.dataInfo.name;\r\n        window.setHeadTexture(this.node.getChildByName('userML').getChildByName('face').getChildByName('s1'), this.dataInfo.head);\r\n        //this.goldLbl.string = this.dataInfo.score;\r\n        //this.betLbl.string = this.fishMain.roomBet;\r\n        this.betLbl.string = Helper.fixNum(this.fishMain.roomBet);\r\n    },\r\n\r\n    update(dt) {\r\n        this.goldLbl.string = Helper.fixNum(this.dataInfo.score);\r\n        this.diamondLbl.string = this.dataInfo.diamond;\r\n        if (this.dataInfo.uid == this.playerInfo.playerId) {\r\n            this.betLbl.string = Helper.fixNum(this.fishMain.roomBet * this.fishMain.bulletPower);\r\n\r\n            if (this.fishMain.isLockFish) {\r\n                this.node.getChildByName('suoding_effect').active = true;\r\n            } else {\r\n                this.node.getChildByName('suoding_effect').active = false;\r\n            }\r\n        }\r\n\r\n        // if (this.autoTime>0){\r\n        //     this.autoTime--;\r\n        // };\r\n        // if (this.autoTime>0)\r\n\r\n    },\r\n\r\n    bang(pos, bet, bid) {\r\n        //需要区分上下  方向是反的\r\n        let angle = 180 / (Math.PI / Math.atan((this.cannonPos.x - pos.x) / (this.cannonPos.y - pos.y)));\r\n        this.cannonAnim.node.angle = this.seatID > 1 ? angle : -angle;\r\n        this.cannonAnim.play();\r\n\r\n        //处理子弹发射\r\n        let bullet = this.fishMain.getBullet();\r\n\r\n        let bulletPos = this.fishMain.bulletBg.convertToNodeSpaceAR(this.cannonPos);\r\n\r\n        bulletPos.x += 100 * Math.sin(-2 * Math.PI / 360 * this.cannonAnim.node.angle);\r\n        bulletPos.y += 100 * Math.cos(-2 * Math.PI / 360 * this.cannonAnim.node.angle);\r\n\r\n        bullet.getComponent('BulletCtrl').init(this.fishMain, this.seatID, bulletPos, this.seatID > 1 ? angle - 180 : angle, this.fishMain.bulletPower);\r\n        bullet.getComponent('BulletCtrl').userID = this.dataInfo.uid;\r\n        bullet.parent = this.fishMain.bulletBg;\r\n        this.dataInfo.score -= this.fishMain.roomBet * bet;\r\n        bullet.getComponent('BulletCtrl').bulletId = bid;\r\n        //console.log(\"onshoot: \"+bid);\r\n        //this.bulletPower = bet;\r\n        this.betLbl.string = Helper.fixNum(this.fishMain.roomBet * bet);\r\n\r\n        let bigfishid = this.fishMain.getBigFishId();\r\n\r\n        if (this.fishMain.isLockFish) {\r\n            bullet.getComponent('BulletCtrl').autoId = bigfishid;\r\n        }\r\n    },\r\n    addscore(score) {\r\n        this.dataInfo.score += score;\r\n    },\r\n\r\n    addDiamond(d) {\r\n        this.dataInfo.diamond += d;\r\n    },\r\n\r\n    check_pan(fishType, score) {\r\n        var labelBaseNode = this.node.getChildByName(\"zhuanpan\").getChildByName(\"zp_di3\");\r\n        var labelNode = labelBaseNode.getChildByName(\"tray_fish_type_\" + fishType);\r\n        if (labelNode == null) return;\r\n        this.node.getChildByName(\"zhuanpan\").active = true;\r\n        this.node.getChildByName(\"zhuanpan\").stopAllActions();\r\n        this.node.getChildByName(\"zhuanpan\").runAction(cc.sequence(cc.show(), cc.delayTime(3), cc.hide()));\r\n\r\n        for (var i in labelBaseNode.children) {\r\n            var node = labelBaseNode.children[i];\r\n            if (node == labelNode) node.active = true;\r\n            else node.active = false;\r\n        }\r\n        this.node.getChildByName(\"zhuanpan\").getChildByName(\"jiangjin\").getComponent(cc.Label).string = Helper.fixNum(score);\r\n    },\r\n\r\n    onSkill(sid, score, time) {\r\n        this.dataInfo.score -= score;\r\n        if (sid == 1) {\r\n        } else if (sid == 2) {\r\n            this.skillTime[1] = time;\r\n        }\r\n    },\r\n});"]}